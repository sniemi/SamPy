

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SamPy.bolshoi.plotdarkmattermf &mdash; SamPy v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="SamPy v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for SamPy.bolshoi.plotdarkmattermf</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Plots a dark matter halo mass function at different</span>
<span class="sd">redshifts. Input data are from the Bolshoi simulation.</span>

<span class="sd">:author: Sami-Matias Niemi</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>

<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;axes&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.handlelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;PDF&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">P</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
<span class="kn">import</span> <span class="nn">glob</span> <span class="kn">as</span> <span class="nn">g</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c">#From Sami&#39;s repo</span>
<span class="kn">import</span> <span class="nn">astronomy.differentialfunctions</span> <span class="kn">as</span> <span class="nn">df</span>
<span class="kn">import</span> <span class="nn">smnIO.read</span> <span class="kn">as</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">db.sqlite</span>
<span class="kn">import</span> <span class="nn">log.Logger</span> <span class="kn">as</span> <span class="nn">lg</span>

<div class="viewcode-block" id="plot_mass_function"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.plotdarkmattermf.plot_mass_function">[docs]</a><span class="k">def</span> <span class="nf">plot_mass_function</span><span class="p">(</span><span class="n">redshift</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">no_phantoms</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="c">#fudge factor</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="c">#http://adsabs.harvard.edu/abs/2001MNRAS.321..372J</span>
    <span class="c">#Jenkins et al. paper has sqrt(2./pi) while</span>
    <span class="c">#Rachel&#39;s code has 1/(sqrt(2*pi))</span>
    <span class="c">#ratio of these two is the fudge factor    </span>

    <span class="c">#read data to dictionary</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s">&#39;Bolshoi&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">dt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">readBolshoiDMfile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">no_phantoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>

    <span class="c">#calculate the mass functions from the Bolshoi data</span>
    <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diffFunctionLogBinning</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span>
                                           <span class="n">nbins</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
                                           <span class="n">h</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                           <span class="n">mmin</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">9.0</span><span class="p">,</span>
                                           <span class="n">mmax</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">15.0</span><span class="p">,</span>
                                           <span class="n">physical_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span>
    <span class="c">#use chain rule to get dN / dM</span>
    <span class="c">#dN/dM = dN/dlog10(M) * dlog10(M)/dM</span>
    <span class="c">#d/dM (log10(M)) = 1 / (M*ln(10)) </span>
    <span class="n">mf0</span> <span class="o">*=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">mbin0</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="c">#put mass back to power</span>
    <span class="n">mbin0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mbin0</span>
    <span class="c">#title</span>
    <span class="k">if</span> <span class="n">no_phantoms</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Bolshoi Dark Matter Mass Functions (no phantoms)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Bolshoi Dark Matter Mass Functions&#39;</span><span class="p">)</span>

    <span class="c">#mark redshift</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mbin0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mf0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.1f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;x-small&#39;</span><span class="p">)</span>

    <span class="c">#Analytical MFs</span>
    <span class="c">#0th column: log10 of mass (Msolar, NOT Msolar/h)</span>
    <span class="c">#1st column: mass (Msolar/h)</span>
    <span class="c">#2nd column: (dn/dM)*dM, per Mpc^3 (NOT h^3/Mpc^3)</span>
    <span class="n">xST</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yST</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="c">#PS</span>
    <span class="n">xPS</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yPS</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>

    <span class="c">#MF from Bolshoi</span>
    <span class="n">bolshoi</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">,</span> <span class="s">&#39;ro:&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c">#delete data to save memory, dt is not needed any longer</span>
    <span class="k">del</span> <span class="n">dt</span>

    <span class="c">#plot the residuals</span>
    <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">redshift</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
        <span class="c">#interploate to right x scale</span>
        <span class="n">yST</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">xST</span><span class="p">,</span> <span class="n">yST</span><span class="p">)</span>
        <span class="n">yPS</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">xPS</span><span class="p">,</span> <span class="n">yPS</span><span class="p">)</span>
        <span class="c">#make the plot</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.1f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">/</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">/</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$M_{\mathrm{vir}} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\mathrm{d}N / \mathrm{d}M_{\mathrm{vir}} \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{Bolshoi}}{\mathrm{Model}}$&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">bolshoi</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">ps</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">,</span> <span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">,</span> <span class="s">&#39;Press-Schecter&#39;</span><span class="p">),</span>
                                <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plot_mass_functionAnalytical2"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.plotdarkmattermf.plot_mass_functionAnalytical2">[docs]</a><span class="k">def</span> <span class="nf">plot_mass_functionAnalytical2</span><span class="p">(</span><span class="n">redshift</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">no_phantoms</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="c">#fudge factor</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="c">#http://adsabs.harvard.edu/abs/2001MNRAS.321..372J</span>
    <span class="c">#Jenkins et al. paper has sqrt(2./pi) while</span>
    <span class="c">#Rachel&#39;s code has 1/(sqrt(2*pi))</span>
    <span class="c">#ratio of these two is the fudge factor  </span>

    <span class="c">#read data</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">if</span> <span class="s">&#39;Bolshoi&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">dt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">readBolshoiDMfile</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">no_phantoms</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#M dN/dM dNcorr/dM dN/dlog10(M) dN/dlog10(Mcorr)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
            <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]])</span>
            <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]])</span>


    <span class="c">#calculate the mass functions from the Bolshoi data</span>
    <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diffFunctionLogBinning</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span>
                                           <span class="n">nbins</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
                                           <span class="n">h</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                           <span class="n">mmin</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">9.0</span><span class="p">,</span>
                                           <span class="n">mmax</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">15.0</span><span class="p">,</span>
                                           <span class="n">physical_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span>

    <span class="n">mbin0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mbin0</span>
    <span class="c">#title</span>
    <span class="k">if</span> <span class="n">no_phantoms</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Bolshoi Dark Matter Mass Functions (no phantoms)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Bolshoi Dark Matter Mass Functions&#39;</span><span class="p">)</span>

    <span class="c">#mark redshift</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mbin0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mf0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.1f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;x-small&#39;</span><span class="p">)</span>

    <span class="c">#Analytical MFs</span>
    <span class="n">xST</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yST</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="k">print</span> <span class="n">xST</span><span class="p">[</span><span class="mi">1000</span><span class="p">],</span> <span class="n">yST</span><span class="p">[</span><span class="mi">1000</span><span class="p">]</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="c">#PS</span>
    <span class="n">xPS</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yPS</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>

    <span class="c">#MF from Bolshoi</span>
    <span class="n">bolshoi</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">,</span> <span class="s">&#39;ro:&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c">#delete data to save memory, dt is not needed any longer</span>
    <span class="k">del</span> <span class="n">dt</span>

    <span class="c">#plot the residuals</span>
    <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">redshift</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
        <span class="c">#interploate to right x scale</span>
        <span class="n">mfintST</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">)</span>
        <span class="n">mfintPS</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">)</span>
        <span class="c">#yST = N.interp(mbin0, xST, yST)</span>
        <span class="c">#yPS = N.interp(mbin0, xPS, yPS)</span>
        <span class="c">#make the plot</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.0f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">mfintST</span> <span class="o">/</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">mfintPS</span> <span class="o">/</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">)</span>
        <span class="c">#ax2.plot(mbin0, mf0 / yST, &#39;b-&#39;)</span>
        <span class="c">#ax2.plot(mbin0, mf0 / yPS, &#39;g-&#39;)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$M_{\mathrm{vir}} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\mathrm{d}N / \mathrm{d}\log_{10}(M_{\mathrm{vir}}) \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{Bolshoi}}{\mathrm{Model}}$&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">bolshoi</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">ps</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">,</span> <span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">,</span> <span class="s">&#39;Press-Schecter&#39;</span><span class="p">),</span>
                                <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plotDMMFfromGalpropz"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.plotdarkmattermf.plotDMMFfromGalpropz">[docs]</a><span class="k">def</span> <span class="nf">plotDMMFfromGalpropz</span><span class="p">(</span><span class="n">redshift</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="c">#fudge factor</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="c">#http://adsabs.harvard.edu/abs/2001MNRAS.321..372J</span>
    <span class="c">#Jenkins et al. paper has sqrt(2./pi) while</span>
    <span class="c">#Rachel&#39;s code has 1/(sqrt(2*pi))</span>
    <span class="c">#ratio of these two is the fudge factor</span>

    <span class="c">#find the home directory, because the output is to dropbox </span>
    <span class="c">#and my user name is not always the same, this hack is required.</span>
    <span class="n">hm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Bolshoi/run/trial2/&#39;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="s">&#39;sams.db&#39;</span>

    <span class="n">rlow</span> <span class="o">=</span> <span class="n">redshift</span> <span class="o">-</span> <span class="mf">0.1</span>
    <span class="n">rhigh</span> <span class="o">=</span> <span class="n">redshift</span> <span class="o">+</span> <span class="mf">0.1</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select mhalo from galpropz where</span>
<span class="s">               galpropz.zgal &gt; </span><span class="si">%f</span><span class="s"> and galpropz.zgal &lt;= </span><span class="si">%f</span><span class="s"> and</span>
<span class="s">               galpropz.gal_id = 1</span>
<span class="s">    &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rlow</span><span class="p">,</span> <span class="n">rhigh</span><span class="p">)</span>

    <span class="k">print</span> <span class="n">query</span>

    <span class="c">#read data</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">dt</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>

    <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e9</span>

    <span class="c">#calculate the mass functions from the Bolshoi data</span>
    <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diffFunctionLogBinning</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span>
                                           <span class="n">nbins</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
                                           <span class="n">h</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                           <span class="n">mmin</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">9.0</span><span class="p">,</span>
                                           <span class="n">mmax</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">15.0</span><span class="p">,</span>
                                           <span class="n">volume</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                           <span class="n">nvols</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
                                           <span class="n">physical_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span>
    <span class="c">#use chain rule to get dN / dM</span>
    <span class="c">#dN/dM = dN/dlog10(M) * dlog10(M)/dM</span>
    <span class="c">#d/dM (log10(M)) = 1 / (M*ln(10)) </span>
    <span class="n">mf0</span> <span class="o">*=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">mbin0</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">mbin0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mbin0</span>
    <span class="c">#title</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Dark Matter Halo Mass Functions (galpropz.dat)&#39;</span><span class="p">)</span>

    <span class="c">#mark redshift</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mbin0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mf0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.0f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">7</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;x-small&#39;</span><span class="p">)</span>

    <span class="c">#Analytical MFs</span>
    <span class="c">#0th column: log10 of mass (Msolar, NOT Msolar/h)</span>
    <span class="c">#1st column: mass (Msolar/h)</span>
    <span class="c">#2nd column: (dn/dM)*dM, per Mpc^3 (NOT h^3/Mpc^3)</span>
    <span class="n">xST</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yST</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="c">#PS</span>
    <span class="n">xPS</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">yPS</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>

    <span class="c">#MF from Bolshoi</span>
    <span class="n">bolshoi</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">,</span> <span class="s">&#39;ro:&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c">#delete data to save memory, dt is not needed any longer</span>
    <span class="k">del</span> <span class="n">dt</span>

    <span class="c">#plot the residuals</span>
    <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">redshift</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
        <span class="c">#interploate to right x scale</span>
        <span class="n">ySTint</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">xST</span><span class="p">,</span> <span class="n">yST</span><span class="p">)</span>
        <span class="n">yPSint</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">xPS</span><span class="p">,</span> <span class="n">yPS</span><span class="p">)</span>
        <span class="c">#make the plot</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.0f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">/</span> <span class="n">ySTint</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">/</span> <span class="n">yPSint</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$M_{\mathrm{vir}} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\mathrm{d}N / \mathrm{d}M_{\mathrm{vir}} \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{galpropz.dat}}{\mathrm{Model}}$&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">bolshoi</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">ps</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">,</span> <span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">,</span> <span class="s">&#39;Press-Schecter&#39;</span><span class="p">),</span>
                                <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="plotDMMFfromGalpropzAnalytical2"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.plotdarkmattermf.plotDMMFfromGalpropzAnalytical2">[docs]</a><span class="k">def</span> <span class="nf">plotDMMFfromGalpropzAnalytical2</span><span class="p">(</span><span class="n">redshift</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">):</span>
    <span class="c">#fudge factor</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="c">#http://adsabs.harvard.edu/abs/2001MNRAS.321..372J</span>
    <span class="c">#Jenkins et al. paper has sqrt(2./pi) while</span>
    <span class="c">#Rachel&#39;s code has 1/(sqrt(2*pi))</span>
    <span class="c">#ratio of these two is the fudge factor    </span>

    <span class="c">#find the home directory, because the output is to dropbox </span>
    <span class="c">#and my user name is not always the same, this hack is required.</span>
    <span class="n">hm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Bolshoi/run/trial2/&#39;</span>
    <span class="n">database</span> <span class="o">=</span> <span class="s">&#39;sams.db&#39;</span>

    <span class="n">rlow</span> <span class="o">=</span> <span class="n">redshift</span> <span class="o">-</span> <span class="mf">0.1</span>
    <span class="n">rhigh</span> <span class="o">=</span> <span class="n">redshift</span> <span class="o">+</span> <span class="mf">0.1</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select mhalo from galpropz where</span>
<span class="s">               galpropz.zgal &gt; </span><span class="si">%f</span><span class="s"> and galpropz.zgal &lt;= </span><span class="si">%f</span><span class="s"> and</span>
<span class="s">               galpropz.gal_id = 1</span>
<span class="s">    &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rlow</span><span class="p">,</span> <span class="n">rhigh</span><span class="p">)</span>

    <span class="c">#Hubble constants</span>
    <span class="n">h3</span> <span class="o">=</span> <span class="n">h</span> <span class="o">**</span> <span class="mi">3</span>
    <span class="c">#read data</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="c">#M dN/dM dNcorr/dM dN/dlog10(M) dN/dlog10(Mcorr)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">x</span><span class="p">])</span>
        <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]])</span>
        <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]])</span>

    <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e9</span>
    <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">])</span>

    <span class="c">#calculate the mass functions from the Bolshoi data</span>
    <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diffFunctionLogBinning</span><span class="p">(</span><span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span>
                                           <span class="n">nbins</span><span class="o">=</span><span class="mi">35</span><span class="p">,</span>
                                           <span class="n">h</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                                           <span class="n">mmin</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">9.0</span><span class="p">,</span>
                                           <span class="n">mmax</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="mf">15.0</span><span class="p">,</span>
                                           <span class="n">volume</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                                           <span class="n">nvols</span><span class="o">=</span><span class="mi">26</span><span class="p">,</span>
                                           <span class="n">physical_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span>

    <span class="n">mbin0</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mbin0</span>
    <span class="c">#title</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Dark Matter Halo Mass Functions (galpropz.dat)&#39;</span><span class="p">)</span>

    <span class="c">#mark redshift</span>
    <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mbin0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mf0</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.0f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
            <span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;x-small&#39;</span><span class="p">)</span>

    <span class="c">#Analytical MFs</span>
    <span class="n">xST</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yST</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">sh</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="c">#PS</span>
    <span class="n">xPS</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yPS</span> <span class="o">=</span> <span class="n">dt</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">fudge</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>

    <span class="c">#MF from Bolshoi</span>
    <span class="n">bolshoi</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">,</span> <span class="s">&#39;ro:&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="c">#delete data to save memory, dt is not needed any longer</span>
    <span class="k">del</span> <span class="n">dt</span>

    <span class="c">#plot the residuals</span>
    <span class="k">if</span> <span class="n">redshift</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
        <span class="c">#interploate to right x scale</span>
        <span class="n">mfintST</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">)</span>
        <span class="n">mfintPS</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">mbin0</span><span class="p">,</span> <span class="n">mf0</span><span class="p">)</span>
        <span class="c">#yST = N.interp(mbin0, xST, yST)</span>
        <span class="c">#yPS = N.interp(mbin0, xPS, yPS)</span>
        <span class="c">#make the plot</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim </span><span class="si">%.0f</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="n">redshift</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
                     <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xST</span><span class="p">,</span> <span class="n">mfintST</span> <span class="o">/</span> <span class="n">yST</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xPS</span><span class="p">,</span> <span class="n">mfintPS</span> <span class="o">/</span> <span class="n">yPS</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">)</span>
        <span class="c">#ax2.plot(mbin0, mf0 / yST, &#39;b-&#39;)</span>
        <span class="c">#ax2.plot(mbin0, mf0 / yPS, &#39;g-&#39;)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">15</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$M_{\mathrm{vir}} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\mathrm{d}N / \mathrm{d}\log_{10}(M_{\mathrm{vir}}) \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{galpropz.dat}}{\mathrm{Model}}$&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">bolshoi</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">ps</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">,</span> <span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">,</span> <span class="s">&#39;Press-Schecter&#39;</span><span class="p">),</span>
                                <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="compareGalpropzToBolshoiTrees"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.plotdarkmattermf.compareGalpropzToBolshoiTrees">[docs]</a><span class="k">def</span> <span class="nf">compareGalpropzToBolshoiTrees</span><span class="p">(</span><span class="n">analyticalData</span><span class="p">,</span>
                                  <span class="n">BolshoiTrees</span><span class="p">,</span>
                                  <span class="n">redshifts</span><span class="p">,</span>
                                  <span class="n">h</span><span class="p">,</span>
                                  <span class="n">outputdir</span><span class="p">,</span>
                                  <span class="n">nvols</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                                  <span class="n">no_phantoms</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">galid</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="c">#data storage</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c">#figure definitions</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span>
    <span class="n">rect1</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
    <span class="n">rect2</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">]</span>

    <span class="c">#note that this is only available on tuonela.stsci.edu</span>
    <span class="n">simuPath</span> <span class="o">=</span> <span class="s">&#39;/Users/niemi/Desktop/Research/run/newtree1/&#39;</span>
    <span class="n">simuDB</span> <span class="o">=</span> <span class="s">&#39;sams.db&#39;</span>

    <span class="c">#star the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect2</span><span class="p">)</span>  <span class="c">#left, bottom, width, height</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">rect1</span><span class="p">)</span>

    <span class="c">#set title</span>
    <span class="k">if</span> <span class="n">galid</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Dark Matter Halo Mass Functions (gal\_id = 1; 26 volumes)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Dark Matter Halo Mass Functions (galpropz: 26 volumes)&#39;</span><span class="p">)</span>


    <span class="c">#loop over the data and redshift range</span>
    <span class="k">for</span> <span class="n">redsh</span><span class="p">,</span> <span class="n">BolshoiTree</span><span class="p">,</span> <span class="n">anaData</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">redshifts</span><span class="o">.</span><span class="n">itervalues</span><span class="p">()),</span>
                                           <span class="n">BolshoiTrees</span><span class="p">,</span>
                                           <span class="n">analyticalData</span><span class="p">):</span>
        <span class="c">#skip some redshifts</span>
        <span class="k">if</span> <span class="n">redsh</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">redsh</span> <span class="o">==</span> <span class="mf">2.0276</span> <span class="ow">or</span> <span class="n">redsh</span> <span class="o">==</span> <span class="mf">5.1614</span>\
           <span class="ow">or</span> <span class="n">redsh</span> <span class="o">==</span> <span class="mf">6.5586</span> <span class="ow">or</span> <span class="n">redsh</span> <span class="o">==</span> <span class="mf">3.0584</span><span class="p">:</span>
            <span class="k">continue</span>
            <span class="c">#if redsh == 1.0064 or redsh == 3.0584 or redsh == 4.0429 or \</span>
        <span class="c">#   redsh == 8.2251:</span>
        <span class="c">#    continue</span>

        <span class="c">#change this to logging afterwords</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">redsh</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">BolshoiTree</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">anaData</span><span class="p">)</span>

        <span class="n">rlow</span> <span class="o">=</span> <span class="n">redsh</span> <span class="o">-</span> <span class="mf">0.02</span>
        <span class="n">rhigh</span> <span class="o">=</span> <span class="n">redsh</span> <span class="o">+</span> <span class="mf">0.02</span>

        <span class="k">if</span> <span class="n">galid</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select mhalo from galpropz where</span>
<span class="s">                       galpropz.zgal &gt; {0:f} and galpropz.zgal &lt; {1:f} and</span>
<span class="s">                       galpropz.gal_id = 1&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rlow</span><span class="p">,</span> <span class="n">rhigh</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select mhalo from galpropz where</span>
<span class="s">                       galpropz.zgal &gt; {0:f} and</span>
<span class="s">                       galpropz.zgal &lt; {1:f}&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rlow</span><span class="p">,</span> <span class="n">rhigh</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="n">data</span><span class="p">[</span><span class="s">&#39;SAM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">simuPath</span><span class="p">,</span> <span class="n">simuDB</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e9</span>

        <span class="c">#calculate the mass functions from the SAM data, only x volumes</span>
        <span class="n">mbin0SAM</span><span class="p">,</span> <span class="n">mf0SAM</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diffFunctionLogBinning</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;SAM&#39;</span><span class="p">],</span>
                                                     <span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                                     <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                                                     <span class="n">mmin</span><span class="o">=</span><span class="mf">1e9</span><span class="p">,</span>
                                                     <span class="n">mmax</span><span class="o">=</span><span class="mf">1e15</span><span class="p">,</span>
                                                     <span class="n">volume</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                                                     <span class="n">nvols</span><span class="o">=</span><span class="n">nvols</span><span class="p">,</span>
                                                     <span class="n">physical_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">mbin0SAM</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mbin0SAM</span>
        <span class="c">#mf0SAM = mf0SAM * 1.7</span>

        <span class="c">#read the Bolshoi merger trees</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">readBolshoiDMfile</span><span class="p">(</span><span class="n">BolshoiTree</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">no_phantoms</span><span class="p">)</span>

        <span class="c">#calculate the mass functions from the full Bolshoi data</span>
        <span class="n">mbin0Bolshoi</span><span class="p">,</span> <span class="n">mf0Bolshoi</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">diffFunctionLogBinning</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">h</span><span class="p">,</span>
                                                             <span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                                             <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span>
                                                             <span class="n">mmin</span><span class="o">=</span><span class="mf">1e9</span><span class="p">,</span>
                                                             <span class="n">mmax</span><span class="o">=</span><span class="mf">1e15</span><span class="p">,</span>
                                                             <span class="n">volume</span><span class="o">=</span><span class="mf">50.0</span><span class="p">,</span>
                                                             <span class="n">nvols</span><span class="o">=</span><span class="mi">125</span><span class="p">,</span>
                                                             <span class="n">physical_units</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">mbin0Bolshoi</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mbin0Bolshoi</span>

        <span class="c">#Analytical MFs</span>
        <span class="c">#get Rachel&#39;s analytical curves</span>
        <span class="c">#M dN/dM dNcorr/dM dN/dlog10(M) dN/dlog10(Mcorr)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">anaData</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;Press-Schecter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">3</span><span class="p">]])</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]])</span>
        <span class="c">#ST</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                      <span class="n">data</span><span class="p">[</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                      <span class="s">&#39;k-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
        <span class="c">#PS</span>
        <span class="c">#ps = ax1.plot(data[&#39;Press-Schecter&#39;][0],</span>
        <span class="c">#              data[&#39;Press-Schecter&#39;][1],</span>
        <span class="c">#              &#39;g--&#39;, lw = 1.1)</span>

        <span class="c">#MF from Bolshoi</span>
        <span class="n">bolshoiax</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0Bolshoi</span><span class="p">,</span>
                             <span class="n">mf0Bolshoi</span><span class="p">,</span>
                             <span class="s">&#39;ro--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c">#MF from the SAM run</span>
        <span class="n">samax</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0SAM</span><span class="p">,</span>
                         <span class="n">mf0SAM</span><span class="p">,</span>
                         <span class="s">&#39;gs--&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c">#mark redshift</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mbin0Bolshoi</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">mf0Bolshoi</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim {0:.2f}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">redsh</span><span class="p">),</span>
                <span class="p">(</span><span class="mf">0.6</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;x-small&#39;</span><span class="p">)</span>

        <span class="c">#plot the residuals</span>
        <span class="k">if</span> <span class="n">redsh</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">:</span>
            <span class="c">#make the plot</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;$z \sim {0:.2f}$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">redsh</span><span class="p">),</span>
                    <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">9</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;data&#39;</span><span class="p">,</span>
                         <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">msk</span> <span class="o">=</span> <span class="n">mf0SAM</span> <span class="o">/</span> <span class="n">mf0Bolshoi</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin0SAM</span><span class="p">[</span><span class="n">msk</span><span class="p">],</span>
                     <span class="n">mf0SAM</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="o">/</span> <span class="n">mf0Bolshoi</span><span class="p">[</span><span class="n">msk</span><span class="p">],</span>
                     <span class="s">&#39;r-&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">1.55</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">2e9</span><span class="p">,</span> <span class="mf">4e14</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">2e9</span><span class="p">,</span> <span class="mf">4e14</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$M_{\mathrm{vir}} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\mathrm{d}N / \mathrm{d}\log_{10}(M_{\mathrm{vir}}) \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{galpropz.dat}}{\mathrm{IsoTree}}$&#39;</span><span class="p">)</span>

    <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">sh</span><span class="p">,</span> <span class="n">bolshoiax</span><span class="p">,</span> <span class="n">samax</span><span class="p">),</span>
            <span class="p">(</span><span class="s">&#39;Sheth-Tormen&#39;</span><span class="p">,</span> <span class="s">&#39;Bolshoi&#39;</span><span class="p">,</span> <span class="s">&#39;galpropz&#39;</span><span class="p">),</span>
                                     <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                     <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">galid</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputdir</span> <span class="o">+</span> <span class="s">&#39;IsotreesVSgalpropzGalID.pdf&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">outputdir</span> <span class="o">+</span> <span class="s">&#39;IsotreesVSgalpropz.pdf&#39;</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">#Hubble constant</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">0.7</span>
    <span class="c">#output directory</span>
    <span class="n">wrkdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Bolshoi/dm_halo_mf/&#39;</span>
    <span class="n">outdir</span> <span class="o">=</span> <span class="n">wrkdir</span> <span class="o">+</span> <span class="s">&#39;plots/&#39;</span>
    <span class="c">#logging</span>
    <span class="n">log_filename</span> <span class="o">=</span> <span class="s">&#39;plotDarkMatterMassFunction.log&#39;</span>
    <span class="n">logging</span> <span class="o">=</span> <span class="n">lg</span><span class="o">.</span><span class="n">setUpLogger</span><span class="p">(</span><span class="n">outdir</span> <span class="o">+</span> <span class="n">log_filename</span><span class="p">)</span>
    <span class="c">#find files</span>
    <span class="n">simus</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">wrkdir</span> <span class="o">+</span> <span class="s">&#39;simu/*.txt&#39;</span><span class="p">)</span>
    <span class="n">sheth</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">wrkdir</span> <span class="o">+</span> <span class="s">&#39;analytical/*sheth*_?_??-fit.dat&#39;</span><span class="p">)</span>
    <span class="n">press</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">wrkdir</span> <span class="o">+</span> <span class="s">&#39;analytical/*press*_?_??-fit.dat&#39;</span><span class="p">)</span>
    <span class="n">warren</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">wrkdir</span> <span class="o">+</span> <span class="s">&#39;analytical/*warren*_?_??-fit.dat&#39;</span><span class="p">)</span>
    <span class="c">#analytical 2, Rachel&#39;s code</span>
    <span class="n">analytical</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Bolshoi/var/z*&#39;</span><span class="p">)</span>

    <span class="c">#figure definitions</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span>
    <span class="n">rect1</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
    <span class="n">rect2</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">]</span>


    <span class="c">#    #make the individual plots</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)  #left, bottom, width, height</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b, c, d in zip(simus, sheth, press, warren):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Sheth-Tormen&#39;: b,</span>
    <span class="c">#                &#39;Press-Schecter&#39;: c,</span>
    <span class="c">#                &#39;Warren&#39; : d}</span>
    <span class="c">#</span>
    <span class="c">#        if b.find(&#39;_1_01&#39;) &gt; -1 or b.find(&#39;_6_56&#39;) &gt; -1 or b.find(&#39;_3_06&#39;) &gt; -1 or b.find(&#39;_5_16&#39;) &gt; -1:</span>
    <span class="c">#            continue</span>
    <span class="c">#        else:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39;, redshift)</span>
    <span class="c">#            print a, b, c, d</span>
    <span class="c">#            plot_mass_function(redshift, h, True, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfzNoPhantoms1.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 2</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b, c, d in zip(simus, sheth, press, warren):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Sheth-Tormen&#39;: b,</span>
    <span class="c">#                &#39;Press-Schecter&#39;: c,</span>
    <span class="c">#                &#39;Warren&#39; : d}</span>
    <span class="c">#</span>
    <span class="c">#        if b.find(&#39;_1_01&#39;) &gt; -1 or b.find(&#39;_6_56&#39;) &gt; -1 or b.find(&#39;_3_06&#39;) &gt; -1 or b.find(&#39;_5_16&#39;) &gt; -1:</span>
    <span class="c">#            continue</span>
    <span class="c">#        else:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39;, redshift)</span>
    <span class="c">#            print a, b, c, d</span>
    <span class="c">#            plot_mass_function(redshift, h, False, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfz1.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 3</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b, c, d in zip(simus, sheth, press, warren):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Sheth-Tormen&#39;: b,</span>
    <span class="c">#                &#39;Press-Schecter&#39;: c,</span>
    <span class="c">#                &#39;Warren&#39; : d}</span>
    <span class="c">#</span>
    <span class="c">#        if b.find(&#39;_1_01&#39;) &gt; -1 or b.find(&#39;_6_56&#39;) &gt; -1 or b.find(&#39;_3_06&#39;) &gt; -1 or b.find(&#39;_5_16&#39;) &gt; -1:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39;, redshift)</span>
    <span class="c">#            print a, b, c, d</span>
    <span class="c">#            plot_mass_function(redshift, h, True, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfzNoPhantoms2.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 4</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b, c, d in zip(simus, sheth, press, warren):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Sheth-Tormen&#39;: b,</span>
    <span class="c">#                &#39;Press-Schecter&#39;: c,</span>
    <span class="c">#                &#39;Warren&#39; : d}</span>
    <span class="c">#</span>
    <span class="c">#        if b.find(&#39;_1_01&#39;) &gt; -1 or b.find(&#39;_6_56&#39;) &gt; -1 or b.find(&#39;_3_06&#39;) &gt; -1 or b.find(&#39;_5_16&#39;) &gt; -1:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39;, redshift)</span>
    <span class="c">#            print a, b, c, d</span>
    <span class="c">#            plot_mass_function(redshift, h, False, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfz2.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">##############################</span>
    <span class="c">#    #With Rachel&#39;s analytical</span>
    <span class="c">#    #make the individual plots</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)  #left, bottom, width, height</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b in zip(simus, analytical):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Analytical&#39;: b}</span>
    <span class="c">#</span>
    <span class="c">#        if round(redshift,1) not in [1.0, 2.0, 4.0, 8.2]:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39; % redshift)</span>
    <span class="c">#            print a, b</span>
    <span class="c">#            plot_mass_functionAnalytical2(redshift, h, True, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfzNoPhantoms1RAnalytical.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 2</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b in zip(simus, analytical):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Analytical&#39;: b}</span>
    <span class="c">#</span>
    <span class="c">#        if round(redshift,1) not in [1.0, 2.0, 4.0, 5.2]:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39; % redshift)</span>
    <span class="c">#            print a, b</span>
    <span class="c">#            plot_mass_functionAnalytical2(redshift, h, False, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfz1RAnalytical.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 3</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b in zip(simus, analytical):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Analytical&#39;: b}</span>
    <span class="c">#</span>
    <span class="c">#        if round(redshift,1) in [1.0, 4.0, 6.6]:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39;, redshift)</span>
    <span class="c">#            print a, b</span>
    <span class="c">#            plot_mass_functionAnalytical2(redshift, h, True, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfzNoPhantoms2RAnalytical.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 4</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, b in zip(simus, analytical):</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Bolshoi&#39; : a,</span>
    <span class="c">#                &#39;Analytical&#39;: b}</span>
    <span class="c">#</span>
    <span class="c">#        if round(redshift,1) in [1.0, 4.0, 6.6]:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39; % redshift)</span>
    <span class="c">#            print a, b</span>
    <span class="c">#            plot_mass_functionAnalytical2(redshift, h, False, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfz2RAnalytical.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#################################</span>
    <span class="c">#    #Haloes from galpropz.dat</span>
    <span class="c">#</span>
    <span class="c">#    sheth = g.glob(wrkdir + &#39;analytical/*sheth*_?_?-fit.dat&#39;)</span>
    <span class="c">#    press = g.glob(wrkdir + &#39;analytical/*press*_?_?-fit.dat&#39;)</span>
    <span class="c">#    warren = g.glob(wrkdir + &#39;analytical/*warren*_?_?-fit.dat&#39;)</span>
    <span class="c">#</span>
    <span class="c">#    #make the individual plots 2</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a, c, d in zip(sheth, press, warren):</span>
    <span class="c">#        redshift = float(a.split(&#39;tormen_&#39;)[1].split(&#39;-fit&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Sheth-Tormen&#39;: a,</span>
    <span class="c">#                &#39;Press-Schecter&#39;: c,</span>
    <span class="c">#                &#39;Warren&#39; : d}</span>
    <span class="c">#</span>
    <span class="c">#        if a.find(&#39;_2_0&#39;) &gt; -1 or a.find(&#39;_6_0&#39;) &gt; -1 or a.find(&#39;_3_0&#39;) &gt; -1 or a.find(&#39;_5_0&#39;) &gt; -1 or a.find(&#39;_0_0&#39;) &gt; -1:</span>
    <span class="c">#            continue</span>
    <span class="c">#        else:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions&#39; % redshift)</span>
    <span class="c">#            print a, c, d</span>
    <span class="c">#            plotDMMFfromGalpropz(redshift, h, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfz1GalpropZ.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">#</span>
    <span class="c">#    #a new plot</span>
    <span class="c">#    fig = P.figure()</span>
    <span class="c">#    ax1 = fig.add_axes(rect2)</span>
    <span class="c">#    ax2 = fig.add_axes(rect1)</span>
    <span class="c">#    for a in analytical:</span>
    <span class="c">#        redshift = float(a.split(&#39;z&#39;)[1].split(&#39;.&#39;)[0].replace(&#39;_&#39;, &#39;.&#39;))</span>
    <span class="c">#        data = {&#39;Analytical&#39;: a}</span>
    <span class="c">#        if round(redshift,1) in [1.0, 4.0, 8.0]:</span>
    <span class="c">#            logging.debug(&#39;Plotting redshift %.2f dark matter mass functions (Analytical 2)&#39; % redshift)</span>
    <span class="c">#            print a</span>
    <span class="c">#            plotDMMFfromGalpropzAnalytical2(redshift, h, data)</span>
    <span class="c">#    P.savefig(outdir + &#39;DMmfz1GalpropZAnalytical2.pdf&#39;)</span>
    <span class="c">#    P.close()</span>
    <span class="c">########################################</span>
    <span class="c">#Compare dark matter halo mass functions of Rachel&#39;s SAM and Bolshoi trees</span>
    <span class="n">redshifts</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.9943</span><span class="p">:</span> <span class="mf">0.0057</span><span class="p">,</span>
                 <span class="mf">0.4984</span><span class="p">:</span> <span class="mf">1.0064</span><span class="p">,</span>
                 <span class="mf">0.2464</span><span class="p">:</span> <span class="mf">3.0584</span><span class="p">,</span>
                 <span class="mf">0.1983</span><span class="p">:</span> <span class="mf">4.0429</span><span class="p">,</span>
                 <span class="mf">0.1323</span><span class="p">:</span> <span class="mf">6.5586</span><span class="p">,</span>
                 <span class="mf">0.1084</span><span class="p">:</span> <span class="mf">8.2251</span><span class="p">,</span>
                 <span class="mf">0.1623</span><span class="p">:</span> <span class="mf">5.1614</span><span class="p">,</span>
                 <span class="mf">0.3303</span><span class="p">:</span> <span class="mf">2.0276</span><span class="p">}</span>

    <span class="n">compareGalpropzToBolshoiTrees</span><span class="p">(</span><span class="n">analytical</span><span class="p">,</span> <span class="n">simus</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">outdir</span><span class="p">)</span>
    <span class="c">#compareGalpropzToBolshoiTrees(analytical, simus, redshifts, h, outdir, galid=False)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Sami-Matias Niemi.
    </div>
  </body>
</html>