

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SamPy.bolshoi.generateTestPlots &mdash; SamPy v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="SamPy v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for SamPy.bolshoi.generateTestPlots</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">This script can be used to generate some basic plots</span>
<span class="sd">from Rachel&#39;s SAM. In these plots comparisons to</span>
<span class="sd">observational constrains are also performed.</span>

<span class="sd">:author : Sami-Matias Niemi</span>
<span class="sd">:contact : niemi@stsci.edu</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;axes&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;lines&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;lines.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.handlelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c">#matplotlib.rcParams[&#39;xtick.labelsize&#39;] = &#39;large&#39;</span>
<span class="c">#matplotlib.rcParams[&#39;ytick.labelsize&#39;] = &#39;large&#39;</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.fancybox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.shadow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="c">#matplotlib.use(&#39;PDF&#39;)</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">NullFormatter</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">P</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="kn">as</span> <span class="nn">ss</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="c">#Imports from Sami&#39;s repo</span>
<span class="kn">import</span> <span class="nn">smnIO.read</span> <span class="kn">as</span> <span class="nn">read</span>
<span class="kn">import</span> <span class="nn">astronomy.stellarMFs</span> <span class="kn">as</span> <span class="nn">stellarMFs</span>
<span class="kn">import</span> <span class="nn">astronomy.metals</span> <span class="kn">as</span> <span class="nn">metallicity</span>
<span class="kn">import</span> <span class="nn">astronomy.gasmasses</span> <span class="kn">as</span> <span class="nn">gas</span>
<span class="kn">import</span> <span class="nn">astronomy.blackholes</span> <span class="kn">as</span> <span class="nn">bh</span>
<span class="kn">import</span> <span class="nn">astronomy.baryons</span> <span class="kn">as</span> <span class="nn">baryons</span>

<div class="viewcode-block" id="perc_bin"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.perc_bin">[docs]</a><span class="k">def</span> <span class="nf">perc_bin</span><span class="p">(</span><span class="n">xbin</span><span class="p">,</span> <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compute median and 16 and 8 percentiles of y-data in bins in x</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#xbin.sort</span>
    <span class="n">nbin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xbin</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">xbin_mid</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbin</span><span class="p">)</span>
    <span class="n">y50</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbin</span><span class="p">)</span> <span class="o">-</span> <span class="mf">99.</span>
    <span class="n">y16</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbin</span><span class="p">)</span> <span class="o">-</span> <span class="mf">99.</span>
    <span class="n">y84</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbin</span><span class="p">)</span> <span class="o">-</span> <span class="mf">99.</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbin</span><span class="p">):</span>
        <span class="n">xbin_mid</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xbin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">xbin</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xbin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">xdata</span> <span class="o">&gt;</span> <span class="n">xbin</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">xdata</span> <span class="o">&lt;=</span> <span class="n">xbin</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ydata</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">y50</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">ydata</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
            <span class="n">y16</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">ydata</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
            <span class="n">y84</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">scoreatpercentile</span><span class="p">(</span><span class="n">ydata</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="mi">84</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xbin_mid</span><span class="p">,</span> <span class="n">y50</span><span class="p">,</span> <span class="n">y16</span><span class="p">,</span> <span class="n">y84</span>

</div>
<div class="viewcode-block" id="fstar_plot"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.fstar_plot">[docs]</a><span class="k">def</span> <span class="nf">fstar_plot</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;fstar.png&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Stellar mass to halo mass ratio as a function of halo mass.</span>
<span class="sd">    This plot differs slightly from the one in the Somerville 2008:</span>
<span class="sd">    the plot in the paper is the fraction of baryons in stars. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mfit</span> <span class="o">=</span> <span class="mf">10.</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="mf">10.7</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.2</span>

    <span class="n">f8</span> <span class="o">=</span> <span class="mf">8.</span> <span class="o">-</span> <span class="n">mfit</span>
    <span class="c">#f9 = 9. - mfit</span>

    <span class="n">fs_halo</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mstar</span> <span class="o">-</span> <span class="n">prop</span><span class="o">.</span><span class="n">mhalo</span><span class="p">)</span>

    <span class="c">#central and satellite galaxies</span>
    <span class="n">central</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">gal_id</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">sat</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">gal_id</span> <span class="o">!=</span> <span class="mi">1</span>

    <span class="n">mbin_mid</span><span class="p">,</span> <span class="n">fs_50</span><span class="p">,</span> <span class="n">fs_10</span><span class="p">,</span> <span class="n">fs_90</span> <span class="o">=</span> <span class="n">perc_bin</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">mhalo</span><span class="p">,</span> <span class="n">fs_halo</span><span class="p">)</span>
    <span class="n">mbin_mid</span><span class="p">,</span> <span class="n">fs_cen_50</span><span class="p">,</span> <span class="n">fs_cen_10</span><span class="p">,</span> <span class="n">fs_cen_90</span> <span class="o">=</span> <span class="n">perc_bin</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">mhalo</span><span class="p">[</span><span class="n">central</span><span class="p">],</span> <span class="n">fs_halo</span><span class="p">[</span><span class="n">central</span><span class="p">])</span>
    <span class="n">mbin_mid</span><span class="p">,</span> <span class="n">fs_sat_50</span><span class="p">,</span> <span class="n">fs_sat_10</span><span class="p">,</span> <span class="n">fs_sat_90</span> <span class="o">=</span> <span class="n">perc_bin</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">prop</span><span class="o">.</span><span class="n">mhalo</span><span class="p">[</span><span class="n">sat</span><span class="p">],</span> <span class="n">fs_halo</span><span class="p">[</span><span class="n">sat</span><span class="p">])</span>

    <span class="c">#begin figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="c">#ax.plot(prop.mhalo, prop.mstar)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mhalo</span><span class="p">[</span><span class="n">central</span><span class="p">],</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fs_halo</span><span class="p">[</span><span class="n">central</span><span class="p">]),</span>
               <span class="n">edgecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Central galaxies&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fs_50</span><span class="p">),</span> <span class="s">&#39;ko&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median, all galaxies&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fs_10</span><span class="p">),</span> <span class="s">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fs_90</span><span class="p">),</span> <span class="s">&#39;k--&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fs_sat_50</span><span class="p">),</span> <span class="s">&#39;cD&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median, satellite galaxies&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fs_cen_50</span><span class="p">),</span> <span class="s">&#39;pm&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median, central galaxies&#39;</span><span class="p">)</span>

    <span class="c">#constrains from moster et al.</span>
    <span class="n">fstar_med_ben</span> <span class="o">=</span> <span class="n">stellarMFs</span><span class="o">.</span><span class="n">fstarBen</span><span class="p">(</span><span class="n">mfit</span><span class="p">,</span> <span class="mf">11.884</span><span class="p">,</span> <span class="mf">0.0282</span><span class="p">,</span> <span class="mf">1.057</span><span class="p">,</span> <span class="mf">0.5560</span><span class="p">)</span>
    <span class="n">fstar_med_ben_scat</span> <span class="o">=</span> <span class="n">stellarMFs</span><span class="o">.</span><span class="n">fstarBen</span><span class="p">(</span><span class="n">mfit</span><span class="p">,</span> <span class="mf">11.866</span><span class="p">,</span> <span class="mf">0.02891</span><span class="p">,</span> <span class="mf">1.110</span><span class="p">,</span> <span class="mf">0.648</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mfit</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fstar_med_ben</span><span class="p">),</span> <span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Moster et al.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mfit</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fstar_med_ben_scat</span><span class="p">),</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;burlywood&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Moster et al. (sc)&#39;</span><span class="p">)</span>

    <span class="c">#get fstar_behroozi_log</span>
    <span class="n">mh</span><span class="p">,</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">stellarMFs</span><span class="o">.</span><span class="n">fstarBehroozi</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mh</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="s">&#39;hg&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Behroozi et al.&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mfit</span><span class="p">,</span> <span class="n">f8</span><span class="p">,</span> <span class="s">&#39;k--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;0.25&#39;</span><span class="p">)</span>

    <span class="c">#axis scales</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.75</span><span class="p">)</span>

    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} \left ( \frac{M_{star}}{f_{b}M_{halo}} \right )$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} \left ( \frac{M_{(sub)halo}}{M_{\odot}} \right )$&#39;</span><span class="p">)</span>

    <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="massfunc_plot"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.massfunc_plot">[docs]</a><span class="k">def</span> <span class="nf">massfunc_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">mmax</span><span class="o">=</span><span class="mf">12.5</span><span class="p">,</span> <span class="n">mmin</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;SMN&#39;</span><span class="p">,</span>
                  <span class="n">nvolumes</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plots stellar mass functions, cold gas mass functions, &amp; BH MF</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#files</span>
    <span class="n">path_BH</span> <span class="o">=</span> <span class="s">&#39;/Users/niemi/Desktop/Research/IDL/obs/phopkins/&#39;</span>
    <span class="c">#BH_file = path_BH + &#39;rachel_bhmf_data.dat&#39;</span>

    <span class="c">#overrides weight for a single Bolshoi sub-volume</span>
    <span class="c">#halos.weight = halos.weight * 0. + 1./(50.0/0.7)**3</span>
    <span class="n">halos</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span> <span class="o">*</span> <span class="mf">0.</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">nvolumes</span> <span class="o">*</span> <span class="p">(</span><span class="mf">50.</span> <span class="o">/</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>

    <span class="n">ngal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">gal_id</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s"> galaxies found&#39;</span> <span class="o">%</span> <span class="n">ngal</span>

    <span class="n">dm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmax</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nbins</span>
    <span class="k">print</span> <span class="n">dm</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="n">mmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span>

    <span class="c">#mfit = mmin + N.arange(150) * 0.05</span>

    <span class="n">mf_cold</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mf_star</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mf_star_central</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mf_bar</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mf_bh</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>

    <span class="n">mf_early</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mf_late</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mf_bulge</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>

    <span class="c">#from IDL, should be done without looping</span>
    <span class="n">btt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">props</span><span class="o">.</span><span class="n">mbulge</span> <span class="o">-</span> <span class="n">props</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngal</span><span class="p">):</span>
        <span class="n">ihalo</span> <span class="o">=</span> <span class="n">props</span><span class="o">.</span><span class="n">halo_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c">#cold gas</span>
        <span class="n">ibin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">props</span><span class="o">.</span><span class="n">mcold</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">mf_cold</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
            <span class="c">#stellar mass</span>
        <span class="n">ibin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">props</span><span class="o">.</span><span class="n">mstar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">mf_star</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
            <span class="c">#stellar mass, by type</span>
            <span class="k">if</span> <span class="n">btt</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.4</span><span class="p">:</span>
                <span class="n">mf_early</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mf_late</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
                <span class="c">#stellar mass, centrals</span>
            <span class="k">if</span> <span class="n">props</span><span class="o">.</span><span class="n">gal_id</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>
                    <span class="n">mf_star_central</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
            <span class="c">#bulge mass</span>
        <span class="n">ibin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">props</span><span class="o">.</span><span class="n">mbulge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">mf_bulge</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
            <span class="c">#baryonic mass</span>
        <span class="n">mbar</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">10.0</span> <span class="o">**</span> <span class="n">props</span><span class="o">.</span><span class="n">mcold</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">props</span><span class="o">.</span><span class="n">mstar</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">ibin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">mbar</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">mf_bar</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>
            <span class="c">#black hole</span>
        <span class="n">ibin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">props</span><span class="o">.</span><span class="n">mbh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">mf_bh</span><span class="p">[</span><span class="n">ibin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">ihalo</span><span class="p">]</span>

    <span class="n">mf_cold</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mf_cold</span> <span class="o">/</span> <span class="n">dm</span><span class="p">)</span>
    <span class="n">mf_star</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mf_star</span> <span class="o">/</span> <span class="n">dm</span><span class="p">)</span>
    <span class="c">#mf_early = N.log10(mf_early / dm)</span>
    <span class="c">#mf_late = N.log10(mf_late / dm)</span>
    <span class="c">#mf_bulge = N.log10(mf_bulge / dm)</span>
    <span class="c">#mf_star_central = N.log10(mf_star_central / dm)</span>
    <span class="n">mf_bar</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mf_bar</span> <span class="o">/</span> <span class="n">dm</span><span class="p">)</span>
    <span class="n">mf_bh</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mf_bh</span> <span class="o">/</span> <span class="n">dm</span><span class="p">)</span>

    <span class="c">#stellar mass function plot</span>
    <span class="c">#obs constrains</span>
    <span class="n">mg</span><span class="p">,</span> <span class="n">phig</span><span class="p">,</span> <span class="n">phi_lowg</span><span class="p">,</span> <span class="n">phi_highg</span> <span class="o">=</span> <span class="n">stellarMFs</span><span class="o">.</span><span class="n">bellG</span><span class="p">()</span>
    <span class="n">mk</span><span class="p">,</span> <span class="n">phik</span><span class="p">,</span> <span class="n">phi_lowk</span><span class="p">,</span> <span class="n">phi_highk</span> <span class="o">=</span> <span class="n">stellarMFs</span><span class="o">.</span><span class="n">bellK</span><span class="p">()</span>
    <span class="c">#ml, phil, phi_lowl, phi_hiugl = mstar_lin(obs + &#39;sdss_mf/SDSS_SMF.dat&#39;)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nlow</span><span class="p">,</span> <span class="n">nhigh</span> <span class="o">=</span> <span class="n">stellarMFs</span><span class="o">.</span><span class="n">panter</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mf_star</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Stellar Mass Function&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mg</span><span class="p">,</span> <span class="n">phig</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">phig</span> <span class="o">-</span> <span class="n">phi_highg</span><span class="p">,</span> <span class="n">phi_lowg</span> <span class="o">-</span> <span class="n">phig</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bell et al. G&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">mk</span><span class="p">,</span> <span class="n">phik</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">phik</span> <span class="o">-</span> <span class="n">phi_highk</span><span class="p">,</span> <span class="n">phi_lowk</span> <span class="o">-</span> <span class="n">phik</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bell et al. K&#39;</span><span class="p">)</span>
    <span class="c">#ax.errorbar(ml, phil, yerr = [phi_lowl, phi_highl], label = &#39;Lin et al. K&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">nlow</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">nhigh</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Panter et al. K&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">6.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$\log M_{star} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\log \textrm{d}N}{\textrm{d}\log M_{star}} \quad [\textrm{Mpc}^{-3} \textrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mfstar_&#39;</span> <span class="o">+</span> <span class="n">output</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#cold gas mass function</span>
    <span class="c">#obs constrains</span>
    <span class="c">#mhi_bell_h70</span>
    <span class="c">#mgas_bell_h70</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">HIMassFunctionZwaan</span><span class="p">(</span><span class="n">mbin</span><span class="p">)</span>
    <span class="n">m_hi</span><span class="p">,</span> <span class="n">phi_hi</span><span class="p">,</span> <span class="n">phi_low_hi</span><span class="p">,</span> <span class="n">phi_high_hi</span> <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">HIMassFunctionBell</span><span class="p">()</span>
    <span class="n">m_h2</span><span class="p">,</span> <span class="n">phi_h2</span><span class="p">,</span> <span class="n">phi_low_h2</span><span class="p">,</span> <span class="n">phi_high_h2</span> <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">H2MassFunctionBell</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mf_cold</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Cold Gas Mass Function&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Zwaan et al.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">m_hi</span><span class="p">,</span> <span class="n">phi_hi</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">phi_hi</span> <span class="o">-</span> <span class="n">phi_high_hi</span><span class="p">,</span> <span class="n">phi_low_hi</span> <span class="o">-</span> <span class="n">phi_hi</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bell et al. $H_{I}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">m_h2</span><span class="p">,</span> <span class="n">phi_h2</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">phi_h2</span> <span class="o">-</span> <span class="n">phi_high_h2</span><span class="p">,</span> <span class="n">phi_low_h2</span> <span class="o">-</span> <span class="n">phi_h2</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bell et al. $H_{2}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_hi</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">10.0</span> <span class="o">**</span> <span class="n">phi_hi</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">phi_h2</span><span class="p">),</span> <span class="s">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;$H_{I} + H_{2}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">5.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} M_{cold} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\log_{10} \textrm{d}N}{\textrm{d}\log M} \quad [\textrm{Mpc}^{-3} \textrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mfcold_&#39;</span> <span class="o">+</span> <span class="n">output</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#total baryons</span>
    <span class="c">#obs contstrains</span>
    <span class="n">m_bar</span><span class="p">,</span> <span class="n">phi_bar</span><span class="p">,</span> <span class="n">phi_low_bar</span><span class="p">,</span> <span class="n">phi_high_bar</span> <span class="o">=</span> <span class="n">baryons</span><span class="o">.</span><span class="n">BellBaryonicMassFunction</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mf_bar</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Total Baryon Mass&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">m_bar</span><span class="p">,</span> <span class="n">phi_bar</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">phi_bar</span> <span class="o">-</span> <span class="n">phi_high_bar</span><span class="p">,</span> <span class="n">phi_low_bar</span> <span class="o">-</span> <span class="n">phi_bar</span><span class="p">],</span>
                <span class="n">c</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bell et al.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">12.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} M_{baryons} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\log_{10} \mathrm{d}N}{\mathrm{d}\log M_{baryons}} \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mfbar_&#39;</span> <span class="o">+</span> <span class="n">output</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#BH mass function</span>
    <span class="c">#obs constrains</span>
    <span class="n">m_bh</span><span class="p">,</span> <span class="n">phi_low_bh</span><span class="p">,</span> <span class="n">phi_med_bh</span><span class="p">,</span> <span class="n">phi_high_bh</span> <span class="o">=</span> <span class="n">bh</span><span class="o">.</span><span class="n">MarconiMassFunction</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mf_bh</span><span class="p">,</span> <span class="s">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Black Hole Mass Function&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bh</span><span class="p">,</span> <span class="n">phi_low_bh</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bh</span><span class="p">,</span> <span class="n">phi_med_bh</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Marconi et al.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bh</span><span class="p">,</span> <span class="n">phi_high_bh</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">10.2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} M_{BH} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\log_{10} \mathrm{d}N}{\mathrm{d}\log M} \quad [\mathrm{Mpc}^{-3} \mathrm{dex}^{-1}]$&#39;</span><span class="p">)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">&#39;mfBH_&#39;</span> <span class="o">+</span> <span class="n">output</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="gasfrac_hess"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.gasfrac_hess">[docs]</a><span class="k">def</span> <span class="nf">gasfrac_hess</span><span class="p">(</span><span class="n">mstar</span><span class="p">,</span> <span class="n">fgas</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
                 <span class="n">mmin</span><span class="o">=</span><span class="mf">8.5</span><span class="p">,</span> <span class="n">mmax</span><span class="o">=</span><span class="mf">11.7</span><span class="p">,</span> <span class="n">nmbins</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                 <span class="n">fgasmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">fgasmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nfbins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pmin</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Plot _conditional_ distribution of gas fraction vs. stellar mass.</span>
<span class="sd">    Ported from an IDL code, should be cleaned.</span>
<span class="sd">    Most likely N.zeros are not needed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#n.b. mbin and fgasbin are the bin CENTERS</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmax</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nmbins</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="n">mmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nmbins</span><span class="p">))</span> <span class="o">*</span> <span class="n">dm</span> <span class="o">+</span> <span class="n">dm</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">dfgas</span> <span class="o">=</span> <span class="p">(</span><span class="n">fgasmax</span> <span class="o">-</span> <span class="n">fgasmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nfbins</span>
    <span class="c">#fgasbin = fgasmin + (N.arange(nfbins)) * dfgas + dfgas / 2.0</span>

    <span class="n">fgashist</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfbins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>
    <span class="c">#fraction of galaxies with no gas</span>
    <span class="c">#nogas = N.zeros(nmbins)</span>
    <span class="c">#without weight factor</span>
    <span class="n">yhist_num</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nfbins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>
    <span class="c">#number of halos in each bin</span>
    <span class="n">nh</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmbins</span><span class="p">)</span>

    <span class="c">#compute gas fraction distributions in stellar mass bins</span>
    <span class="c">#with weight factor</span>
    <span class="c">#this should be rewritten...</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mstar</span><span class="p">)):</span>
        <span class="n">imbin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">mstar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">imbin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">imbin</span> <span class="o">&lt;</span> <span class="n">nmbins</span><span class="p">:</span>
            <span class="n">nh</span><span class="p">[</span><span class="n">imbin</span><span class="p">]</span> <span class="o">=</span> <span class="n">nh</span><span class="p">[</span><span class="n">imbin</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">ifgas</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">fgas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">fgasmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dfgas</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">ifgas</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ifgas</span> <span class="o">&lt;</span> <span class="n">nfbins</span><span class="p">:</span>
                <span class="n">fgashist</span><span class="p">[</span><span class="n">ifgas</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">=</span> <span class="n">fgashist</span><span class="p">[</span><span class="n">ifgas</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">yhist_num</span><span class="p">[</span><span class="n">ifgas</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">=</span> <span class="n">yhist_num</span><span class="p">[</span><span class="n">ifgas</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="c">#conditional distributions in Mh bins</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fgashist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">fgashist</span><span class="p">)</span>
    <span class="n">smax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>
    <span class="n">smin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span>

    <span class="n">s</span><span class="p">[</span><span class="n">fgashist</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>
    <span class="n">s</span><span class="p">[</span><span class="n">yhist_num</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>

    <span class="c">#obs contstrains</span>
    <span class="n">kmstar</span><span class="p">,</span> <span class="n">kfgas</span> <span class="o">=</span> <span class="n">gas</span><span class="o">.</span><span class="n">gasFractionKannappan</span><span class="p">()</span>

    <span class="c">#medians</span>
    <span class="n">mbin_mid</span><span class="p">,</span> <span class="n">y50</span><span class="p">,</span> <span class="n">y16</span><span class="p">,</span> <span class="n">y84</span> <span class="o">=</span> <span class="n">perc_bin</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mstar</span><span class="p">,</span> <span class="n">fgas</span><span class="p">)</span>

    <span class="c">#image</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">smin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">smax</span><span class="p">,</span>
                    <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">],</span>
                    <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">y50</span><span class="p">,</span> <span class="s">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">y16</span><span class="p">,</span> <span class="s">&#39;r--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">y84</span><span class="p">,</span> <span class="s">&#39;r--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kmstar</span><span class="p">,</span> <span class="n">kfgas</span><span class="p">,</span> <span class="s">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Kannappan et al.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">pmin</span><span class="p">,</span> <span class="n">pmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Gas fraction&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\log M_{star} \quad [M_{\odot}] $&#39;</span><span class="p">)</span>
    <span class="c"># cbar = fig.colorbar(ims, orientation=&#39;horizontal&#39;)</span>
    <span class="c"># cbar = fig.colorbar(ims, ticks=[min, max/factor/2., max/factor], orientation=&#39;horizontal&#39;)</span>
    <span class="c"># cbar.ax.set_xticklabels([&#39;%3.2f&#39; % min, &#39;%3.2f&#39; % (max/2.), &#39;%3.2f&#39; % (max)])</span>
    <span class="c"># cbar.ax.set_title(&#39;Pixel Values (counts s$^{-1}$)&#39;)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ssfr_plot"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.ssfr_plot">[docs]</a><span class="k">def</span> <span class="nf">ssfr_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;.pdf&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Specific starformation rate plots.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">wgal</span> <span class="o">=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">halo_id</span><span class="p">]</span>

    <span class="n">log_ssfr</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">sfr_ave</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">prop</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>
    <span class="n">log_ssfr</span><span class="p">[</span><span class="n">log_ssfr</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">14.0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">13.8</span>

    <span class="n">ssfrhess_sam</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mstar</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">log_ssfr</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">wgal</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">output</span> <span class="o">+</span> <span class="n">typ</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ssfrhess_sam"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.ssfrhess_sam">[docs]</a><span class="k">def</span> <span class="nf">ssfrhess_sam</span><span class="p">(</span><span class="n">mstar</span><span class="p">,</span> <span class="n">ssfr</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
                 <span class="n">mmin</span><span class="o">=</span><span class="mf">9.027</span><span class="p">,</span> <span class="n">dm</span><span class="o">=</span><span class="mf">0.309</span><span class="p">,</span> <span class="n">nmbins</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                 <span class="n">ssfrmin</span><span class="o">=-</span><span class="mf">13.0</span><span class="p">,</span> <span class="n">ssfrmax</span><span class="o">=-</span><span class="mf">8.5</span><span class="p">,</span> <span class="n">nssfrbins</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                 <span class="n">ssfr_cut</span><span class="o">=-</span><span class="mf">11.1</span><span class="p">,</span> <span class="n">pmax</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">pmin</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    log ssfr in yr</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">mmax</span> <span class="o">=</span> <span class="n">mmin</span> <span class="o">+</span> <span class="n">dm</span> <span class="o">*</span> <span class="n">nmbins</span>
    <span class="n">fpass</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmbins</span><span class="p">)</span>

    <span class="c">#n.b. mbin and fgasbin are the bin CENTERS</span>
    <span class="c">#mbin = mmin + (N.zeros(nmbins)) * dm + dm / 2.0</span>
    <span class="n">dssfr</span> <span class="o">=</span> <span class="p">(</span><span class="n">ssfrmax</span> <span class="o">-</span> <span class="n">ssfrmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nssfrbins</span><span class="p">)</span>
    <span class="c">#ssfrbin = ssfrmin + (N.arange(nssfrbins)) * dssfr + dssfr / 2.0</span>
    <span class="c">#again, this should be rewritten</span>
    <span class="c">#could make a function that several functions could call</span>
    <span class="n">ssfrhist</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nssfrbins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>
    <span class="n">yhist_num</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nssfrbins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>

    <span class="c">#number of halos in each bin</span>
    <span class="n">nh</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmbins</span><span class="p">)</span>

    <span class="n">ssfr</span><span class="p">[</span><span class="n">ssfr</span> <span class="o">&lt;</span> <span class="n">ssfrmin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssfrmin</span> <span class="o">+</span> <span class="mf">0.1</span>

    <span class="c">#compute distributions in stellar mass bins</span>
    <span class="c">#with weight factor</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mstar</span><span class="p">)):</span>
        <span class="n">imbin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">mstar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">imbin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">imbin</span> <span class="o">&lt;</span> <span class="n">nmbins</span><span class="p">:</span>
            <span class="n">nh</span><span class="p">[</span><span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">ssfr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ssfr_cut</span><span class="p">:</span> <span class="n">fpass</span><span class="p">[</span><span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">issfr</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">ssfr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ssfrmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dssfr</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">issfr</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">issfr</span> <span class="o">&lt;</span> <span class="n">nssfrbins</span><span class="p">:</span>
                <span class="n">ssfrhist</span><span class="p">[</span><span class="n">issfr</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">yhist_num</span><span class="p">[</span><span class="n">issfr</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1.</span>

    <span class="n">nhtot</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nh</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">nhtot</span>

    <span class="c">#Make hess plots</span>
    <span class="c">#conditional distributions in Mh bins</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">ssfrhist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ssfrhist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">fpass</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fpass</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ssfrhist</span><span class="p">)</span>
    <span class="n">smax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>
    <span class="n">smin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span>

    <span class="n">s</span><span class="p">[</span><span class="n">ssfrhist</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>
    <span class="n">s</span><span class="p">[</span><span class="n">yhist_num</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>

    <span class="k">print</span> <span class="s">&#39;SSFRhist: &#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ssfrhist</span><span class="p">),</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ssfrhist</span><span class="p">[</span><span class="n">ssfrhist</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">&#39;smin, smax: &#39;</span><span class="p">,</span> <span class="n">smin</span><span class="p">,</span> <span class="n">smax</span>
    <span class="k">print</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">N</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">c</span><span class="p">[</span><span class="n">ssfrhist</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ssfrhist</span><span class="p">[</span><span class="n">ssfrhist</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">])</span>
    <span class="c">#print N.max(c), N.min(c[ssfrhist &gt; 0.0])</span>
    <span class="n">c</span><span class="p">[</span><span class="n">ssfrhist</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.9</span>
    <span class="n">c</span><span class="p">[</span><span class="n">yhist_num</span> <span class="o">&lt;=</span> <span class="mf">2.0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">99.9</span>

    <span class="c">#main sequence and quenched box</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="mf">8.0</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
    <span class="c">#Salim et al.</span>
    <span class="n">ssfr_fit</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.36</span> <span class="o">*</span> <span class="n">mbin</span> <span class="o">-</span> <span class="mf">6.4</span>

    <span class="c">#contour levels</span>
    <span class="n">clev</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.30</span>

    <span class="c">#image</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">smin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">smax</span><span class="p">,</span>
                    <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">ssfrmin</span><span class="p">,</span> <span class="n">ssfrmax</span><span class="p">],</span>
                    <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">clev</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">ssfrmin</span><span class="p">,</span> <span class="n">ssfrmax</span><span class="p">],</span>
                    <span class="n">colors</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span>
                    <span class="n">rightside_up</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">ssfr_fit</span><span class="p">,</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Blue Sequence&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">9.9</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">11.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.95</span><span class="p">],</span> <span class="s">&#39;r-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Red Sequence&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">9.4</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">10.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.25</span><span class="p">],</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Green Valley&#39;</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ssfrmin</span><span class="p">,</span> <span class="n">ssfrmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\log \left( \frac{SFR}{M_{star}} \right)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\log M_{star} \quad [M_{\odot}] $&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ims</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ssfr_wrapper"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.ssfr_wrapper">[docs]</a><span class="k">def</span> <span class="nf">ssfr_wrapper</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="c">#masks</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">gal_id</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">gal_id</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">gal_id</span> <span class="o">!=</span> <span class="mi">1</span>
    <span class="c">#early vs. late type galaxies</span>
    <span class="n">btt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mbulge</span> <span class="o">-</span> <span class="n">prop</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>
    <span class="n">early</span> <span class="o">=</span> <span class="n">btt</span> <span class="o">&gt;=</span> <span class="mf">0.4</span>
    <span class="n">late</span> <span class="o">=</span> <span class="n">btt</span> <span class="o">&lt;</span> <span class="mf">0.4</span>

    <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;ssfr_&#39;</span> <span class="o">+</span> <span class="n">label</span>

    <span class="n">ssfr_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="nb">all</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">ssfr_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39;_cent&#39;</span><span class="p">)</span>
    <span class="n">ssfr_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39;_sat&#39;</span><span class="p">)</span>
    <span class="n">ssfr_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">early</span><span class="p">,</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39;_sph&#39;</span><span class="p">)</span>
    <span class="n">ssfr_plot</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">late</span><span class="p">,</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39;_disk&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="gasfrac_sam_cent"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.gasfrac_sam_cent">[docs]</a><span class="k">def</span> <span class="nf">gasfrac_sam_cent</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span>
                     <span class="n">label</span><span class="o">=</span><span class="s">&#39;Bolshoi&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s">&#39;fgascentral&#39;</span><span class="p">,</span> <span class="n">tpy</span><span class="o">=</span><span class="s">&#39;.pdf&#39;</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="n">tpy</span>

    <span class="n">fgas</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">prop</span><span class="o">.</span><span class="n">mcold</span> <span class="o">/</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">**</span> <span class="n">prop</span><span class="o">.</span><span class="n">mcold</span> <span class="o">+</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">prop</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>
    <span class="n">wgal</span> <span class="o">=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">prop</span><span class="o">.</span><span class="n">halo_id</span><span class="p">]</span>
    <span class="n">btt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mbulge</span> <span class="o">-</span> <span class="n">prop</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>
    <span class="c">#masking</span>
    <span class="n">cdisk</span> <span class="o">=</span> <span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">gal_id</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">btt</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="n">gasfrac_hess</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">mstar</span><span class="p">[</span><span class="n">cdisk</span><span class="p">],</span> <span class="n">fgas</span><span class="p">[</span><span class="n">cdisk</span><span class="p">],</span> <span class="n">wgal</span><span class="p">[</span><span class="n">cdisk</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="fix"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.fix">[docs]</a><span class="k">def</span> <span class="nf">fix</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    IDL function.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="massmet_hess"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.massmet_hess">[docs]</a><span class="k">def</span> <span class="nf">massmet_hess</span><span class="p">(</span><span class="n">mstar</span><span class="p">,</span> <span class="n">met</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span>
                 <span class="n">mmin</span><span class="o">=</span><span class="mf">8.8</span><span class="p">,</span> <span class="n">mmax</span><span class="o">=</span><span class="mf">12.4</span><span class="p">,</span> <span class="n">nmbins</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
                 <span class="n">Zmin</span><span class="o">=-</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">Zmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nzbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pmin</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="c">#n.b. mbin and zbin are the bin CENTERS</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmax</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nmbins</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="n">mmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nmbins</span><span class="p">))</span> <span class="o">*</span> <span class="n">dm</span> <span class="o">+</span> <span class="n">dm</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">dmet</span> <span class="o">=</span> <span class="p">(</span><span class="n">Zmax</span> <span class="o">-</span> <span class="n">Zmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nzbins</span>
    <span class="c">#metbin = Zmin + (N.arange(nzbins)) * dmet + dmet / 2.0</span>

    <span class="n">methist</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nzbins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>
    <span class="n">num</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nzbins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>
    <span class="n">nh</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nmbins</span><span class="p">)</span>

    <span class="c">#compute gas distributions in stellar mass bins</span>
    <span class="c">#with weight factor</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mstar</span><span class="p">)):</span>
        <span class="n">imbin</span> <span class="o">=</span> <span class="n">fix</span><span class="p">((</span><span class="n">mstar</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imbin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">imbin</span> <span class="o">&lt;</span> <span class="n">nmbins</span><span class="p">:</span>
            <span class="n">nh</span><span class="p">[</span><span class="n">imbin</span><span class="p">]</span> <span class="o">=</span> <span class="n">nh</span><span class="p">[</span><span class="n">imbin</span><span class="p">]</span> <span class="o">+</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">imet</span> <span class="o">=</span> <span class="n">fix</span><span class="p">((</span><span class="n">met</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">Zmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dmet</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">imet</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">imet</span> <span class="o">&lt;</span> <span class="n">nzbins</span><span class="p">:</span>
                <span class="n">methist</span><span class="p">[</span><span class="n">imet</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">num</span><span class="p">[</span><span class="n">imet</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c">#conditional distributions in Mh bins</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmbins</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">methist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">nh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">methist</span><span class="p">)</span>
    <span class="n">smax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>
    <span class="n">smin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span>

    <span class="n">s</span><span class="p">[</span><span class="n">methist</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>
    <span class="n">s</span><span class="p">[</span><span class="n">num</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>

    <span class="c">#medians</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">met</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
    <span class="n">mbin_mid</span><span class="p">,</span> <span class="n">y50</span><span class="p">,</span> <span class="n">y16</span><span class="p">,</span> <span class="n">y84</span> <span class="o">=</span> <span class="n">perc_bin</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mstar</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">met</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

    <span class="c">#gallazzi</span>
    <span class="n">mstar</span><span class="p">,</span> <span class="n">z_50</span><span class="p">,</span> <span class="n">z_16</span><span class="p">,</span> <span class="n">z_84</span> <span class="o">=</span> <span class="n">metallicity</span><span class="o">.</span><span class="n">gallazzi</span><span class="p">(</span><span class="n">h</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="c">#image</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">smin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">smax</span><span class="p">,</span>
                    <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">Zmin</span><span class="p">,</span> <span class="n">Zmax</span><span class="p">],</span>
                    <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mstar</span><span class="p">,</span> <span class="n">z_50</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median from Gallazzi et al.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mstar</span><span class="p">,</span> <span class="n">z_16</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mstar</span><span class="p">,</span> <span class="n">z_84</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y50</span><span class="p">),</span> <span class="s">&#39;c-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median from Data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y16</span><span class="p">),</span> <span class="s">&#39;c--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_mid</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">y84</span><span class="p">),</span> <span class="s">&#39;c--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="mf">10.7</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">Zmin</span><span class="p">,</span> <span class="n">Zmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} \left( \frac{Z}{Z_{\odot}} \right)$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\log_{10} M_{star} \quad [M_{\odot}] $&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ims</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="massmet_star"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.massmet_star">[docs]</a><span class="k">def</span> <span class="nf">massmet_star</span><span class="p">(</span><span class="n">halos</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;.pdf&#39;</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;massmet_star_&#39;</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="n">typ</span>
    <span class="n">mbar</span> <span class="o">=</span> <span class="p">(</span><span class="mf">10.0</span> <span class="o">**</span> <span class="n">p</span><span class="o">.</span><span class="n">mcold</span> <span class="o">+</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">p</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>
    <span class="c">#fg = 10.0 ** p.mcold / mbar</span>

    <span class="n">wgal</span> <span class="o">=</span> <span class="n">halos</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">halo_id</span><span class="p">]</span>
    <span class="c">#massmet_hess</span>
    <span class="n">massmet_hess</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">mstar</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">zstar</span><span class="p">),</span> <span class="n">wgal</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="mbh_hess"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.mbh_hess">[docs]</a><span class="k">def</span> <span class="nf">mbh_hess</span><span class="p">(</span><span class="n">mbulge</span><span class="p">,</span> <span class="n">mbh</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">nybins</span><span class="p">,</span>
             <span class="n">mbin_fit</span><span class="p">,</span> <span class="n">mbh_fit</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span>
             <span class="n">mmin</span><span class="o">=</span><span class="mf">8.0</span><span class="p">,</span> <span class="n">mmax</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">nmbins</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
             <span class="n">pmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pmin</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
    <span class="c">#n.b. mbin and fgasbin are the bin CENTERS</span>
    <span class="n">dm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmax</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nmbins</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="n">mmin</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nmbins</span><span class="p">)</span> <span class="o">*</span> <span class="n">dm</span> <span class="o">+</span> <span class="n">dm</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">nybins</span>
    <span class="c">#ybin = ymin + N.arange(nybins) * dy + dy / 2.0</span>

    <span class="n">yhist</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nybins</span><span class="p">,</span> <span class="n">nmbins</span><span class="p">))</span>

    <span class="c">#distributions in bins with weight factor</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mbulge</span><span class="p">)):</span>
        <span class="n">imbin</span> <span class="o">=</span> <span class="n">fix</span><span class="p">((</span><span class="n">mbulge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">imbin</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">imbin</span> <span class="o">&lt;</span> <span class="n">nmbins</span><span class="p">:</span>
            <span class="n">iy</span> <span class="o">=</span> <span class="n">fix</span><span class="p">((</span><span class="n">mbh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iy</span> <span class="o">&lt;</span> <span class="n">nybins</span><span class="p">:</span>
                <span class="n">yhist</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">imbin</span><span class="p">]</span> <span class="o">+=</span> <span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c">#conditional distributions in Mh bins</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nmbins</span><span class="p">):</span>
        <span class="n">pm</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yhist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">pm</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">yhist</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">/=</span> <span class="n">pm</span>

    <span class="k">print</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">yhist</span><span class="p">),</span> <span class="n">N</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">yhist</span><span class="p">)</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">yhist</span><span class="p">)</span>
    <span class="n">smax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmin</span><span class="p">)</span>
    <span class="n">smin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pmax</span><span class="p">)</span>
    <span class="n">s</span><span class="p">[</span><span class="n">yhist</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">smax</span>

    <span class="c">#medians</span>
    <span class="n">mbin</span><span class="p">,</span> <span class="n">y50</span><span class="p">,</span> <span class="n">y16</span><span class="p">,</span> <span class="n">y84</span> <span class="o">=</span> <span class="n">perc_bin</span><span class="p">(</span><span class="n">mbin</span><span class="p">,</span> <span class="n">mbulge</span><span class="p">,</span> <span class="n">mbh</span><span class="p">)</span>

    <span class="c">#haering_rix</span>
    <span class="n">m_bulge</span><span class="p">,</span> <span class="n">m_bh</span><span class="p">,</span> <span class="n">ellip</span><span class="p">,</span> <span class="n">spiral</span><span class="p">,</span> <span class="n">S0</span> <span class="o">=</span> <span class="n">bh</span><span class="o">.</span><span class="n">MassesHaeringRix</span><span class="p">()</span>

    <span class="c">#image</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
    <span class="n">ims</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">smin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">smax</span><span class="p">,</span>
                    <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>
                    <span class="n">interpolation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span>
                    <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_fit</span><span class="p">,</span> <span class="n">mbh_fit</span><span class="p">,</span> <span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Fit?&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_fit</span><span class="p">,</span> <span class="n">mbh_fit</span> <span class="o">+</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin_fit</span><span class="p">,</span> <span class="n">mbh_fit</span> <span class="o">-</span> <span class="o">.</span><span class="mi">3</span><span class="p">,</span> <span class="s">&#39;g--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">[</span><span class="n">y50</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="n">y50</span><span class="p">[</span><span class="n">y50</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="s">&#39;c-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Median Data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">[</span><span class="n">y16</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="n">y16</span><span class="p">[</span><span class="n">y16</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="s">&#39;c--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mbin</span><span class="p">[</span><span class="n">y84</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="n">y84</span><span class="p">[</span><span class="n">y84</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">99</span><span class="p">],</span> <span class="s">&#39;c--&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bulge</span><span class="p">[</span><span class="n">ellip</span><span class="p">],</span> <span class="n">m_bh</span><span class="p">[</span><span class="n">ellip</span><span class="p">],</span> <span class="s">&#39;rs&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Ellipticals&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bulge</span><span class="p">[</span><span class="n">spiral</span><span class="p">],</span> <span class="n">m_bh</span><span class="p">[</span><span class="n">spiral</span><span class="p">],</span> <span class="s">&#39;bp&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;Spirals&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_bulge</span><span class="p">[</span><span class="n">S0</span><span class="p">],</span> <span class="n">m_bh</span><span class="p">[</span><span class="n">S0</span><span class="p">],</span> <span class="s">&#39;mD&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">1.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">&#39;S0&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\log_{10} M_{BH} \quad [M_{\odot}]$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$\log_{10} M_{bulge} \quad [M_{\odot}] $&#39;</span><span class="p">)</span>
    <span class="c">#cbar = fig.colorbar(ims, orientation=&#39;horizontal&#39;)</span>
    <span class="c">#small ticks</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">yminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">yminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">yminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">yminorFormattor</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">xminorLocator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="n">m</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">xminorFormattor</span> <span class="o">=</span> <span class="n">NullFormatter</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">xminorLocator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_formatter</span><span class="p">(</span><span class="n">xminorFormattor</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;best&#39;</span><span class="p">,</span>
                 <span class="n">shadow</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="mhb"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.mhb">[docs]</a><span class="k">def</span> <span class="nf">mhb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">obs</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;mbh_&#39;</span> <span class="o">+</span> <span class="n">label</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span>

    <span class="n">mbin_fit</span> <span class="o">=</span> <span class="mf">8.0</span> <span class="o">+</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
    <span class="n">mbh_fit</span> <span class="o">=</span> <span class="mf">8.2</span> <span class="o">+</span> <span class="mf">1.12</span> <span class="o">*</span> <span class="p">(</span><span class="n">mbin_fit</span> <span class="o">-</span> <span class="mf">11.0</span><span class="p">)</span>

    <span class="c">#central = p.gal_id == 1</span>
    <span class="n">btt</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">mbulge</span> <span class="o">-</span> <span class="n">p</span><span class="o">.</span><span class="n">mstar</span><span class="p">)</span>

    <span class="c">#These could be changed to 0.4 and 0.6...</span>
    <span class="n">early</span> <span class="o">=</span> <span class="n">btt</span> <span class="o">&gt;=</span> <span class="mf">0.5</span>
    <span class="n">late</span> <span class="o">=</span> <span class="n">btt</span> <span class="o">&lt;=</span> <span class="mf">0.5</span>
    <span class="k">print</span> <span class="s">&#39;Number of galaxies </span><span class="si">%i</span><span class="s">, early types </span><span class="si">%i</span><span class="s"> and late </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">mstar</span><span class="p">[</span><span class="n">early</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">mstar</span><span class="p">[</span><span class="n">late</span><span class="p">]))</span>

    <span class="c">#mbin = 8.0 + ((11.8 - 8.0) / 19.0) * N.arange(19)</span>
    <span class="c">#mbh_hr = 8.2 + 1.12 * (p.mbulge - 11.0)</span>

    <span class="n">wgal</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">halo_id</span><span class="p">]</span>

    <span class="n">mbh_hess</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">mbulge</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">mbh</span><span class="p">,</span> <span class="n">wgal</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span>
             <span class="n">mbin_fit</span><span class="p">,</span> <span class="n">mbh_fit</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">obs</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../../SamPy.bolshoi.html#SamPy.bolshoi.generateTestPlots.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Driver function, call this with a path to the data,</span>
<span class="sd">    and label you wish to use for the files.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#paths</span>
    <span class="n">obs_data</span> <span class="o">=</span> <span class="s">&quot;{0:&gt;s}/Dropbox/Research/Observations/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">))</span>

    <span class="c">#read data from path</span>
    <span class="n">g</span><span class="p">,</span> <span class="n">gdust</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">GFBasicData</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="c">#plots</span>
    <span class="n">fstar_plot</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">massfunc_plot</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
    <span class="n">gasfrac_sam_cent</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
    <span class="n">ssfr_wrapper</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">massmet_star</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
    <span class="n">mhb</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>

</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">#Find all the folders to be plotted</span>
    <span class="n">fnd</span> <span class="o">=</span> <span class="s">&#39;/Users/niemi/Desktop/Research/run/newtree*&#39;</span>

    <span class="c">#should the files be overwritten or not?</span>
    <span class="n">overWrite</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c">#labeling</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Bolshoi&#39;</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">fnd</span><span class="p">)</span>
    <span class="c">#loop over the files found from the path</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">overWrite</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Plotting data from </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">main</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.pdf&#39;</span><span class="p">):</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s">&#39;./&#39;</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">last</span><span class="p">):</span>
                <span class="k">print</span> <span class="s">&#39;Plotting data from </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">path</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
                <span class="n">main</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.pdf&#39;</span><span class="p">):</span>
                    <span class="n">new_name</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="s">&#39;.pdf&#39;</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="s">&#39;./&#39;</span> <span class="o">+</span> <span class="n">last</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Sami-Matias Niemi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.5.
    </div>
  </body>
</html>