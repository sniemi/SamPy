

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SamPy.herschel.plotnumbercounts &mdash; SamPy v0.1 documentation</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="top" title="SamPy v0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for SamPy.herschel.plotnumbercounts</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="c">#matplotlib.use(&#39;PS&#39;)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;AGG&#39;</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;text&#39;</span><span class="p">,</span> <span class="n">usetex</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span> 
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s">&#39;axes&#39;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.2</span><span class="p">)</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;legend.handlelength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">P</span>
<span class="kn">import</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">os</span>
<span class="c">#Sami&#39;s repo</span>
<span class="kn">import</span> <span class="nn">db.sqlite</span>
<span class="kn">import</span> <span class="nn">smnIO.sextutils</span> <span class="kn">as</span> <span class="nn">sex</span>

<div class="viewcode-block" id="diff_function"><a class="viewcode-back" href="../../../SamPy.herschel.html#SamPy.herschel.plotnumbercounts.diff_function">[docs]</a><span class="k">def</span> <span class="nf">diff_function</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                  <span class="n">wgth</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mmax</span> <span class="o">=</span> <span class="mf">15.5</span><span class="p">,</span> <span class="n">mmin</span> <span class="o">=</span> <span class="mf">9.0</span><span class="p">,</span>
                  <span class="n">nbins</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span> <span class="n">nvols</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">physical_units</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates a differential function from data.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#number of galaxies</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ngal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ngal</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="n">column</span><span class="p">])</span>
    
    <span class="c">#if data are in physical units or not, use h</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">physical_units</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mf">1.0</span>
    
    <span class="c">#if wgth is None then make weights based on the volume etc.</span>
    <span class="k">if</span> <span class="n">wgth</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ngal</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">nvols</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="n">wgth</span>

    <span class="c">#if log have been taken from the data or not</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">log</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="n">column</span><span class="p">])</span>
        <span class="n">mmin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mmin</span><span class="p">)</span>
        <span class="n">mmax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mmax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">column</span><span class="p">]</span>   

    <span class="c">#bins </span>
    <span class="n">dm</span> <span class="o">=</span> <span class="p">(</span><span class="n">mmax</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">mbin</span> <span class="o">=</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">dm</span> <span class="o">+</span> <span class="n">mmin</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Number of galaxies = </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">ngal</span>
        <span class="k">print</span> <span class="s">&#39;min = </span><span class="si">%f</span><span class="s">, max = </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mmin</span><span class="p">,</span> <span class="n">mmax</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;df =&#39;</span><span class="p">,</span> <span class="n">dm</span>
        <span class="k">print</span> <span class="s">&#39;h =&#39;</span><span class="p">,</span> <span class="n">h</span>

    <span class="c">#mass function</span>
    <span class="n">mf</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
    
    <span class="c">#find out bins</span>
    <span class="n">ibin</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">d</span> <span class="o">-</span> <span class="n">mmin</span><span class="p">)</span><span class="o">/</span><span class="n">dm</span><span class="p">)</span>

    <span class="c">#make a mask of suitable bins</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ibin</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ibin</span> <span class="o">&lt;</span> <span class="n">nbins</span><span class="p">)</span>

    <span class="c">#calculate the sum in each bin</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nbins</span><span class="p">):</span>
        <span class="n">mf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">ibin</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">nu</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ibin</span><span class="p">[</span><span class="n">ibin</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Results:</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">mbin</span>
        <span class="k">print</span> <span class="n">mf</span> <span class="o">/</span> <span class="n">dm</span>
        <span class="k">print</span> <span class="n">nu</span>
    <span class="k">return</span> <span class="n">mbin</span><span class="p">,</span> <span class="n">mf</span> <span class="o">/</span> <span class="n">dm</span><span class="p">,</span> <span class="n">nu</span>
 </div>
<div class="viewcode-block" id="plot_number_counts"><a class="viewcode-back" href="../../../SamPy.herschel.html#SamPy.herschel.plotnumbercounts.plot_number_counts">[docs]</a><span class="k">def</span> <span class="nf">plot_number_counts</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">,</span>
                       <span class="n">out_folder</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span>
                       <span class="n">area</span> <span class="o">=</span> <span class="mf">2.25</span><span class="p">,</span>
                       <span class="n">ymin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span>
                       <span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                       <span class="n">nbins</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
                       <span class="n">write_out</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    160 (arcminutes squared) = 0.0444444444 square degrees</span>
<span class="sd">    Simulation was 10 times the GOODS realization, so</span>
<span class="sd">    area = 0.44444444, thus, the weighting is 1/0.44444444</span>
<span class="sd">    i.e. 2.25.</span>
<span class="sd">    @param sigma: sigma level of the errors to be plotted</span>
<span class="sd">    @param nbins: number of bins (for simulated data)</span>
<span class="sd">    @param area: actually 1 / area, used to weight galaxies</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#fudge factor to handle errors that are way large</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="n">ymin</span>

    <span class="c">#The 10-5 square degrees number of rows in the plot</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">#len(band) / columns</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c">#pacs 70 has only two digits</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

    <span class="c">#get data and convert to mJy</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR</span>
<span class="s">               where FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

    <span class="c">#weight each galaxy</span>
    <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>

    <span class="c">#make the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="mf">0.09</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c">#calculate the differential number density</span>
    <span class="c">#with log binning</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                              <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                              <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                              <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                              <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
    <span class="c">#get the knots</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
    <span class="c">#chain rule swap to dN/dS</span>
    <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
    <span class="c"># = 1 / (S*ln(10)) </span>
    <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="c">#Euclidean-normalization S**2.5</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
    
    <span class="c">#plot the knots</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;ko&#39;</span><span class="p">)</span>

    <span class="c">#poisson error</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
    <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
<span class="c">#    s0 = ax.fill_between(x[mask], up, lw, alpha = 0.2)</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#728FCE&#39;</span><span class="p">)</span>
    
    <span class="c">#write to the file if needed, using appending so might get long...</span>
    <span class="k">if</span> <span class="n">write_out</span><span class="p">:</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s">&#39;outputTotal.txt&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span><span class="n">band</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#S[mjy]     dN/dSxS**2.5[deg**-2 mJy**1.5] high low</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span> <span class="p">,</span><span class="n">lw</span><span class="p">):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#add annotation</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
               <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

    <span class="c">#plot observational contrains</span>
    <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri100&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="c">#yerr = [how much to take away from the y, how much to add to y]</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                         <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri160&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                         <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;spire250&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="c">#Glenn et al results</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>    
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                         <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    <span class="k">if</span> <span class="s">&#39;spire350&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                         <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    <span class="k">if</span> <span class="s">&#39;spire500&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                          <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                          <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    

    <span class="c">#set scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="c">#legend</span>
    <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#728FCE&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a0</span><span class="p">),</span> 
                 <span class="p">(</span><span class="s">&#39;Our Model&#39;</span><span class="p">,</span> <span class="n">sline</span><span class="p">,</span> <span class="s">&#39;Berta et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Altieri et al. 2010&#39;</span><span class="p">),</span> 
                  <span class="s">&#39;lower left&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;spire&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#728FCE&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">g0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c0</span><span class="p">),</span> 
                 <span class="p">(</span><span class="s">&#39;Our Model&#39;</span><span class="p">,</span> <span class="n">sline</span><span class="p">,</span> <span class="s">&#39;Glenn et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Clements et al. 2010&#39;</span><span class="p">),</span> 
                  <span class="s">&#39;lower left&#39;</span><span class="p">)</span>

    <span class="c">#redshift limited plots</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">red</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">redshifts</span><span class="p">):</span>
        <span class="c">#get data and convert to mJy</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR </span>
<span class="s">                   where </span><span class="si">%s</span><span class="s"> and FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

        <span class="c">#modify redshift string</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">rtitle</span> <span class="o">=</span> <span class="s">r&#39;$</span><span class="si">%s</span><span class="s"> &lt; z \leq </span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

        <span class="c">#weights</span>
        <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>

        <span class="c">#make a subplot</span>
        <span class="n">axs</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="c">#make a histogram</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                                  <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                                  <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                                  <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                                  <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="c">#knots in mjy, no log</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
        <span class="c">#chain rule swap</span>
        <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
        <span class="c"># = 1 / (S*ln(10)) </span>
        <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="c">#Euclidean normalization, S**2.5</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
        
        <span class="c">#plot the knots</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;ko&#39;</span><span class="p">)</span>
        
        <span class="c">#poisson error</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
        <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
        <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
<span class="c">#        axs.fill_between(x[mask], up, lw, alpha = 0.2)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#728FCE&#39;</span><span class="p">)</span>

        
        <span class="c">#write to output</span>
        <span class="k">if</span> <span class="n">write_out</span><span class="p">:</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s">&#39;outputredshiftbin</span><span class="si">%i</span><span class="s">.txt&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span><span class="n">band</span><span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="n">rtitle</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#S[mjy] dN/dS xS**2.5 [deg**-2 mJy**1.5] high low</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">):</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">#add annotation</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">rtitle</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
                     <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

        <span class="c">#add observational constrains</span>
        <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_100um_4_Sami_Niemi_20101126.txt&#39;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_160um_4_Sami_Niemi_20101126.txt&#39;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                            <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        
        <span class="c">#set scales</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="c">#remove unnecessary ticks and add units</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$S_{</span><span class="si">%s</span><span class="s">} \ [\mathrm{mJy}]$&#39;</span> <span class="o">%</span> <span class="n">wave</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{d}N(S_{</span><span class="si">%s</span><span class="s">})}{\mathrm{d}S_{</span><span class="si">%s</span><span class="s">}} \times S_{</span><span class="si">%s</span><span class="s">}^{2.5} \quad [\mathrm{deg}^{-2} \ \mathrm{mJy}^{1.5}]$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>
            
    <span class="c">#save figure</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="s">&#39;numbercounts_</span><span class="si">%s</span><span class="s">.ps&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="plot_number_counts2"><a class="viewcode-back" href="../../../SamPy.herschel.html#SamPy.herschel.plotnumbercounts.plot_number_counts2">[docs]</a><span class="k">def</span> <span class="nf">plot_number_counts2</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">,</span>
                        <span class="n">out_folder</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">goods</span><span class="p">,</span>
                        <span class="n">area</span> <span class="o">=</span> <span class="mf">2.25</span><span class="p">,</span>
                        <span class="n">ymin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span>
                        <span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                        <span class="n">nbins</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
                        <span class="n">write_out</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    160 (arcminutes squared) = 0.0444444444 square degrees</span>
<span class="sd">    Simulation was 10 times the GOODS realization, so</span>
<span class="sd">    area = 0.44444444, thus, the weighting is 1/0.44444444</span>
<span class="sd">    i.e. 2.25.</span>
<span class="sd">    @param sigma: sigma level of the errors to be plotted</span>
<span class="sd">    @param nbins: number of bins (for simulated data)</span>
<span class="sd">    @param area: actually 1 / area, used to weight galaxies</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#fudge factor to handle errors that are way large</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="n">ymin</span>

    <span class="c">#The 10-5 square degrees number of rows in the plot</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c">#pacs 70 has only two digits</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

    <span class="c">#get data and convert to mJy</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR</span>
<span class="s">               where FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

    <span class="c">#weight each galaxy</span>
    <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>

    <span class="c">#make the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="mf">0.09</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c">#calculate the differential number density</span>
    <span class="c">#with log binning</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                              <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                              <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                              <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                              <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
    <span class="c">#get the knots</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
    <span class="c">#chain rule swap to dN/dS</span>
    <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
    <span class="c"># = 1 / (S*ln(10)) </span>
    <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="c">#Euclidean-normalization S**2.5</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
    
    <span class="c">#plot the knots</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;ko&#39;</span><span class="p">)</span>

    <span class="c">#poisson error</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
    <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
<span class="c">#    s0 = ax.fill_between(x[mask], up, lw, alpha = 0.2)</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#728FCE&#39;</span><span class="p">)</span>
    
    <span class="c">#write to the file if needed, using appending so might get long...</span>
    <span class="k">if</span> <span class="n">write_out</span><span class="p">:</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s">&#39;outputTotal.txt&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span><span class="n">band</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#S[mjy]     dN/dSxS**2.5[deg**-2 mJy**1.5] high low</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span> <span class="p">,</span><span class="n">lw</span><span class="p">):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#add annotation</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
               <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

    <span class="c">#plot observational contrains</span>
    <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri100&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="c">#yerr = [how much to take away from the y, how much to add to y]</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                         <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri160&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                         <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;spire250&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="c">#Glenn et al results</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>    
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                         <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    <span class="k">if</span> <span class="s">&#39;spire350&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                         <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    <span class="k">if</span> <span class="s">&#39;spire500&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                          <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                          <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    

    <span class="c">#set scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    <span class="c">#legend</span>
    <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#728FCE&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a0</span><span class="p">),</span> 
                 <span class="p">(</span><span class="s">&#39;Our Model&#39;</span><span class="p">,</span> <span class="n">sline</span><span class="p">,</span> <span class="s">&#39;Berta et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Altieri et al. 2010&#39;</span><span class="p">),</span> 
                  <span class="s">&#39;lower left&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;spire&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#728FCE&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">g0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c0</span><span class="p">),</span> 
                 <span class="p">(</span><span class="s">&#39;Our Model&#39;</span><span class="p">,</span> <span class="n">sline</span><span class="p">,</span> <span class="s">&#39;Glenn et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Clements et al. 2010&#39;</span><span class="p">),</span> 
                  <span class="s">&#39;lower left&#39;</span><span class="p">)</span>

    <span class="c">#redshift limited plots</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">red</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">redshifts</span><span class="p">):</span>
        <span class="c">#get data and convert to mJy</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR </span>
<span class="s">                   where </span><span class="si">%s</span><span class="s"> and FIR.</span><span class="si">%s</span><span class="s"> &lt; 1e6 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>
        <span class="c">#modify redshift string</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">rtitle</span> <span class="o">=</span> <span class="s">r&#39;$</span><span class="si">%s</span><span class="s"> &lt; z \leq </span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="c">#weights</span>
        <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>
        <span class="c">#make a subplot</span>
        <span class="n">axs</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="c">#make a histogram</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                                  <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                                  <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                                  <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                                  <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="c">#knots in mjy, no log</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
        <span class="c">#chain rule swap</span>
        <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
        <span class="c"># = 1 / (S*ln(10)) </span>
        <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="c">#Euclidean normalization, S**2.5</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
        
        <span class="c">#plot the knots</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;ko&#39;</span><span class="p">)</span>
        
        <span class="c">#poisson error</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
        <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
        <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
<span class="c">#        axs.fill_between(x[mask], up, lw, alpha = 0.2)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#728FCE&#39;</span><span class="p">)</span>

        <span class="c">#write to output</span>
        <span class="k">if</span> <span class="n">write_out</span><span class="p">:</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s">&#39;outputredshiftbin</span><span class="si">%i</span><span class="s">.txt&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span><span class="n">band</span><span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="n">rtitle</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#S[mjy] dN/dS xS**2.5 [deg**-2 mJy**1.5] high low</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">):</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#add annotation</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">rtitle</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
                     <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

        <span class="c">#add observational constrains</span>
        <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_100um_4_Sami_Niemi_20101126.txt&#39;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_160um_4_Sami_Niemi_20101126.txt&#39;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                            <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;spire250&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c">#get the GOODS results</span>
                <span class="n">obsGOODS</span> <span class="o">=</span> <span class="n">sex</span><span class="o">.</span><span class="n">se_catalog</span><span class="p">(</span><span class="n">goods</span><span class="p">)</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">obsGOODS</span><span class="o">.</span><span class="n">f250_mjy</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
                <span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">obsGOODS</span><span class="o">.</span><span class="n">f250_mjy</span><span class="p">[</span><span class="n">msk</span><span class="p">])</span>
                <span class="n">wghtsGOODS</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obsGOODS</span><span class="o">.</span><span class="n">f250_mjy</span><span class="p">))</span> <span class="o">+</span> <span class="mf">22.5</span>
                <span class="n">bGOODS</span><span class="p">,</span> <span class="n">nGOODS</span><span class="p">,</span> <span class="n">nuGOODS</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">obsGOODS</span><span class="o">.</span><span class="n">f250_mjy</span><span class="p">[</span><span class="n">msk</span><span class="p">],</span>
                                                         <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghtsGOODS</span><span class="p">[</span><span class="n">msk</span><span class="p">],</span> 
                                                         <span class="n">mmax</span> <span class="o">=</span> <span class="mf">40.0</span><span class="p">,</span>
                                                         <span class="n">mmin</span> <span class="o">=</span> <span class="mf">4.0</span><span class="p">,</span>
                                                         <span class="n">nbins</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
                <span class="n">xGOODS</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">bGOODS</span>
                <span class="n">swp</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">xGOODS</span><span class="p">)</span>
                <span class="n">yGOODS</span> <span class="o">=</span> <span class="n">nGOODS</span><span class="o">*</span><span class="n">swp</span><span class="o">*</span><span class="p">(</span><span class="n">xGOODS</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">nuGOODS</span> <span class="o">&gt;</span> <span class="mi">0</span>
                <span class="n">errGOODS</span> <span class="o">=</span> <span class="n">swp</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">xGOODS</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="mf">22.5</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nuGOODS</span><span class="p">[</span><span class="n">msk</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
                <span class="n">upGOODS</span> <span class="o">=</span> <span class="n">yGOODS</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="o">+</span> <span class="n">errGOODS</span>
                <span class="n">lwGOODS</span> <span class="o">=</span> <span class="n">yGOODS</span><span class="p">[</span><span class="n">msk</span><span class="p">]</span> <span class="o">-</span> <span class="n">errGOODS</span>
                <span class="c">#plot GOODS</span>
                <span class="k">print</span> <span class="n">xGOODS</span><span class="p">,</span> <span class="n">yGOODS</span>
                <span class="n">gds</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">xGOODS</span><span class="p">,</span> <span class="n">yGOODS</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">lwGOODS</span><span class="p">,</span> <span class="n">upGOODS</span><span class="p">],</span>
                                   <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">,</span>
                                   <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">)</span>  
        
        
        <span class="c">#set scales</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="c">#remove unnecessary ticks and add units</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="c">#axs.set_xticks(axs.get_xticks()[1:])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$S_{</span><span class="si">%s</span><span class="s">} \ [\mathrm{mJy}]$&#39;</span> <span class="o">%</span> <span class="n">wave</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{d}N(S_{</span><span class="si">%s</span><span class="s">})}{\mathrm{d}S_{</span><span class="si">%s</span><span class="s">}} \times S_{</span><span class="si">%s</span><span class="s">}^{2.5} \quad [\mathrm{deg}^{-2} \ \mathrm{mJy}^{1.5}]$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>       
    <span class="c">#save figure</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="s">&#39;numbercounts_</span><span class="si">%s</span><span class="s">.ps&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="plot_number_counts3"><a class="viewcode-back" href="../../../SamPy.herschel.html#SamPy.herschel.plotnumbercounts.plot_number_counts3">[docs]</a><span class="k">def</span> <span class="nf">plot_number_counts3</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">,</span>
                        <span class="n">out_folder</span><span class="p">,</span> <span class="n">obs_data</span><span class="p">,</span> <span class="n">goods</span><span class="p">,</span>
                        <span class="n">area</span> <span class="o">=</span> <span class="mf">2.25</span><span class="p">,</span>
                        <span class="n">ymin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span>
                        <span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                        <span class="n">nbins</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
                        <span class="n">write_out</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    160 (arcminutes squared) = 0.0444444444 square degrees</span>
<span class="sd">    Simulation was 10 times the GOODS realization, so</span>
<span class="sd">    area = 0.44444444, thus, the weighting is 1/0.44444444</span>
<span class="sd">    i.e. 2.25.</span>
<span class="sd">    @param sigma: sigma level of the errors to be plotted</span>
<span class="sd">    @param nbins: number of bins (for simulated data)</span>
<span class="sd">    @param area: actually 1 / area, used to weight galaxies</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#fudge factor to handle errors that are way large</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="n">ymin</span>

    <span class="c">#The 10-5 square degrees number of rows in the plot</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">#len(band) / columns</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c">#pacs 70 has only two digits</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

    <span class="c">#get data and convert to mJy</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR</span>
<span class="s">               where FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

    <span class="c">#weight each galaxy</span>
    <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>
    
    <span class="c">#make the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="mf">0.09</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.03</span><span class="p">,</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c">#calculate the differential number density</span>
    <span class="c">#with log binning</span>
    <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                              <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                              <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                              <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                              <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
    <span class="c">#get the knots</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
    <span class="c">#chain rule swap to dN/dS</span>
    <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
    <span class="c"># = 1 / (S*ln(10)) </span>
    <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
    <span class="c">#Euclidean-normalization S**2.5</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
    
    <span class="c">#plot the knots</span>
    <span class="n">z0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;ko&#39;</span><span class="p">)</span>

    <span class="c">#poisson error</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
    <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
<span class="c">#    s0 = ax.fill_between(x[mask], up, lw, alpha = 0.2)</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#728FCE&#39;</span><span class="p">)</span>
    
    <span class="c">#write to the file if needed, using appending so might get long...</span>
    <span class="k">if</span> <span class="n">write_out</span><span class="p">:</span>
        <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s">&#39;outputTotal.txt&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span><span class="n">band</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#S[mjy]     dN/dSxS**2.5[deg**-2 mJy**1.5] high low</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span> <span class="p">,</span><span class="n">lw</span><span class="p">):</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">))</span>
        <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c">#add annotation</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
               <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

    <span class="c">#plot observational contrains</span>
    <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri100&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="c">#yerr = [how much to take away from the y, how much to add to y]</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                         <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
        <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri160&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                         <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;spire250&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="c">#Glenn et al results</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                         <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    <span class="k">if</span> <span class="s">&#39;spire350&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                         <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    <span class="k">if</span> <span class="s">&#39;spire500&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
        <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                         <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
        <span class="c">#Clements et al results</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">c0</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                          <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                          <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    

    <span class="c">#set scale</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>

    <span class="c">#legend</span>
    <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#728FCE&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a0</span><span class="p">),</span> 
                 <span class="p">(</span><span class="s">&#39;Our Model&#39;</span><span class="p">,</span> <span class="n">sline</span><span class="p">,</span> <span class="s">&#39;Berta et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Altieri et al. 2010&#39;</span><span class="p">),</span> 
                  <span class="s">&#39;lower left&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;spire&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s">&#39;#728FCE&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span>
        <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
        <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">g0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c0</span><span class="p">),</span> 
                 <span class="p">(</span><span class="s">&#39;Our Model&#39;</span><span class="p">,</span> <span class="n">sline</span><span class="p">,</span> <span class="s">&#39;Glenn et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Clements et al. 2010&#39;</span><span class="p">),</span> 
                  <span class="s">&#39;lower left&#39;</span><span class="p">)</span>

    <span class="c">#redshift limited plots</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">red</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">redshifts</span><span class="p">):</span>
        <span class="c">#get data and convert to mJy</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR </span>
<span class="s">                   where </span><span class="si">%s</span><span class="s"> and FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span>

        <span class="c">#modify redshift string</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">rtitle</span> <span class="o">=</span> <span class="s">r&#39;$</span><span class="si">%s</span><span class="s"> &lt; z \leq </span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>

        <span class="c">#weights</span>
        <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>

        <span class="c">#make a subplot</span>
        <span class="n">axs</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

        <span class="c">#make a histogram</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                                  <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                                  <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                                  <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                                  <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="c">#knots in mjy, no log</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
        <span class="c">#chain rule swap</span>
        <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
        <span class="c"># = 1 / (S*ln(10)) </span>
        <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="c">#Euclidean normalization, S**2.5</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
        
        <span class="c">#plot the knots</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s">&#39;ko&#39;</span><span class="p">)</span>
        
        <span class="c">#poisson error</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
        <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
        <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
<span class="c">#        axs.fill_between(x[mask], up, lw, alpha = 0.2)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;#728FCE&#39;</span><span class="p">)</span>

        
        <span class="c">#write to output</span>
        <span class="k">if</span> <span class="n">write_out</span><span class="p">:</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_folder</span> <span class="o">+</span> <span class="s">&#39;outputredshiftbin</span><span class="si">%i</span><span class="s">.txt&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="o">+</span><span class="n">band</span><span class="o">+</span> <span class="s">&#39;: &#39;</span> <span class="o">+</span> <span class="n">rtitle</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#S[mjy] dN/dS xS**2.5 [deg**-2 mJy**1.5] high low</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">):</span>
                <span class="n">fh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="s"> </span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">cc</span><span class="p">,</span> <span class="n">dd</span><span class="p">))</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c">#add annotation</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">rtitle</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
                     <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

        <span class="c">#add observational constrains</span>
        <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_100um_4_Sami_Niemi_20101126.txt&#39;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                
                <span class="c">#get the GOODS results</span>
<span class="c">#                obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                msk = obsGOODS.f100_mjy &gt; -1</span>
<span class="c">#                print len(obsGOODS.f100_mjy[msk])</span>
<span class="c">#                wghtsGOODS = N.zeros(len(obsGOODS.f100_mjy)) + 22.5</span>
<span class="c">#                bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f100_mjy[msk],</span>
<span class="c">#                                                         wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                         mmax = 15,</span>
<span class="c">#                                                         mmin = 1.1,</span>
<span class="c">#                                                         nbins = 6)</span>
<span class="c">#                xGOODS = 10**bGOODS</span>
<span class="c">#                swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                msk = nuGOODS &gt; 0</span>
<span class="c">#                errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                #plot GOODS</span>
<span class="c">#                print xGOODS, yGOODS</span>
<span class="c">#                gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                   ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                   c = &#39;black&#39;, marker = &#39;D&#39;)</span>
                
                
        <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_160um_4_Sami_Niemi_20101126.txt&#39;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                            <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="c">#get the GOODS results</span>
<span class="c">#                obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                msk = obsGOODS.f160_mjy &gt; -1</span>
<span class="c">#                print len(obsGOODS.f160_mjy[msk])</span>
<span class="c">#                wghtsGOODS = N.zeros(len(obsGOODS.f160_mjy)) + 22.5</span>
<span class="c">#                bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f160_mjy[msk],</span>
<span class="c">#                                                         wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                         mmax = 30,</span>
<span class="c">#                                                         mmin = 4,</span>
<span class="c">#                                                         nbins = 6)</span>
<span class="c">#                xGOODS = 10**bGOODS</span>
<span class="c">#                swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                msk = nuGOODS &gt; 0</span>
<span class="c">#                errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                #plot GOODS</span>
<span class="c">#                print xGOODS, yGOODS</span>
<span class="c">#                gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                   ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                   c = &#39;black&#39;, marker = &#39;D&#39;)</span>
        
        <span class="c">#set scales</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="c">#remove unnecessary ticks and add units</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$S_{</span><span class="si">%s</span><span class="s">} \ [\mathrm{mJy}]$&#39;</span> <span class="o">%</span> <span class="n">wave</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{d}N(S_{</span><span class="si">%s</span><span class="s">})}{\mathrm{d}S_{</span><span class="si">%s</span><span class="s">}} \times S_{</span><span class="si">%s</span><span class="s">}^{2.5} \quad [\mathrm{deg}^{-2} \ \mathrm{mJy}^{1.5}]$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>
            
    <span class="c">#save figure</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="s">&#39;numbercounts3_</span><span class="si">%s</span><span class="s">.ps&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="plotTemplateComparison"><a class="viewcode-back" href="../../../SamPy.herschel.html#SamPy.herschel.plotnumbercounts.plotTemplateComparison">[docs]</a><span class="k">def</span> <span class="nf">plotTemplateComparison</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">,</span>
                           <span class="n">ymin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="p">,</span>
                           <span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
                           <span class="n">nbins</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">):</span>
    <span class="n">hm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">)</span>
    <span class="c">#constants</span>
    <span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/runs/ce01/&#39;</span><span class="p">,</span>
            <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/runs/cp11/&#39;</span><span class="p">,</span>
            <span class="c">#hm + &#39;/Research/Herschel/runs/big_volume/&#39;]</span>
            <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/runs/reds_zero_dust_evolve/&#39;</span><span class="p">]</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/plots/number_counts/&#39;</span>
    <span class="n">ar</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.25</span><span class="p">,</span> <span class="c">#10 times goods</span>
          <span class="mf">2.25</span><span class="p">,</span> <span class="c">#10 times goods</span>
          <span class="c">#0.225] #big volume</span>
          <span class="mf">2.25</span><span class="p">]</span> <span class="c">#10 times goods</span>
    <span class="c">#obs data</span>
    <span class="n">obs_data</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/obs_data/&#39;</span>
    <span class="c">#GOODS observations, file given by Kuang</span>
    <span class="n">goods</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/obs_data/goodsh_goodsn_allbands_z2-4.cat&#39;</span>
    
    <span class="c">#fudge factor to handle errors that are way large</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="n">ymin</span>

    <span class="c">#The 10-5 square degrees number of rows in the plot</span>
    <span class="k">if</span> <span class="s">&#39;pacs&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="mi">3</span> <span class="c">#len(band) / columns</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c">#pacs 70 has only two digits</span>
        <span class="n">wave</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;\d\d&#39;</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>

    <span class="c">#make the figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span><span class="c">#figsize = (13,13))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="mf">0.09</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
                        <span class="n">right</span> <span class="o">=</span> <span class="mf">0.98</span><span class="p">,</span> <span class="n">top</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c">#add annotation</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s">&#39;Total&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
                <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">ttle</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sss</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#loop over the models</span>
    <span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">area</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">ar</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">]):</span>
        <span class="k">print</span> <span class="n">p</span>
        <span class="c">#get data and convert to mJy</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR</span>
<span class="s">                   where FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span>
    
        <span class="c">#weight each galaxy</span>
        <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>
            
        <span class="c">#calculate the differential number density</span>
        <span class="c">#with log binning</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                                  <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                                  <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                                  <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                                  <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
        <span class="c">#get the knots</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
        <span class="c">#chain rule swap to dN/dS</span>
        <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
        <span class="c"># = 1 / (S*ln(10)) </span>
        <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="c">#Euclidean-normalization S**2.5</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
        
        <span class="c">#plot the knots</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
    
        <span class="c">#poisson error</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
        <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
        <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
        <span class="n">s0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                             <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>
    
        <span class="c">#plot observational contrains</span>
        <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri100&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
            <span class="c">#yerr = [how much to take away from the y, how much to add to y]</span>
            <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                             <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;BertaResults&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
            <span class="n">b0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Altieri160&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">high</span> <span class="o">=</span> <span class="n">a</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span>
            <span class="n">low</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">a0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
                             <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">1.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;spire250&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="c">#Glenn et al results</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="c">#Clements et al results</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements250&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                             <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
        <span class="k">if</span> <span class="s">&#39;spire350&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="c">#Clements et al results</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements350&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">c0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                             <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
        <span class="k">if</span> <span class="s">&#39;spire500&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;GlennResults500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">yp</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">yl</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">])</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mf">2.5</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**-</span><span class="mi">3</span>
            <span class="n">g0</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="n">yl</span><span class="p">,</span> <span class="n">yp</span><span class="o">-</span><span class="n">y</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                             <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
            <span class="c">#Clements et al results</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;Clements500&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">usecols</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">g</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">N</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">c0</span> <span class="o">=</span>  <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span> <span class="o">=</span> <span class="p">[</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                              <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;D&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;magenta&#39;</span><span class="p">,</span>
                              <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">ms</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mew</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>    
    
        <span class="c">#set scale</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
    
        <span class="n">sss</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">))</span>
        <span class="c">#legend</span>
        <span class="k">if</span> <span class="s">&#39;ce01&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">ttle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;CE01&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;cp11&#39;</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">ttle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;CP11&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ttle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;R09&#39;</span><span class="p">)</span>
                
        <span class="c">#redshift limited plots</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">red</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">redshifts</span><span class="p">):</span>
            <span class="c">#get data and convert to mJy</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;select FIR.</span><span class="si">%s</span><span class="s"> from FIR </span>
<span class="s">                       where </span><span class="si">%s</span><span class="s"> and FIR.</span><span class="si">%s</span><span class="s"> &lt; 10000 and FIR.</span><span class="si">%s</span><span class="s"> &gt; 1e-15&#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">band</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
            <span class="n">fluxes</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">sqlite</span><span class="o">.</span><span class="n">get_data_sqlite</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">database</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span>
    
            <span class="c">#modify redshift string</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">red</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">rtitle</span> <span class="o">=</span> <span class="s">r&#39;$</span><span class="si">%s</span><span class="s"> &lt; z \leq </span><span class="si">%s</span><span class="s">$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
    
            <span class="c">#weights</span>
            <span class="n">wghts</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fluxes</span><span class="p">))</span> <span class="o">+</span> <span class="n">area</span>
    
            <span class="c">#make a subplot</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    
            <span class="c">#make a histogram</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span>  <span class="n">diff_function</span><span class="p">(</span><span class="n">fluxes</span><span class="p">,</span>
                                      <span class="n">wgth</span> <span class="o">=</span> <span class="n">wghts</span><span class="p">,</span> 
                                      <span class="n">mmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">,</span>
                                      <span class="n">mmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">,</span>
                                      <span class="n">nbins</span> <span class="o">=</span> <span class="n">nbins</span><span class="p">)</span>
            <span class="c">#knots in mjy, no log</span>
            <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">b</span>
            <span class="c">#chain rule swap</span>
            <span class="c">#d/dS[ log_10(S)] = d/dS[ ln(S) / ln(10)]</span>
            <span class="c"># = 1 / (S*ln(10)) </span>
            <span class="n">swap</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
            <span class="c">#Euclidean normalization, S**2.5</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">n</span><span class="o">*</span><span class="n">swap</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span>
            
            <span class="c">#plot the knots</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
            
            <span class="c">#poisson error</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">swap</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mf">2.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span> <span class="o">*</span> <span class="n">N</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">*</span> <span class="n">sigma</span>
            <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">+</span> <span class="n">err</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">err</span>
            <span class="n">lw</span><span class="p">[</span><span class="n">lw</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">]</span> <span class="o">=</span> <span class="n">ymin</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="n">up</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
                             <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">)</span>
    
            <span class="c">#add annotation</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">rtitle</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.88</span><span class="p">),</span> <span class="n">xycoords</span><span class="o">=</span><span class="s">&#39;axes fraction&#39;</span><span class="p">,</span>
                         <span class="n">ha</span> <span class="o">=</span> <span class="s">&#39;center&#39;</span><span class="p">)</span>
    
            <span class="c">#add observational constrains</span>
            <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_100um_4_Sami_Niemi_20101126.txt&#39;</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                    
<span class="c">#                    #get the GOODS results</span>
<span class="c">#                    obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                    msk = obsGOODS.f100_mjy &gt; -1</span>
<span class="c">#                    #print len(obsGOODS.f100_mjy[msk])</span>
<span class="c">#                    wghtsGOODS = N.zeros(len(obsGOODS.f100_mjy)) + 22.5</span>
<span class="c">#                    bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f100_mjy[msk],</span>
<span class="c">#                                                             wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                             mmax = 15,</span>
<span class="c">#                                                             mmin = 1.1,</span>
<span class="c">#                                                             nbins = 6)</span>
<span class="c">#                    xGOODS = 10**bGOODS</span>
<span class="c">#                    swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                    yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                    msk = nuGOODS &gt; 0</span>
<span class="c">#                    errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                    upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                    lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                    #plot GOODS</span>
<span class="c">#                    #print xGOODS, yGOODS</span>
<span class="c">#                    gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                       ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                       c = &#39;black&#39;, marker = &#39;D&#39;)</span>
                    
            <span class="k">if</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="n">fl</span> <span class="o">=</span> <span class="n">obs_data</span><span class="o">+</span><span class="s">&#39;data_160um_4_Sami_Niemi_20101126.txt&#39;</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fl</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">)</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">up</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">msk</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">10.0</span>
                    <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">][</span><span class="n">msk</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.999</span>
                    <span class="n">lw</span> <span class="o">=</span> <span class="n">y</span><span class="o">*</span><span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="p">[</span><span class="n">lw</span><span class="p">,</span> <span class="n">up</span><span class="p">],</span> <span class="n">ls</span> <span class="o">=</span> <span class="s">&#39;None&#39;</span><span class="p">,</span>
                                 <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">mec</span> <span class="o">=</span> <span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">)</span>
<span class="c">#                    #get the GOODS results</span>
<span class="c">#                    obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                    msk = obsGOODS.f160_mjy &gt; -1</span>
<span class="c">#                    wghtsGOODS = N.zeros(len(obsGOODS.f160_mjy)) + 22.5</span>
<span class="c">#                    bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f160_mjy[msk],</span>
<span class="c">#                                                             wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                             mmax = 30,</span>
<span class="c">#                                                             mmin = 4,</span>
<span class="c">#                                                             nbins = 6)</span>
<span class="c">#                    xGOODS = 10**bGOODS</span>
<span class="c">#                    swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                    yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                    msk = nuGOODS &gt; 0</span>
<span class="c">#                    errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                    upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                    lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                    #plot GOODS</span>
<span class="c">#                    gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                       ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                       c = &#39;black&#39;, marker = &#39;D&#39;)</span>
<span class="c">#            if &#39;spire250&#39; in band and i == 2:</span>
<span class="c">#                #get the GOODS results</span>
<span class="c">#                obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                msk = obsGOODS.f250_mjy &gt; -1</span>
<span class="c">#                wghtsGOODS = N.zeros(len(obsGOODS.f250_mjy)) + 22.5</span>
<span class="c">#                bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f250_mjy[msk],</span>
<span class="c">#                                                         wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                         mmax = 40.0,</span>
<span class="c">#                                                         mmin = 4.0,</span>
<span class="c">#                                                         nbins = 5)</span>
<span class="c">#                xGOODS = 10**bGOODS</span>
<span class="c">#                swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                msk = nuGOODS &gt; 0</span>
<span class="c">#                errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                #plot GOODS</span>
<span class="c">#                gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                   ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                   c = &#39;black&#39;, marker = &#39;D&#39;)</span>
<span class="c">#            if &#39;spire350&#39; in band and i == 2:</span>
<span class="c">#                #get the GOODS results</span>
<span class="c">#                obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                msk = obsGOODS.f350_mjy &gt; -1</span>
<span class="c">#                wghtsGOODS = N.zeros(len(obsGOODS.f350_mjy)) + 22.5</span>
<span class="c">#                bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f350_mjy[msk],</span>
<span class="c">#                                                         wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                         mmax = 66.0,</span>
<span class="c">#                                                         mmin = 6.0,</span>
<span class="c">#                                                         nbins = 4)</span>
<span class="c">#                xGOODS = 10**bGOODS</span>
<span class="c">#                swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                msk = nuGOODS &gt; 0</span>
<span class="c">#                errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                #plot GOODS</span>
<span class="c">#                gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                   ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                   c = &#39;black&#39;, marker = &#39;D&#39;)</span>
<span class="c">#            if &#39;spire500&#39; in band and i == 2:</span>
<span class="c">#                #get the GOODS results</span>
<span class="c">#                obsGOODS = sex.se_catalog(goods)</span>
<span class="c">#                msk = obsGOODS.f500_mjy &gt; -1</span>
<span class="c">#                wghtsGOODS = N.zeros(len(obsGOODS.f500_mjy)) + 22.5</span>
<span class="c">#                bGOODS, nGOODS, nuGOODS =  diff_function(obsGOODS.f500_mjy[msk],</span>
<span class="c">#                                                         wgth = wghtsGOODS[msk],</span>
<span class="c">#                                                         mmax = 60.0,</span>
<span class="c">#                                                         mmin = 5.0,</span>
<span class="c">#                                                         nbins = 3)</span>
<span class="c">#                xGOODS = 10**bGOODS</span>
<span class="c">#                swp = 1. / (N.log(10)*xGOODS)</span>
<span class="c">#                yGOODS = nGOODS*swp*(xGOODS**2.5)</span>
<span class="c">#                msk = nuGOODS &gt; 0</span>
<span class="c">#                errGOODS = swp[msk] * (xGOODS[msk]**2.5) * 22.5 * N.sqrt(nuGOODS[msk]) * sigma</span>
<span class="c">#                upGOODS = yGOODS[msk] + errGOODS</span>
<span class="c">#                lwGOODS = yGOODS[msk] - errGOODS</span>
<span class="c">#                #plot GOODS</span>
<span class="c">#                gds = axs.errorbar(xGOODS, yGOODS, yerr = [lwGOODS, upGOODS],</span>
<span class="c">#                                   ls = &#39;None&#39;, mec = &#39;black&#39;,</span>
<span class="c">#                                   c = &#39;black&#39;, marker = &#39;D&#39;)</span>
            
            <span class="c">#set scales</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
            <span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
    
            
            <span class="k">if</span> <span class="s">&#39;pacs&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="c">#remove unnecessary ticks and add units</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()[</span><span class="mi">1</span><span class="p">:])</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$S_{</span><span class="si">%s</span><span class="s">} \ [\mathrm{mJy}]$&#39;</span> <span class="o">%</span> <span class="n">wave</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{d}N(S_{</span><span class="si">%s</span><span class="s">})}{\mathrm{d}S_{</span><span class="si">%s</span><span class="s">}} \times S_{</span><span class="si">%s</span><span class="s">}^{2.5} \quad [\mathrm{deg}^{-2} \ \mathrm{mJy}^{1.5}]$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>

            <span class="k">if</span> <span class="s">&#39;spire&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="c">#remove unnecessary ticks and add units</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
                    <span class="c">#axs.set_xticks(axs.get_xticks()[1:])</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;$S_{</span><span class="si">%s</span><span class="s">} \ [\mathrm{mJy}]$&#39;</span> <span class="o">%</span> <span class="n">wave</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([])</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;$\frac{\mathrm{d}N(S_{</span><span class="si">%s</span><span class="s">})}{\mathrm{d}S_{</span><span class="si">%s</span><span class="s">}} \times S_{</span><span class="si">%s</span><span class="s">}^{2.5} \quad [\mathrm{deg}^{-2} \ \mathrm{mJy}^{1.5}]$&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">,</span> <span class="n">wave</span><span class="p">))</span>
                    <span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="o">-</span><span class="mf">0.11</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>    
            
        <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="n">path</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s">&#39;pacs100&#39;</span> <span class="ow">in</span> <span class="n">band</span> <span class="ow">or</span> <span class="s">&#39;pacs160&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
                <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">b0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a0</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="c">#, gds),</span>
                         <span class="p">(</span><span class="n">ttle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ttle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ttle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;Berta et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Altieri et al. 2010&#39;</span><span class="p">),</span><span class="c">#, &#39;GOODS-N&#39;),</span>
                          <span class="s">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">shadow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">numpoints</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;spire&#39;</span> <span class="ow">in</span> <span class="n">band</span><span class="p">:</span>
                <span class="n">sline</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%i</span><span class="s">$\sigma$ errors&#39;</span> <span class="o">%</span> <span class="n">sigma</span>
                <span class="n">P</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">sss</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sss</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">g0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c0</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="c">#, gds),</span>
                         <span class="p">(</span><span class="n">ttle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ttle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ttle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&#39;Glenn et al. 2010&#39;</span><span class="p">,</span> <span class="s">&#39;Clements et al. 2010&#39;</span><span class="p">),</span><span class="c">#, &#39;GOODS-N&#39;),</span>
                          <span class="s">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">shadow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">fancybox</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">numpoints</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            
    <span class="c">#save figure</span>
    <span class="n">P</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">out_folder</span><span class="o">+</span><span class="s">&#39;numbercountComparison_</span><span class="si">%s</span><span class="s">.ps&#39;</span> <span class="o">%</span> <span class="n">band</span><span class="p">)</span>
    <span class="n">P</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c">#find the home directory, because the output is to dropbox </span>
    <span class="c">#and my user name is not always the same, this hack is required.</span>
    <span class="n">hm</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">&#39;HOME&#39;</span><span class="p">)</span>

    <span class="c">#modify these as needed</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Research/Herschel/runs/big_volume/&#39;</span>
    <span class="c">#path = hm + &#39;/Dropbox/Research/Herschel/runs/ce01/&#39;</span>
    <span class="c">#path = hm + &#39;/Dropbox/Research/Herschel/runs/cp11/&#39;</span>
    <span class="c">#out_folder = hm + &#39;/Dropbox/Research/Herschel/plots/number_counts/big/&#39;</span>
    <span class="c">#out_folder = hm + &#39;/Dropbox/Research/Herschel/plots/number_counts/ce01/&#39;</span>
    <span class="n">out_folder</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/plots/number_counts/cp11/&#39;</span>
    <span class="c">#area = 0.225 #big volume</span>
    <span class="n">area</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="c">#10 times goods</span>

    <span class="c">#constants, should not require any changes</span>
    <span class="c">#input database name</span>
    <span class="n">database</span> <span class="o">=</span> <span class="s">&#39;sams.db&#39;</span>
    <span class="n">obs_data</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/obs_data/&#39;</span>
    <span class="c">#GOODS-N observations, file given by Kuang</span>
    <span class="n">goods</span> <span class="o">=</span> <span class="n">hm</span> <span class="o">+</span> <span class="s">&#39;/Dropbox/Research/Herschel/obs_data/goodsh_goodsn_allbands_z2-4.cat&#39;</span>

    <span class="c">#5sigma limits of GOODS-N observations given by Kuang</span>
    <span class="n">depths</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;pacs100_obs&#39;</span><span class="p">:</span> <span class="mf">1.7</span><span class="p">,</span>
              <span class="s">&#39;pacs160_obs&#39;</span><span class="p">:</span> <span class="mf">4.5</span><span class="p">,</span>
              <span class="s">&#39;spire250_obs&#39;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span>
              <span class="s">&#39;spire350_obs&#39;</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">,</span>
              <span class="s">&#39;spire500_obs&#39;</span><span class="p">:</span> <span class="mf">10.0</span>
              <span class="p">}</span>

    <span class="c">#passbands to be plotted</span>
    <span class="n">bands</span> <span class="o">=</span> <span class="p">[</span><span class="c">#&#39;pacs70_obs&#39;,</span>
             <span class="s">&#39;pacs100_obs&#39;</span><span class="p">,</span>
             <span class="s">&#39;pacs160_obs&#39;</span><span class="p">,</span>
             <span class="s">&#39;spire250_obs&#39;</span><span class="p">,</span>
             <span class="s">&#39;spire350_obs&#39;</span><span class="p">,</span>
             <span class="s">&#39;spire500_obs&#39;</span><span class="p">]</span>

    <span class="c">#redshift ranges, 2 for SPIRE</span>
    <span class="n">redshifts</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;FIR.z &gt;= 0.0 and FIR.z &lt;= 0.5&#39;</span><span class="p">,</span>
                 <span class="s">&#39;FIR.z &gt; 0.5 and FIR.z &lt;= 1.0&#39;</span><span class="p">,</span>
                 <span class="s">&#39;FIR.z &gt; 1.0 and FIR.z &lt;= 2.0&#39;</span><span class="p">,</span>
                 <span class="s">&#39;FIR.z &gt; 2.0 and FIR.z &lt;= 5.0&#39;</span><span class="p">]</span>
    <span class="n">redshifts2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;FIR.z &gt;= 0.0 and FIR.z &lt;= 1.0&#39;</span><span class="p">,</span>
                  <span class="s">&#39;FIR.z &gt; 1.0 and FIR.z &lt;= 2.0&#39;</span><span class="p">,</span>
                  <span class="s">&#39;FIR.z &gt; 2.0 and FIR.z &lt;= 4.0&#39;</span><span class="p">]</span>

    <span class="k">print</span> <span class="s">&#39;Begin plotting&#39;</span>
    <span class="k">print</span> <span class="s">&#39;Input DB: &#39;</span><span class="p">,</span> <span class="n">path</span> <span class="o">+</span> <span class="n">database</span>
    <span class="k">print</span> <span class="s">&#39;Output folder: &#39;</span><span class="p">,</span> <span class="n">out_folder</span>
    
    <span class="c">#plot the number counts</span>
    <span class="k">for</span> <span class="n">bd</span> <span class="ow">in</span> <span class="n">bands</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;pacs&#39;</span> <span class="ow">in</span> <span class="n">bd</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;plotting &#39;</span><span class="p">,</span> <span class="n">bd</span>
<span class="c">#            plot_number_counts(path, database, bd, redshifts,</span>
<span class="c">#                               out_folder, obs_data,</span>
<span class="c">#                               xmin = 0.1, xmax = 500,</span>
<span class="c">#                               ymin = 1.5*10**2, ymax = 6*10**5,</span>
<span class="c">#                               nbins = 23, sigma = 5.0, area = area)#,</span>
<span class="c">#                               #write_out = True)</span>
<span class="c">#            plot_number_counts3(path, database, bd, redshifts,</span>
<span class="c">#                                out_folder, obs_data, goods,</span>
<span class="c">#                                xmin = 0.1, xmax = 500,</span>
<span class="c">#                                ymin = 1.5*10**2, ymax = 6*10**5,</span>
<span class="c">#                                nbins = 23, sigma = 5.0, area = area)</span>
            <span class="n">plotTemplateComparison</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">redshifts</span><span class="p">,</span>
                                   <span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
                                   <span class="n">ymin</span> <span class="o">=</span> <span class="mf">2e2</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mi">5</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="p">,</span>
                                   <span class="n">nbins</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;spire&#39;</span> <span class="ow">in</span> <span class="n">bd</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;plotting &#39;</span><span class="p">,</span> <span class="n">bd</span>
<span class="c">#            plot_number_counts2(path, database, bd, redshifts2,</span>
<span class="c">#                                out_folder, obs_data, goods,</span>
<span class="c">#                                xmin = 0.11, xmax = 1800,</span>
<span class="c">#                                ymin = 10**2, ymax = 3*10**6,</span>
<span class="c">#                                nbins = 15, sigma = 5.0, area = area)#,</span>
<span class="c">#                                #write_out = True)</span>
            <span class="n">plotTemplateComparison</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">redshifts2</span><span class="p">,</span>
                                   <span class="n">xmin</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="mi">1800</span><span class="p">,</span>
                                   <span class="n">ymin</span> <span class="o">=</span> <span class="mf">7e2</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="mf">8e5</span><span class="p">,</span>
                                   <span class="n">nbins</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;All done...&#39;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Sami-Matias Niemi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>