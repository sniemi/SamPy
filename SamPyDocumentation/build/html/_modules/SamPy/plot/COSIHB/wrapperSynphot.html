

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>SamPy.plot.COSIHB.wrapperSynphot &mdash; SamPy v0.1 documentation</title>
    <link rel="stylesheet" href="../../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="SamPy v0.1 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for SamPy.plot.COSIHB.wrapperSynphot</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">This script works as a wrapper to create plots for the COS instrument handbook.</span>
<span class="sd">Boolean variables in the main program can be set to False to limit the number</span>
<span class="sd">of plots.</span>

<span class="sd">Calculation of zodiacal and earth shine background requires the use of local</span>
<span class="sd">fits files (Zodi.fits and earthshine.fits). If these files cannot be found</span>
<span class="sd">the S/N ration related plots of chapter 15 cannot be done.</span>

<span class="sd">This wrapper should always be accompanied with plotting.py which contains</span>
<span class="sd">a plotting class. This class holds all the plotting functions and is required</span>
<span class="sd">for running this wrapper.</span>

<span class="sd">@note: This wrapper superseeds wrapper.py</span>

<span class="sd">@author: Sami-Matias Niemi (niemi@stsci.edu) for STScI</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s">&#39;Sami-Matias Niemi&#39;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;1.6&#39;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
<span class="kn">import</span> <span class="nn">pyfits</span> <span class="kn">as</span> <span class="nn">PF</span>
<span class="kn">import</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">sys</span>

<div class="viewcode-block" id="calculateSTMAGlim"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.calculateSTMAGlim">[docs]</a><span class="k">def</span> <span class="nf">calculateSTMAGlim</span><span class="p">(</span><span class="n">global_limit</span><span class="p">,</span> <span class="n">grating</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">NUV</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A fugdge factor of 96% for encircled energy fraction is being used.</span>
<span class="sd">    These integration times are so short that we can ignore everything</span>
<span class="sd">    else but source counts.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fudge</span> <span class="o">=</span> <span class="mf">0.96</span> <span class="c">#this is aperture transmission and encircled energy fraction</span>
    <span class="c">#countrate = sensitivity * flux / gain * fudge</span>
    <span class="n">limit</span> <span class="o">=</span> <span class="n">global_limit</span> <span class="o">/</span> <span class="mf">15000.</span> <span class="o">*</span> <span class="mf">1.1</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="n">limit</span> <span class="o">*</span> <span class="n">gain</span> <span class="o">/</span> <span class="p">(</span><span class="n">sensitivity</span> <span class="o">*</span> <span class="n">fudge</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">NUV</span><span class="p">:</span> <span class="n">flux</span> <span class="o">*=</span> <span class="mf">6.</span><span class="o">*</span><span class="mi">2</span>
    <span class="n">stlim</span> <span class="o">=</span> <span class="n">fluxToSTMag</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;STMAG brightness limit is </span><span class="si">%4.2f</span><span class="s"> for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">stlim</span><span class="p">,</span> <span class="n">grating</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stlim</span>
</div>
<div class="viewcode-block" id="getDispersion"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.getDispersion">[docs]</a><span class="k">def</span> <span class="nf">getDispersion</span><span class="p">(</span><span class="n">segment</span><span class="p">,</span> <span class="n">grating</span><span class="p">,</span> <span class="n">cenwave</span><span class="p">,</span> <span class="n">fppos</span><span class="p">,</span> <span class="n">fileData</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Return dispersion relation of a given configuration.</span>
<span class="sd">    &#39;&#39;&#39;</span>  
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fileData</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">segment</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> \
           <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="n">grating</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> \
           <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span> <span class="ow">and</span> \
           <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">cenwave</span><span class="p">:</span> <span class="c">#and  \</span>
           <span class="c">#line[4] == fppos:</span>
           <span class="k">return</span> <span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
           <span class="k">break</span>
    
    <span class="k">return</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,]</span>
</div>
<div class="viewcode-block" id="getZodiacalBackground"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.getZodiacalBackground">[docs]</a><span class="k">def</span> <span class="nf">getZodiacalBackground</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the Zodiacal light background value at given wavelength range.</span>
<span class="sd">    Note: Uses hard coded file Zodi.fits, which must be present in the folder</span>
<span class="sd">    this function is called!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">zodidata</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;Zodi.fits&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;No Zodi.fits file found from your working directory!&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Cannot get an estimate for zodiacal light background... will exit!&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">zodidata</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">wavelength</span> <span class="o">-</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">wavelength</span> <span class="o">+</span> <span class="n">width</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">22.7e-10</span>
</div>
<div class="viewcode-block" id="getEarthShineBackground"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.getEarthShineBackground">[docs]</a><span class="k">def</span> <span class="nf">getEarthShineBackground</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the Earth Shine background value at given wavelength range.</span>
<span class="sd">    Note: Uses hard coded file earthshine.fits, which must be present in the folder</span>
<span class="sd">    this function is called!</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">earthdata</span> <span class="o">=</span> <span class="n">PF</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;earthshine.fits&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;No earthshine.fits file found from your working directory!&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Cannot get an estimate for earth shine background... will exit!&#39;</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>        
    
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">earthdata</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">wavelength</span> <span class="o">-</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">wavelength</span> <span class="o">+</span> <span class="n">width</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">50.0e-10</span>
</div>
<div class="viewcode-block" id="signalToNoise"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.signalToNoise">[docs]</a><span class="k">def</span> <span class="nf">signalToNoise</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">Npix</span><span class="p">,</span> <span class="n">Bsky</span><span class="p">,</span> <span class="n">Bdet</span><span class="p">,</span> <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates signal to noise ratio when following variables are given:</span>
<span class="sd">    sensitivity, flux, exposure time, number of pixels, sky backgound, detector background, and gain.</span>
<span class="sd">    For photon counters gain = 1. Number of pixels is used for the background calculations while the</span>
<span class="sd">    sensitivity is used for calculating the total number of counts. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">sensitivity</span> <span class="o">*</span> <span class="n">flux</span> <span class="o">/</span> <span class="n">gain</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">*</span> <span class="n">time</span>
    <span class="n">down</span> <span class="o">=</span> <span class="p">(</span><span class="n">counts</span> <span class="o">*</span> <span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">Npix</span> <span class="o">*</span> <span class="p">(</span><span class="n">Bsky</span> <span class="o">+</span> <span class="n">Bdet</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="p">)</span>
    <span class="n">SNR</span> <span class="o">=</span> <span class="n">up</span> <span class="o">*</span> <span class="n">down</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SNR</span>
</div>
<div class="viewcode-block" id="signalToNoisePerResel"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.signalToNoisePerResel">[docs]</a><span class="k">def</span> <span class="nf">signalToNoisePerResel</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">resel</span><span class="p">,</span> <span class="n">Bsky</span><span class="p">,</span> <span class="n">Bdet</span><span class="p">,</span> <span class="n">gain</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculates signal to noise ratio using total counts in resolution element.</span>
<span class="sd">    Input:</span>
<span class="sd">    sensitivity, flux, time, resel, Bsky, Bdet, gain = 1.</span>
<span class="sd">    Returns:</span>
<span class="sd">    Signal-to-noise ratio, source counts, source noise, dark current counts, sky, background, total noise</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">sensitivity</span> <span class="o">*</span> <span class="n">flux</span> <span class="o">*</span> <span class="n">resel</span> <span class="o">/</span> <span class="n">gain</span>
    <span class="n">up</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">*</span> <span class="n">time</span>
    <span class="n">dark</span> <span class="o">=</span> <span class="n">Bdet</span> <span class="o">*</span> <span class="n">time</span> <span class="o">*</span> <span class="n">resel</span>
    <span class="n">sky</span> <span class="o">=</span> <span class="n">Bsky</span> <span class="o">*</span> <span class="n">time</span> <span class="o">*</span> <span class="n">resel</span>
    <span class="n">down</span> <span class="o">=</span> <span class="p">(</span><span class="n">counts</span> <span class="o">*</span> <span class="n">time</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">resel</span> <span class="o">*</span> <span class="p">(</span><span class="n">Bsky</span> <span class="o">+</span> <span class="n">Bdet</span><span class="p">)</span> <span class="o">*</span> <span class="n">time</span><span class="p">)</span>
    <span class="n">SNR</span> <span class="o">=</span> <span class="n">up</span> <span class="o">*</span> <span class="n">down</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">SNR</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">up</span><span class="p">),</span> <span class="n">dark</span><span class="p">,</span> <span class="n">sky</span><span class="p">,</span> <span class="n">dark</span> <span class="o">+</span> <span class="n">sky</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dark</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sky</span><span class="p">)</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">up</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="selectSensitivity"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.selectSensitivity">[docs]</a><span class="k">def</span> <span class="nf">selectSensitivity</span><span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">,</span> <span class="n">requiredWave</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns:</span>
<span class="sd">    Mean of the sensitivity within required wavelength region.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span> <span class="p">(</span><span class="n">wavelength</span><span class="p">,</span> <span class="n">sensitivity</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">requiredWave</span> <span class="o">-</span> <span class="n">width</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">requiredWave</span> <span class="o">+</span> <span class="n">width</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="fluxToSTMag"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.fluxToSTMag">[docs]</a><span class="k">def</span> <span class="nf">fluxToSTMag</span><span class="p">(</span><span class="n">flux</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns:</span>
<span class="sd">    NumPy array of ST magnitudes</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">2.5</span><span class="o">*</span><span class="n">N</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flux</span><span class="p">)</span><span class="o">/</span><span class="mf">3.63e-9</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="STMagToFlux"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.STMagToFlux">[docs]</a><span class="k">def</span> <span class="nf">STMagToFlux</span><span class="p">(</span><span class="n">STMag</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns:</span>
<span class="sd">    NumPy array of fluxes.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="mf">10.</span><span class="o">**</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">STMag</span><span class="p">)</span><span class="o">/-</span><span class="mf">2.5</span><span class="p">)</span><span class="o">*</span><span class="mf">3.63e-9</span>
</div>
<div class="viewcode-block" id="FUVSensitivityDataMod"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.FUVSensitivityDataMod">[docs]</a><span class="k">def</span> <span class="nf">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Modifies the table containing FUV sensitivity data. Goes through the table and</span>
<span class="sd">    pulls out wavelength and sensitivity information. Goes through both sides (A and B).</span>
<span class="sd">    For the latter channel checks that the wavelength is not 50A, which is inside the gap.</span>
<span class="sd">    Makes sure that the saved wavelengths are not smaller than the first recorded  wavelength</span>
<span class="sd">    of the side A.</span>
<span class="sd">    The function could be made faster with array manipulations rather than looping</span>
<span class="sd">    through the data.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">]):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mf">50.</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
    <span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="NUVSensitivityDataMod"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.NUVSensitivityDataMod">[docs]</a><span class="k">def</span> <span class="nf">NUVSensitivityDataMod</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">smoothing</span><span class="p">,</span> <span class="n">median</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Manipulates NUV sensitivity data. Pulls out all central wavelengths for all three</span>
<span class="sd">    stripes. Arranges the data with ascending wavelength.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">5</span><span class="p">])]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">5</span><span class="p">]))</span>
    <span class="n">result</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">NUVSensitivityDataMod2</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">smoothing</span><span class="p">,</span> <span class="n">median</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NUVSensitivityDataMod2"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.NUVSensitivityDataMod2">[docs]</a><span class="k">def</span> <span class="nf">NUVSensitivityDataMod2</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">stepsize</span><span class="p">,</span> <span class="n">Median</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Manipulates NUV sensitivity data. Finds either the min flux </span>
<span class="sd">    value with given wavelength or takes the median of fluxes</span>
<span class="sd">    at given wavelength. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">wave</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">flux</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],]</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">for</span> <span class="n">wave1</span><span class="p">,</span> <span class="n">flux1</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wave1</span> <span class="o">&lt;</span> <span class="n">wave</span> <span class="o">+</span> <span class="n">stepsize</span> <span class="ow">and</span> <span class="n">wave1</span> <span class="o">&gt;</span> <span class="n">wave</span> <span class="o">-</span> <span class="n">stepsize</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Median</span><span class="p">:</span>
                <span class="n">flux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">flux1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Median</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">wave1</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">flux</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">wave1</span><span class="p">,</span> <span class="n">N</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">flux</span><span class="p">)])</span>
            <span class="n">flux</span> <span class="o">=</span> <span class="p">[</span><span class="n">flux1</span><span class="p">,]</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span> <span class="o">+</span> <span class="n">stepsize</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">result</span>
</div>
<div class="viewcode-block" id="collapseSpectrumY"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.collapseSpectrumY">[docs]</a><span class="k">def</span> <span class="nf">collapseSpectrumY</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="n">yline</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Collapses the spectrum in y (spatial for FUV) direction and </span>
<span class="sd">    sums pixels over.</span>
<span class="sd">    @param yline: gives the center point of the spectrum.</span>
<span class="sd">    @param width: gives the number of (plus and minus) pixels summed </span>
<span class="sd">    over in spatial direction.</span>
<span class="sd">    @note: This could be done easier with numpy.sum()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">collapsed</span> <span class="o">=</span> <span class="n">imagedata</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
        <span class="n">collapsed</span> <span class="o">+=</span> <span class="n">imagedata</span><span class="p">[</span><span class="n">yline</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">imagedata</span><span class="p">[</span><span class="n">yline</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">return</span> <span class="n">collapsed</span>
</div>
<div class="viewcode-block" id="collapseSpectrumX"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.collapseSpectrumX">[docs]</a><span class="k">def</span> <span class="nf">collapseSpectrumX</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="n">xline</span><span class="p">,</span> <span class="n">width</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Collapses the spectrum in x (COS dispersion) direction and </span>
<span class="sd">    sums pixels over.</span>
<span class="sd">    @param xline: gives the center point of the spectrum.</span>
<span class="sd">    @param width: gives the number of (plus and minus) pixels summed </span>
<span class="sd">    over in dispersion direction.</span>
<span class="sd">    @note: This could be done easier with numpy.sum()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">collapsed</span> <span class="o">=</span> <span class="n">imagedata</span><span class="p">[:,</span> <span class="n">xline</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">):</span>
        <span class="n">collapsed</span> <span class="o">+=</span> <span class="n">imagedata</span><span class="p">[:,</span><span class="n">xline</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">imagedata</span><span class="p">[:,</span><span class="n">xline</span><span class="o">+</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">collapsed</span>
</div>
<div class="viewcode-block" id="setCoordinatesImagingData"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.setCoordinatesImagingData">[docs]</a><span class="k">def</span> <span class="nf">setCoordinatesImagingData</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets coordinates to imaging data.</span>
<span class="sd">    @return:  x, y, value found from image data</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">imagedata</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">column</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">value</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">result</span>
    </div>
<div class="viewcode-block" id="printOutSensitivity"><a class="viewcode-back" href="../../../../SamPy.plot.COSIHB.html#SamPy.plot.COSIHB.wrapperSynphot.printOutSensitivity">[docs]</a><span class="k">def</span> <span class="nf">printOutSensitivity</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dispersion</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">stepsize</span> <span class="o">=</span> <span class="mi">50</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#effective area</span>
    <span class="c">#area = const*sensitivity/(wave*dlam_dx)</span>
    <span class="n">const</span> <span class="o">=</span> <span class="mf">2.998e10</span> <span class="o">*</span> <span class="mf">6.626e-27</span> <span class="o">/</span> <span class="mf">1.0e-8</span> <span class="c">#h*c*1.e-8 (to convert Ang to cm)</span>

    <span class="c">#printing</span>
    <span class="n">wr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">wr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">header</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">NUVSensitivityDataMod</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">)</span>
    
    <span class="c">#first row</span>
    <span class="n">w0</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s0</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">s0</span> <span class="o">/</span> <span class="p">(</span><span class="n">w0</span> <span class="o">*</span> <span class="n">dispersion</span><span class="p">)</span>
    <span class="n">wr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%5i%15.3e%15.3e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">area</span><span class="p">))</span>
    
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c">#loop over the data</span>
    <span class="k">for</span> <span class="n">wave</span><span class="p">,</span> <span class="n">sens</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">wave</span><span class="p">,</span> <span class="n">const</span> <span class="o">*</span> <span class="n">sens</span> <span class="o">/</span> <span class="p">(</span><span class="n">wave</span> <span class="o">*</span> <span class="n">dispersion</span><span class="p">)])</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">wave</span><span class="p">)</span> <span class="o">%</span> <span class="n">stepsize</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">area</span> <span class="o">=</span> <span class="n">const</span> <span class="o">*</span> <span class="n">sens</span> <span class="o">/</span> <span class="p">(</span><span class="n">wave</span> <span class="o">*</span> <span class="n">dispersion</span><span class="p">)</span>
            <span class="n">wr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%5i%15.3e%15.3e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">wave</span><span class="p">),</span> <span class="n">sens</span><span class="p">,</span> <span class="n">area</span><span class="p">))</span>
    
    <span class="c">#last row</span>
    <span class="n">wr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%5i%15.3e%15.3e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> <span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">const</span><span class="o">*</span><span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dispersion</span><span class="p">)))</span>
    <span class="n">wr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">result</span>
    </div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Main program. All plotting related lines; constants, </span>
<span class="sd">    creation of instances, reading data, data manipulation</span>
<span class="sd">    and finally plotting. Each plot has been isolated by a</span>
<span class="sd">    comment block.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">sys</span>    
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">IO</span>
    <span class="kn">import</span> <span class="nn">Logger</span> <span class="kn">as</span> <span class="nn">L</span>
    <span class="kn">import</span> <span class="nn">plotting</span> <span class="kn">as</span> <span class="nn">P</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
    <span class="kn">import</span> <span class="nn">glob</span>
    <span class="kn">import</span> <span class="nn">synphotSensitivity</span> <span class="kn">as</span> <span class="nn">ss</span>

    <span class="c">#sets some files</span>
    <span class="c">#change these when new reference files come available!</span>
    <span class="n">FUVsensitivityReferenceFile</span> <span class="o">=</span> <span class="s">&#39;u4t18348l_phot.fits&#39;</span>
    <span class="n">NUVsensitivityReferenceFile</span> <span class="o">=</span> <span class="s">&#39;t9h1220sl_phot.fits&#39;</span>
    <span class="n">FUVflatReferenceFile</span> <span class="o">=</span> <span class="s">&#39;n9n20182l_flat.fits&#39;</span>
    <span class="n">NUVflatReferenceFile</span> <span class="o">=</span> <span class="s">&#39;s7g1700tl_flat.fits&#39;</span>
    <span class="n">FUVdispersionReferenceFile</span> <span class="o">=</span> <span class="s">&#39;u6s1320ql_disp.fits&#39;</span> <span class="c">#&#39;t9e1307kl_disp.fits&#39; </span>
    <span class="n">NUVdispersionReferenceFile</span> <span class="o">=</span> <span class="s">&#39;u1t1616pl_disp.fits&#39;</span> <span class="c">#&#39;t9e1307ll_disp.fits&#39;</span>
    
    <span class="c">#Other hard coded filenames.</span>
    <span class="c">#Change if necessary!</span>
    <span class="n">FIG71Data</span> <span class="o">=</span> <span class="s">&#39;FIG71.data&#39;</span>
    <span class="n">PSFdataFile</span> <span class="o">=</span> <span class="s">&#39;laa701a8q_flt.fits&#39;</span>  <span class="c">#GROUND: &#39;psf.fits&#39;</span>
   
    <span class="c">#/cdbs/comp/cos -files</span>
    <span class="c">#change when new comes available</span>
    <span class="n">MirrorAImagingSensFile</span> <span class="o">=</span> <span class="s">&#39;fullthruAtab.fits&#39;</span> <span class="c">#GROUND: &#39;cos_mirrora_004_syn.fits&#39;</span>
    <span class="n">BOATransmissionFile</span> <span class="o">=</span> <span class="s">&#39;cos_boa_004_syn.fits&#39;</span>

    <span class="c">#Spatial profile plot files</span>
    <span class="n">G130MASP</span> <span class="o">=</span> <span class="s">&#39;la9r01d7q_corrtag_a.fits&#39;</span>
    <span class="n">G130MBSP</span> <span class="o">=</span> <span class="s">&#39;la9r01d7q_corrtag_b.fits&#39;</span>

    <span class="c">#sets paths, works from NFS mount Macs or Solaris and Linux boxes</span>
    <span class="n">COSrefFiles</span> <span class="o">=</span> <span class="s">&#39;/grp/hst/cdbs/lref/&#39;</span>
    <span class="n">COScomFiles</span> <span class="o">=</span> <span class="s">&#39;/grp/hst/cdbs/comp/cos/&#39;</span>
    <span class="n">localFolder</span> <span class="o">=</span> <span class="s">&#39;./data/&#39;</span>
    <span class="n">outputfolder</span> <span class="o">=</span> <span class="s">&#39;Graphics&#39;</span>
    <span class="n">sd</span> <span class="o">=</span> <span class="s">&#39;./sensitivities/&#39;</span>

    <span class="k">try</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outputfolder</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
    <span class="n">outputfolder</span> <span class="o">=</span> <span class="s">&#39;./&#39;</span> <span class="o">+</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span>

    <span class="c">#local = True</span>
    <span class="n">computedPhot</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c">#referenceFiles = True</span>
    <span class="c">#PSFs = True</span>
    <span class="n">Chapter13</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c">#LSF = True</span>
    <span class="c">#SpatialProfiles = True</span>

    <span class="c">#set booleans for different plots; False -&gt; not plotted    </span>
    <span class="n">local</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#computedPhot = False</span>
    <span class="n">referenceFiles</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">PSFs</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c">#Chapter13 = False</span>
    <span class="n">SpatialProfiles</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">LSF</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="c">#hard coded COS geocoronal average intensity background values</span>
    <span class="n">geo1216</span> <span class="o">=</span> <span class="mf">3.05e-13</span>
    <span class="n">geo1302</span> <span class="o">=</span> <span class="mf">2.85e-14</span>
    <span class="n">geo1356</span> <span class="o">=</span> <span class="mf">2.50e-15</span>
    <span class="n">geo2417</span> <span class="o">=</span> <span class="mf">1.50e-15</span>
    <span class="c">#hard coded COS dark values per pixel</span>
    <span class="c">#For latest values, see:</span>
    <span class="c">#http://www.stsci.edu/hst/observatory/etcs/etc_user_guide/1_ref_9_background.html</span>
    <span class="c"># @todo: one could automize this part so that the latest dark would be parsed</span>
    <span class="n">darkFUV</span> <span class="o">=</span> <span class="mf">0.0000022</span> <span class="c">#OLD: 3.*7.2e-7</span>
    <span class="n">darkNUV</span> <span class="o">=</span> <span class="mf">3.0e-4</span> <span class="c">#OLD: (11./34.)*2.1e-4</span>
    <span class="c">#ETC box height</span>
    <span class="n">SNbox</span> <span class="o">=</span> <span class="mi">47</span> <span class="c">#FUV</span>
    <span class="n">SNboxNUV</span> <span class="o">=</span> <span class="mi">8</span>

    <span class="c">#If set to False, output will be save to a file rather than presented on screen</span>
    <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">debug</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c">#sets constants</span>
    <span class="n">FEFU</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">**-</span><span class="mf">15.</span>
    <span class="n">FUVresel</span> <span class="o">=</span> <span class="mf">6.</span>
    <span class="n">NUVresel</span> <span class="o">=</span> <span class="mf">3.</span>
    
    <span class="c"># smoothing factor (wave - sm &lt; x &lt; wave + sm) for sensitivity plots</span>
    <span class="n">smoothing</span> <span class="o">=</span> <span class="mf">5.</span>
    <span class="n">g230lsm</span> <span class="o">=</span> <span class="mf">25.</span>

    <span class="c">#creates plotting and reading instances</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">Plotting</span><span class="p">(</span><span class="s">&#39;.pdf&#39;</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">L</span><span class="o">.</span><span class="n">Logger</span><span class="p">(</span><span class="s">&#39;Plotting.output&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">referenceFiles</span> <span class="ow">or</span> <span class="n">Chapter13</span><span class="p">:</span> <span class="n">read</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">COSHBIO</span><span class="p">(</span><span class="n">COSrefFiles</span><span class="p">,</span> <span class="s">&#39;temp.tmp&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">computedPhot</span><span class="p">:</span> <span class="n">readcom</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">COSHBIO</span><span class="p">(</span><span class="n">COScomFiles</span><span class="p">,</span> <span class="s">&#39;tempcom.tmp&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">local</span><span class="p">:</span> <span class="n">readlocal</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">COSHBIO</span><span class="p">(</span><span class="n">localFolder</span><span class="p">,</span> <span class="s">&#39;templocal.tmp&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">PSFs</span><span class="p">:</span> <span class="n">readPSF</span> <span class="o">=</span> <span class="n">IO</span><span class="o">.</span><span class="n">COSHBIO</span><span class="p">(</span><span class="n">localFolder</span><span class="p">,</span> <span class="s">&#39;tempPSF.tmp&#39;</span><span class="p">)</span>

    <span class="c">#Begins plotting...</span>
    <span class="k">if</span> <span class="n">referenceFiles</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Starting to create plots based on reference files...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="c">########################################################################################</span>
        <span class="c">#Dispersion solutions for FUV.</span>
        <span class="c">#These are needed for effective areas</span>
        <span class="n">FUVd</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">FUVdispersionReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">G130Mdisp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">FUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;FUVA&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G130M&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1309</span><span class="p">]</span>
        <span class="n">G160Mdisp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">FUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;FUVA&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G160M&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1600</span><span class="p">]</span>
        <span class="n">G140Ldisp</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">FUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;FUVA&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G140L&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1230</span><span class="p">]</span>
<span class="c">########################################################################################        </span>
        <span class="c">#Fig 5.2, page 40</span>
        <span class="c">#Only for default central wavelengths</span>
        <span class="c">#reads data, manipulates variable names and plots the figure</span>
        <span class="n">FUVsensData</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">FUVsensitivityReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
        <span class="c">#All central wavelengths are default except for G140L (default 1230)   </span>
        <span class="n">G130Msens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">FUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G130M&#39;</span> <span class="ow">and</span> 
                     <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1309</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        <span class="n">G160Msens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">FUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G160M&#39;</span> <span class="ow">and</span>
                     <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1600</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        <span class="n">G140Lsens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">FUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G140L&#39;</span> <span class="ow">and</span>
                     <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1105</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        
        <span class="n">G130M</span> <span class="o">=</span> <span class="n">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">G130Msens</span><span class="p">)</span>
        <span class="n">G140L</span> <span class="o">=</span> <span class="n">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">G140Lsens</span><span class="p">)</span>
        <span class="n">G160M</span> <span class="o">=</span> <span class="n">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">G160Msens</span><span class="p">)</span>

        <span class="c">#Effective Area </span>
        <span class="c">#Prints out the FUV sensitivity files</span>
        <span class="n">G130</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G130Msens</span><span class="p">,</span> <span class="n">G130Mdisp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;#G130M wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G130Msensitivity.txt&#39;</span><span class="p">)</span>   
        <span class="n">G160</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G160Msens</span><span class="p">,</span> <span class="n">G160Mdisp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;#G160M wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G160Msensitivity.txt&#39;</span><span class="p">)</span>   
        <span class="n">G140</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G140Lsens</span><span class="p">,</span> <span class="n">G140Ldisp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&#39;#G140L wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G140Lsensitivity.txt&#39;</span><span class="p">)</span>   
     
        <span class="c">#OLD sensitivity plot</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">FUVsensitivityOLD</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G130M</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">FUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G130M</span><span class="p">],</span> 
                            <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G140L</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">FUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G140L</span><span class="p">],</span> 
                            <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G160M</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">FUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G160M</span><span class="p">],</span>
                            <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;FUVSensitivityOLD&#39;</span><span class="p">)</span>

        <span class="c">#new sensitivity plot with effective area</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">FUVsensitivity</span><span class="p">(</span><span class="n">G130</span><span class="p">,</span> <span class="n">G160</span><span class="p">,</span> <span class="n">G140</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;FUVSensitivity&#39;</span><span class="p">)</span>


<span class="c">########################################################################################</span>
        <span class="c">#A new fig, same as 5.2 but through BOA</span>
        <span class="c">#reads data, manipulates variable names and plots the figure</span>
        <span class="c">#FUVsensData = read.FITSTable(FUVsensitivityReferenceFile, 1)</span>
    
        <span class="c">#All central wavelengths are default except for G140L (default 1230)   </span>
        <span class="n">G130MBsens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">FUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G130M&#39;</span> <span class="ow">and</span> 
                     <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1309</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BOA&#39;</span><span class="p">]</span>
        <span class="n">G160MBsens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">FUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G160M&#39;</span> <span class="ow">and</span>
                     <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1600</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BOA&#39;</span><span class="p">]</span>
        <span class="n">G140LBsens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">FUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G140L&#39;</span> <span class="ow">and</span>
                     <span class="n">line</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1105</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;BOA&#39;</span><span class="p">]</span>
        
        <span class="n">G130MB</span> <span class="o">=</span> <span class="n">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">G130MBsens</span><span class="p">)</span>
        <span class="n">G140LB</span> <span class="o">=</span> <span class="n">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">G140LBsens</span><span class="p">)</span>
        <span class="n">G160MB</span> <span class="o">=</span> <span class="n">FUVSensitivityDataMod</span><span class="p">(</span><span class="n">G160MBsens</span><span class="p">)</span>
     
        <span class="n">plot</span><span class="o">.</span><span class="n">FUVsensitivityBOA</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G130MB</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">FUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G130MB</span><span class="p">],</span> 
                               <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G140LB</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">FUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G140LB</span><span class="p">],</span> 
                               <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G160MB</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">FUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G160MB</span><span class="p">],</span>
                               <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;FUVBOASensitivity&#39;</span><span class="p">)</span>

<span class="c">#########################################################################################</span>
        <span class="c">#Dispersion solution for NUV</span>
        <span class="c">#These are needed for effective area plots</span>
        <span class="n">NUVd</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">NUVdispersionReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">G185Mdisp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">NUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G185M&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">])</span>
        <span class="n">G225Mdisp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">NUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G225M&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">])</span>
        <span class="n">G285Mdisp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">NUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G285M&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">])</span>
        <span class="n">G230Ldisp</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">NUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;G230L&#39;</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">])</span>
<span class="c">#########################################################################################</span>
        <span class="c">#Fig 5.3, page 41</span>
        <span class="c">#reads data, manipulates data and plots the figure</span>
        <span class="n">NUVsensData</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">NUVsensitivityReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
        <span class="n">G185Msens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">NUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G185M&#39;</span> <span class="ow">and</span> 
                     <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        <span class="n">G225Msens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">NUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G225M&#39;</span> <span class="ow">and</span> 
                     <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        <span class="n">G285Msens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">NUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G285M&#39;</span> <span class="ow">and</span> 
                     <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        
        <span class="n">G230Lsens</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">NUVsensData</span> <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;G230L&#39;</span> <span class="ow">and</span> 
                     <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span> <span class="ow">and</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;NUVC&#39;</span><span class="p">]</span>
    
        <span class="c">#CHANGED!</span>
        <span class="c">#G230L = NUVSensitivityDataMod(G230Lsens, smoothing+g230lsm, median = False)</span>
        <span class="n">G230L</span> <span class="o">=</span> <span class="n">NUVSensitivityDataMod</span><span class="p">(</span><span class="n">G230Lsens</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">G185M</span> <span class="o">=</span> <span class="n">NUVSensitivityDataMod</span><span class="p">(</span><span class="n">G185Msens</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">+</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">G225M</span> <span class="o">=</span> <span class="n">NUVSensitivityDataMod</span><span class="p">(</span><span class="n">G225Msens</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">+</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">G285M</span> <span class="o">=</span> <span class="n">NUVSensitivityDataMod</span><span class="p">(</span><span class="n">G285Msens</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">+</span><span class="mi">15</span><span class="p">)</span>

        <span class="c">#Prints out the NUV sensitivity files</span>
        <span class="n">G185</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G185Msens</span><span class="p">,</span> <span class="n">G185Mdisp</span><span class="p">,</span> <span class="s">&#39;#G185M wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G185Msensitivity.txt&#39;</span><span class="p">)</span>   
        <span class="n">G225</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G225Msens</span><span class="p">,</span> <span class="n">G225Mdisp</span><span class="p">,</span> <span class="s">&#39;#G225M wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G225Msensitivity.txt&#39;</span><span class="p">)</span>        
        <span class="n">G285</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G285Msens</span><span class="p">,</span> <span class="n">G285Mdisp</span><span class="p">,</span> <span class="s">&#39;#G285M wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G285Msensitivity.txt&#39;</span><span class="p">)</span>
        <span class="n">G230</span> <span class="o">=</span> <span class="n">printOutSensitivity</span><span class="p">(</span><span class="n">G230Lsens</span><span class="p">,</span> <span class="n">G230Ldisp</span><span class="p">,</span> <span class="s">&#39;#G230L wave sens Aeff&#39;</span><span class="p">,</span> <span class="n">sd</span> <span class="o">+</span> <span class="s">&#39;G230Lsensitivity.txt&#39;</span><span class="p">)</span>
    
        <span class="c">#new sensitivity plot</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">NUVsensitivity</span><span class="p">(</span><span class="n">G185</span><span class="p">,</span> <span class="n">G225</span><span class="p">,</span> <span class="n">G285</span><span class="p">,</span> <span class="n">G230</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;NUVSensitivity&#39;</span><span class="p">)</span>
    
        <span class="c">#OLD sensitivity plot</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">NUVsensitivityM</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G185M</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">NUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G185M</span><span class="p">],</span> 
                             <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G225M</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">NUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G225M</span><span class="p">],</span> 
                             <span class="p">[</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G285M</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">NUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G285M</span><span class="p">],</span>
                             <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;NUVSensitivityOLD&#39;</span><span class="p">)</span>
   
<span class="c">##########################################################################################</span>
        <span class="c">#Fig 5.4, page 42        </span>
        <span class="n">plot</span><span class="o">.</span><span class="n">NUVsensitivityG230L</span><span class="p">([</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G230L</span><span class="p">],</span> <span class="p">[</span><span class="n">FEFU</span><span class="o">*</span><span class="n">NUVresel</span><span class="o">*</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">G230L</span><span class="p">],</span> 
                                 <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;NUVSensitivityG230L&#39;</span><span class="p">)</span>

<span class="c">#########################################################################################    </span>
        <span class="c">#Fig 5.5, page 53</span>
        <span class="n">smoothFUV</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">smoothingFUV</span> <span class="o">=</span> <span class="p">(</span><span class="mi">500</span><span class="p">,)</span>
        <span class="n">yline</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">FUVflat</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="n">FUVflatReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">datay</span> <span class="o">=</span> <span class="n">FUVflat</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">FUVFlatField</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datay</span><span class="p">)),</span> <span class="n">datay</span><span class="p">,</span> <span class="n">yline</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;FUVXDLFlat&#39;</span><span class="p">,</span> 
                          <span class="n">smooth</span> <span class="o">=</span> <span class="n">smoothFUV</span><span class="p">,</span> <span class="n">smoothing</span> <span class="o">=</span> <span class="n">smoothingFUV</span><span class="p">)</span>

<span class="c">#########################################################################################    </span>
        <span class="c">#Fig 5.6, page 53</span>
        <span class="n">smoothNUV</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">smoothingNUV</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span><span class="p">,)</span>
        <span class="n">yline</span> <span class="o">=</span> <span class="mi">430</span>
        <span class="n">NUVflat</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="n">NUVflatReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">datay</span> <span class="o">=</span> <span class="n">NUVflat</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">NUVFlatField</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">datay</span><span class="p">)),</span> <span class="n">datay</span><span class="p">,</span> <span class="n">yline</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;NUVMAMAFlat&#39;</span><span class="p">,</span>
                          <span class="n">smooth</span> <span class="o">=</span> <span class="n">smoothNUV</span><span class="p">,</span> <span class="n">smoothing</span> <span class="o">=</span> <span class="n">smoothingNUV</span><span class="p">)</span>

<span class="c">#########################################################################################</span>
    
    <span class="k">if</span> <span class="n">Chapter13</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Starting to create Chapter 15 (see also synphotSensitivity.py) related plots..</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="c">#########################################################################################</span>
        <span class="c">#Chapter 13 plots</span>
        <span class="c">#if referenceFiles == False: FUVsensData = read.FITSTable(FUVsensitivityReferenceFile, 1)</span>
        <span class="c">#Run the sensitivity module</span>
        <span class="n">ss</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
        
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#G130M Wavel   Throughput   Sensitivity   Effective Area</span>
        <span class="n">dt</span> <span class="o">=</span><span class="p">{</span><span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;wavelength&#39;</span><span class="p">,</span> <span class="s">&#39;throughput&#39;</span><span class="p">,</span> <span class="s">&#39;sensitivity&#39;</span><span class="p">,</span> <span class="s">&#39;eff&#39;</span><span class="p">),</span>
             <span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;i4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">)}</span>        
        <span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s">&#39;./sensitivities/*sensitivity.txt&#39;</span><span class="p">):</span>
            <span class="n">grating</span> <span class="o">=</span> <span class="nb">file</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">21</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">dt</span><span class="p">)</span>
            <span class="n">sensitivity</span><span class="p">[</span><span class="n">grating</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        
        <span class="c">#FUV sensitivites and wavelengths</span>
        <span class="n">G130Mw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G130M&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G130Ms</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G130M&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">G160Mw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G160M&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G160Ms</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G160M&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">G140Lw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G140L&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G140Ls</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G140L&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>
        
        <span class="c">###########</span>
        <span class="c">####FUV####</span>
        <span class="c">###########</span>
        <span class="c">#G130Ms = [line for line in FUVsensData if line[1].strip() == &#39;G130M&#39; and </span>
        <span class="c">#         line[2] == 1309 and line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#G130MBs = [line for line in FUVsensData if line[1].strip() == &#39;G130M&#39; and </span>
        <span class="c">#          line[2] == 1309 and line[3].strip() == &#39;BOA&#39;]</span>
          
        <span class="c">#OLD method</span>
        <span class="c">#G130M = FUVSensitivityDataMod(G130Ms)</span>
        <span class="c">#G130MB = FUVSensitivityDataMod(G130MBs)</span>
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G130M], </span>
        <span class="c">#                     [pair[1] for pair in G130M],</span>
        <span class="c">#                     [pair[0] for pair in G130MB], </span>
        <span class="c">#                     [pair[1] for pair in G130MB],</span>
        <span class="c">#                     &#39;G130M, CENWAVE = 1309 \AA&#39;,</span>
        <span class="c">#                     outputfolder + &#39;G130Msensitivity&#39;)</span>
        
        <span class="c">#plot.Chapeter13Sensitivity(G130Ms, G130MBs, &#39;G130M, CENWAVE = 1309 \AA&#39;, outputfolder + &#39;G130Msensitivity&#39;)</span>
        <span class="c">#plot.Chapeter13SensitivityNew(G130Ms, G130MBs, G130Mdisp[0],</span>
        <span class="c">#                              &#39;G130M, CENWAVE = 1309 \AA&#39;, outputfolder + &#39;G130MsensitivityNEW&#39;)</span>
        
        <span class="c">#G130Mw = [line for line in FUVsensData if line[1].strip() == &#39;G130M&#39; and </span>
        <span class="c">#          line[3].strip() == &#39;PSA&#39;]</span>
               
        <span class="c">#plot.Chapter13Wavelength(G130Mw,</span>
        <span class="c">#                         15,</span>
        <span class="c">#                         &#39;Wavelength Ranges for the G130M Grating Setting&#39;,</span>
        <span class="c">#                         outputfolder + &#39;G130MWaveOLD&#39;)</span>
        
        <span class="n">G130MSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">1310</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">]</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">STMagToFlux</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="mf">0.2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">)])</span>
        
        <span class="n">G130Msens</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G130Mw</span><span class="p">,</span> <span class="n">G130Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G130M sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G130Msens</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG130M</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo1302</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G130Msens</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">FUVresel</span><span class="p">,</span> <span class="n">skyG130M</span><span class="p">,</span> <span class="n">darkFUV</span><span class="o">*</span><span class="n">SNbox</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G130MSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G130MSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">15000.</span><span class="p">,</span> <span class="s">&#39;G130M&#39;</span><span class="p">,</span> <span class="n">G130Msens</span><span class="p">),</span>
                             <span class="s">&#39;G130M&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G130MSNR&#39;</span><span class="p">)</span>
              
        <span class="c">#G130M short new modes!</span>
        <span class="n">G130MSSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">1030</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">,</span> <span class="mf">10000.</span><span class="p">]</span>
        <span class="n">fluxes</span> <span class="o">=</span> <span class="n">STMagToFlux</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="mf">0.2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">)])</span>
        
        <span class="n">G130MSsens</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G130Mw</span><span class="p">,</span> <span class="n">G130Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G130MS sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G130MSsens</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG130MS</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo1302</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G130MSsens</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">FUVresel</span><span class="p">,</span> <span class="n">skyG130MS</span><span class="p">,</span> <span class="n">darkFUV</span><span class="o">*</span><span class="n">SNbox</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G130MSSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G130MSSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">15000.</span><span class="p">,</span> <span class="s">&#39;G130M&#39;</span><span class="p">,</span> <span class="n">G130MSsens</span><span class="p">),</span>
                             <span class="s">&#39;G130M&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G130MSSNR&#39;</span><span class="p">)</span>        
    
        <span class="c">##########</span>
        <span class="c">#G160Ms = [line for line in FUVsensData if line[1].strip() == &#39;G160M&#39; and </span>
        <span class="c">#         line[2] == 1600 and line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#G160MBs = [line for line in FUVsensData if line[1].strip() == &#39;G160M&#39; and </span>
        <span class="c">#          line[2] == 1600 and line[3].strip() == &#39;BOA&#39;]</span>
        
        <span class="c">#Old method</span>
        <span class="c">#G160M = FUVSensitivityDataMod(G160Ms)</span>
        <span class="c">#G160MB = FUVSensitivityDataMod(G160MBs)</span>
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G160M], </span>
        <span class="c">#                     [pair[1] for pair in G160M],</span>
        <span class="c">#                     [pair[0] for pair in G160MB], </span>
        <span class="c">#                     [pair[1] for pair in G160MB],</span>
        <span class="c">#                     &#39;G160M, CENWAVE = 1600 \AA&#39;,</span>
        <span class="c">#                     outputfolder +  &#39;G160Msensitivity&#39;)</span>
        <span class="c">#plot.Chapeter13Sensitivity(G160Ms, G160MBs, &#39;G160M, CENWAVE = 1600 \AA&#39;, outputfolder +  &#39;G160Msensitivity&#39;)</span>

        <span class="c">#G160Mw = [line for line in FUVsensData if line[1].strip() == &#39;G160M&#39; and </span>
        <span class="c">#          line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#plot.Chapter13Wavelength(G160Mw,</span>
        <span class="c">#                         20,</span>
        <span class="c">#                         &#39;Wavelength Ranges for the G160M Grating Setting&#39;,</span>
        <span class="c">#                         outputfolder + &#39;G160MWaveOLD&#39;)</span>
        
        <span class="n">G160MSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">1610</span>
        <span class="n">G160Msens</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G160Mw</span><span class="p">,</span> <span class="n">G160Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G160M sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G160Msens</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG160M</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo1356</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G160Msens</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">FUVresel</span><span class="p">,</span> <span class="n">skyG160M</span><span class="p">,</span> <span class="n">darkFUV</span><span class="o">*</span><span class="n">SNbox</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G160MSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G160MSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">15000.</span><span class="p">,</span> <span class="s">&#39;G160M&#39;</span><span class="p">,</span> <span class="n">G160Msens</span><span class="p">),</span>
                             <span class="s">&#39;G160M&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G160MSNR&#39;</span><span class="p">)</span>

        
        <span class="c">########</span>
        <span class="c">#G140Ls = [line for line in FUVsensData if line[1].strip() == &#39;G140L&#39; and </span>
        <span class="c">#         line[2] == 1230 and line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#G140LBs = [line for line in FUVsensData if line[1].strip() == &#39;G140L&#39; and </span>
        <span class="c">#          line[2] == 1230 and line[3].strip() == &#39;BOA&#39;]</span>

        <span class="c">#Old method</span>
        <span class="c">#G140L = FUVSensitivityDataMod(G140Ls)</span>
        <span class="c">#G140LB = FUVSensitivityDataMod(G140LBs)</span>
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G140L], </span>
        <span class="c">#                     [pair[1] for pair in G140L],</span>
        <span class="c">#                     [pair[0] for pair in G140LB], </span>
        <span class="c">#                     [pair[1] for pair in G140LB],</span>
        <span class="c">#                     &#39;G140L, CENWAVE = 1230 \AA&#39;,</span>
        <span class="c">#                     outputfolder + &#39;G140Lsensitivity&#39;, True)</span>
        <span class="c">#plot.Chapeter13Sensitivity(G140Ls, G140LBs, &#39;G140L, CENWAVE = 1230 \AA&#39;, outputfolder + &#39;G140Lsensitivity&#39;, True)</span>

        <span class="c">#G140Lw = [line for line in FUVsensData if line[1].strip() == &#39;G140L&#39; and </span>
        <span class="c">#          line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#plot.Chapter13Wavelength(G140Lw,</span>
        <span class="c">#                         55,</span>
        <span class="c">#                         &#39;Wavelength Ranges for the G140L Grating Setting&#39;,</span>
        <span class="c">#                         outputfolder + &#39;G140LWaveOLD&#39;, True)</span>
        
        <span class="n">G140LSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">1230</span>
        <span class="n">G140Lsens</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G140Lw</span><span class="p">,</span> <span class="n">G140Ls</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G140L sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G140Lsens</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG140L</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo1216</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G140Lsens</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">FUVresel</span><span class="p">,</span> <span class="n">skyG140L</span><span class="p">,</span> <span class="n">darkFUV</span><span class="o">*</span><span class="n">SNbox</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G140LSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G140LSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">15000.</span><span class="p">,</span> <span class="s">&#39;G140L&#39;</span><span class="p">,</span> <span class="n">G140Lsens</span><span class="p">),</span>
                             <span class="s">&#39;G140L&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G140LSNR&#39;</span><span class="p">)</span>

        <span class="c">#New wavelength plots</span>
        <span class="n">dt</span> <span class="o">=</span><span class="p">{</span><span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;grating&#39;</span><span class="p">,</span> <span class="s">&#39;central&#39;</span><span class="p">,</span> <span class="s">&#39;segment&#39;</span><span class="p">,</span> <span class="s">&#39;fp-pos&#39;</span><span class="p">,</span> <span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="s">&#39;stop&#39;</span><span class="p">),</span>
             <span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;S6&#39;</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">,</span> <span class="s">&#39;S4&#39;</span><span class="p">,</span> <span class="s">&#39;i4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">)}</span>
        <span class="n">gratings</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;G130MS&#39;</span><span class="p">,</span> <span class="s">&#39;G130M&#39;</span><span class="p">,</span> <span class="s">&#39;G160M&#39;</span><span class="p">,</span> <span class="s">&#39;G140L&#39;</span><span class="p">]</span>
        <span class="n">FUVWaves</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;FUVWaves.txt&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">dt</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">grating</span> <span class="ow">in</span> <span class="n">gratings</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">FUVWaves</span><span class="p">[</span><span class="n">FUVWaves</span><span class="p">[</span><span class="s">&#39;grating&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">grating</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;Grating&#39;</span><span class="p">,</span> <span class="n">grating</span>
            <span class="k">print</span> <span class="s">&#39;Data&#39;</span><span class="p">,</span> <span class="n">data</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13Waves</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">grating</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="n">grating</span> <span class="o">+</span> <span class="s">&#39;Wave&#39;</span><span class="p">)</span>

        <span class="c">###########</span>
        <span class="c">####NUV####</span>
        <span class="c">###########</span>
        <span class="c">#if referenceFiles == False:</span>
        <span class="c">#    NUVsensData = read.FITSTable(NUVsensitivityReferenceFile, 1)</span>
        <span class="c">#    G185Msens = [line for line in NUVsensData if line[1].strip() == &#39;G185M&#39; and </span>
        <span class="c">#                 line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#    G225Msens = [line for line in NUVsensData if line[1].strip() == &#39;G225M&#39; and </span>
        <span class="c">#                 line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#    G285Msens = [line for line in NUVsensData if line[1].strip() == &#39;G285M&#39; and </span>
        <span class="c">#                 line[3].strip() == &#39;PSA&#39;]</span>
        <span class="c">#    G230Lsens = [line for line in NUVsensData if line[1].strip() == &#39;G230L&#39; and </span>
        <span class="c">#                 line[3].strip() == &#39;PSA&#39; and line[0].strip() != &#39;NUVC&#39;]</span>
        <span class="c">#        #CHANGED G230L added stripe not C</span>
        <span class="c">#    </span>
        <span class="c">#    G185M = NUVSensitivityDataMod(G185Msens, smoothing+14)</span>
        <span class="c">#    G225M = NUVSensitivityDataMod(G225Msens, smoothing+5)</span>
        <span class="c">#    G285M = NUVSensitivityDataMod(G285Msens, smoothing+14)</span>
        <span class="c">#    G230L = NUVSensitivityDataMod(G230Lsens, smoothing+g230lsm, median = False)</span>
        
        <span class="c">#G185MBsens = [line for line in NUVsensData if line[1].strip() == &#39;G185M&#39; and </span>
        <span class="c">#              line[3].strip() == &#39;BOA&#39;]</span>
        <span class="c">#G225MBsens = [line for line in NUVsensData if line[1].strip() == &#39;G225M&#39; and </span>
        <span class="c">#              line[3].strip() == &#39;BOA&#39;]</span>
        <span class="c">#G285MBsens = [line for line in NUVsensData if line[1].strip() == &#39;G285M&#39; and </span>
        <span class="c">#              line[3].strip() == &#39;BOA&#39;]</span>
        <span class="c">#G230LBsens = [line for line in NUVsensData if line[1].strip() == &#39;G230L&#39; and </span>
        <span class="c">#              line[3].strip() == &#39;BOA&#39; and line[0].strip() != &#39;NUVC&#39;]    </span>

        <span class="c">#G185MB = NUVSensitivityDataMod(G185MBsens, smoothing+14)</span>
        <span class="c">#G225MB = NUVSensitivityDataMod(G225MBsens, smoothing+5)</span>
        <span class="c">#G285MB = NUVSensitivityDataMod(G285MBsens, smoothing+14)</span>
        <span class="c">#G230LB = NUVSensitivityDataMod(G230LBsens, smoothing+30)</span>
        <span class="c">#G230LB = NUVSensitivityDataMod(G230LBsens, smoothing+g230lsm, median = False)</span>
        
        <span class="n">G185Mw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G185M&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G185Ms</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G185M&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">G225Mw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G225M&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G225Ms</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G225M&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">G285Mw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G285M&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G285Ms</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G285M&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">G230Lw</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G230L&#39;</span><span class="p">][</span><span class="s">&#39;wavelength&#39;</span><span class="p">]</span>
        <span class="n">G230Ls</span> <span class="o">=</span> <span class="n">sensitivity</span><span class="p">[</span><span class="s">&#39;G230L&#39;</span><span class="p">][</span><span class="s">&#39;sensitivity&#39;</span><span class="p">]</span>                
                     
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G185M], </span>
        <span class="c">#                     [pair[1] for pair in G185M],</span>
        <span class="c">#                     [pair[0] for pair in G185MB], </span>
        <span class="c">#                     [pair[1] for pair in G185MB],</span>
        <span class="c">#                     &#39;G185M&#39;,</span>
        <span class="c">#                     outputfolder + &#39;G185Msensitivity&#39;)</span>
        
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G285M], </span>
        <span class="c">#                     [pair[1] for pair in G285M],</span>
        <span class="c">#                     [pair[0] for pair in G285MB], </span>
        <span class="c">#                     [pair[1] for pair in G285MB],</span>
        <span class="c">#                     &#39;G285M&#39;,</span>
        <span class="c">#                     outputfolder + &#39;G285Msensitivity&#39;)</span>
        
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G225M], </span>
        <span class="c">#                     [pair[1] for pair in G225M],</span>
        <span class="c">#                     [pair[0] for pair in G225MB], </span>
        <span class="c">#                     [pair[1] for pair in G225MB],</span>
        <span class="c">#                     &#39;G225M&#39;,</span>
        <span class="c">#                     outputfolder + &#39;G225Msensitivity&#39;)</span>
        
        <span class="c">#plot.Chapeter13Plots([pair[0] for pair in G230L if pair[0] &lt; 3240], </span>
        <span class="c">#                     [pair[1] for pair in G230L if pair[0] &lt; 3240],</span>
        <span class="c">#                     [pair[0] for pair in G230LB if pair[0] &lt; 3240], </span>
        <span class="c">#                     [pair[1] for pair in G230LB if pair[0] &lt; 3240],</span>
        <span class="c">#                     &#39;G230L&#39;,</span>
        <span class="c">#                     outputfolder + &#39;G230Lsensitivity&#39;)</span>
       
        <span class="c"># WAVELENGTH PLOTS</span>
        <span class="n">NUVd</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">NUVdispersionReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">NUVd</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PSA&#39;</span><span class="p">]</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13WavelengthNUVNew</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">outputfolder</span><span class="p">)</span>
        <span class="c">#plot.Chapter13WavelengthNUV(G185Msens,</span>
        <span class="c">#                            18,</span>
        <span class="c">#                            &#39;Wavelength Ranges for the G185M Grating Setting&#39;,</span>
        <span class="c">#                            outputfolder + &#39;G185MWave&#39;)</span>

        <span class="c">#plot.Chapter13WavelengthNUV(G285Msens,</span>
        <span class="c">#                            30,</span>
        <span class="c">#                            &#39;Wavelength Ranges for the G285M Grating Setting&#39;,</span>
        <span class="c">#                            outputfolder + &#39;G285MWave&#39;)</span>
 
        <span class="c">#plot.Chapter13WavelengthNUV(G225Msens,</span>
        <span class="c">#                            18,</span>
        <span class="c">#                            &#39;Wavelength Ranges for the G225M Grating Setting&#39;,</span>
        <span class="c">#                            outputfolder + &#39;G225MWave&#39;)</span>
        
        <span class="c">#G230Lsens = [line for line in NUVsensData if line[1].strip() == &#39;G230L&#39; and </span>
        <span class="c">#             line[3].strip() == &#39;PSA&#39;]</span>
 
        <span class="c">#plot.Chapter13WavelengthNUV(G230Lsens,</span>
        <span class="c">#                            15,</span>
        <span class="c">#                            &#39;Wavelength Ranges for the G230L Grating Setting&#39;,</span>
        <span class="c">#                            outputfolder + &#39;G230LWave&#39;)</span>
        
        <span class="n">G185MSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">1851</span>
        <span class="c">#note that we are limited to stripe B, so change this accordingly is wv above is changed</span>
        <span class="c">#G185Msens = [line for line in NUVsensData if line[1].strip() == &#39;G185M&#39; and </span>
        <span class="c">#             line[2] == 1850 and line[3].strip() == &#39;PSA&#39; and line[0].strip() == &#39;NUVB&#39;]</span>
        
        <span class="n">G185Ms</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G185Mw</span><span class="p">,</span> <span class="n">G185Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G185M sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G185Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG185M</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo1356</span>
        <span class="n">skyG185M</span> <span class="o">=</span> <span class="mf">8.809e-9</span> <span class="c">#taken from ETC 17.4_test as the other method gave very wrong solution?</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G185Ms</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">NUVresel</span><span class="p">,</span> <span class="n">skyG185M</span><span class="p">,</span> <span class="n">darkNUV</span><span class="o">*</span><span class="n">SNboxNUV</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G185MSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G185MSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">30000.</span><span class="p">,</span> <span class="s">&#39;G185M&#39;</span><span class="p">,</span> <span class="n">G185Ms</span><span class="p">,</span> <span class="n">NUV</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span>
                             <span class="s">&#39;G185M&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G185MSNR&#39;</span><span class="p">,</span> <span class="n">FUV</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

        <span class="c">####################</span>
        <span class="n">G225MSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">2251</span>
        <span class="c">#note that we are limited to stripe B, so change this accordingly is wv above is changed</span>
        <span class="c">#G225Msens = [line for line in NUVsensData if line[1].strip() == &#39;G225M&#39; and </span>
        <span class="c">#             line[2] == 2250 and line[3].strip() == &#39;PSA&#39; and line[0].strip() == &#39;NUVB&#39;]</span>
        
        <span class="n">G225Ms</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G225Mw</span><span class="p">,</span> <span class="n">G225Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G225M sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G225Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG225M</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo2417</span>
        <span class="n">skyG225M</span> <span class="o">=</span> <span class="mf">1.395e-7</span> <span class="c">#taken from ETC 17.4_test..</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G225Ms</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">NUVresel</span><span class="p">,</span> <span class="n">skyG225M</span><span class="p">,</span> <span class="n">darkNUV</span><span class="o">*</span><span class="n">SNboxNUV</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G225MSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G225MSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">30000.</span><span class="p">,</span> <span class="s">&#39;G225M&#39;</span><span class="p">,</span> <span class="n">G225Ms</span><span class="p">,</span> <span class="n">NUV</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span>
                             <span class="s">&#39;G225M&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G225MSNR&#39;</span><span class="p">,</span> <span class="n">FUV</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>

        <span class="c">####################</span>
        <span class="n">G285MSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">2851</span>
        <span class="c">#note that we are limited to stripe B, so change this accordingly is wv above is changed</span>
        <span class="c">#G285Msens = [line for line in NUVsensData if line[1].strip() == &#39;G285M&#39; and </span>
        <span class="c">#             line[2] == 2850 and line[3].strip() == &#39;PSA&#39; and line[0].strip() == &#39;NUVB&#39;]</span>
        
        <span class="n">G285Ms</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G285Mw</span><span class="p">,</span> <span class="n">G285Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G285M sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G285Ms</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG285M</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo2417</span>
        <span class="n">skyG285M</span> <span class="o">=</span> <span class="mf">2.318e-7</span> <span class="c">#taken from ETC 17.4_test...</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G285Ms</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">NUVresel</span><span class="p">,</span> <span class="n">skyG285M</span><span class="p">,</span> <span class="n">darkNUV</span><span class="o">*</span><span class="n">SNboxNUV</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G285MSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G285MSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">30000.</span><span class="p">,</span> <span class="s">&#39;G285M&#39;</span><span class="p">,</span> <span class="n">G285Ms</span><span class="p">,</span> <span class="n">NUV</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span>
                             <span class="s">&#39;G285M&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G285MSNR&#39;</span><span class="p">,</span> <span class="n">FUV</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>         

        <span class="c">####################</span>
        <span class="n">G230LSNRdata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">wv</span> <span class="o">=</span> <span class="mi">3001</span>
        <span class="c">#note that we are limited to stripe B, so change this accordingly is wv above is changed</span>
        <span class="c">#G230Lsens = [line for line in NUVsensData if line[1].strip() == &#39;G230L&#39; and </span>
        <span class="c">#             line[2] == 3000 and line[3].strip() == &#39;PSA&#39; and line[0].strip() == &#39;NUVB&#39;]</span>
        
        <span class="n">G230Ls</span> <span class="o">=</span> <span class="n">selectSensitivity</span><span class="p">(</span><span class="n">G230Lw</span><span class="p">,</span> <span class="n">G230Ls</span><span class="p">,</span> <span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;G230L sensitivity </span><span class="si">%f</span><span class="s"> at </span><span class="si">%i</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">G230Ls</span><span class="p">,</span> <span class="n">wv</span><span class="p">)</span>
        
        <span class="n">skyG230L</span> <span class="o">=</span> <span class="n">getZodiacalBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">getEarthShineBackground</span><span class="p">(</span><span class="n">wv</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="n">geo2417</span>
        <span class="n">skyG230L</span> <span class="o">=</span> <span class="mf">4.891e-6</span> <span class="c">#taken from ETC 17.4_test...</span>
        
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">flux</span> <span class="ow">in</span> <span class="n">fluxes</span><span class="p">:</span> 
                <span class="n">tmpSN</span> <span class="o">=</span> <span class="n">signalToNoisePerResel</span><span class="p">(</span><span class="n">G230Ls</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">NUVresel</span><span class="p">,</span> <span class="n">skyG230L</span><span class="p">,</span> <span class="n">darkNUV</span><span class="o">*</span><span class="n">SNboxNUV</span><span class="p">)</span>
                <span class="n">tmp</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">flux</span><span class="p">,</span> <span class="n">tmpSN</span><span class="p">])</span>
            
            <span class="n">G230LSNRdata</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">time</span><span class="p">,</span> <span class="n">tmp</span><span class="p">])</span>

        <span class="n">plot</span><span class="o">.</span><span class="n">Chapter13SNPlot</span><span class="p">(</span><span class="n">G230LSNRdata</span><span class="p">,</span>
                             <span class="n">calculateSTMAGlim</span><span class="p">(</span><span class="mf">30000.</span><span class="p">,</span> <span class="s">&#39;G230L&#39;</span><span class="p">,</span> <span class="n">G230Ls</span><span class="p">,</span> <span class="n">NUV</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span>
                             <span class="s">&#39;G230L&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">wv</span><span class="p">),</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G230LSNR&#39;</span><span class="p">,</span> <span class="n">FUV</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>         
<span class="c">#########################################################################################</span>
        <span class="c">#Spatial profiles</span>
    <span class="k">if</span> <span class="n">SpatialProfiles</span><span class="p">:</span>
        <span class="n">dispData</span> <span class="o">=</span> <span class="n">read</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">FUVdispersionReferenceFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">xvalues</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">8005</span><span class="p">,</span> <span class="mi">14005</span><span class="p">)</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="mi">460</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="mi">520</span>
        
        <span class="c">#G130A</span>
        <span class="n">G130MAimage</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">G130MASP</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">G130MAhdr</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">G130MASP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">G130MAhdr1</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">Header</span><span class="p">(</span><span class="n">G130MASP</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">G130MAdisp</span> <span class="o">=</span> <span class="n">getDispersion</span><span class="p">(</span><span class="n">G130MAhdr</span><span class="p">[</span><span class="s">&#39;SEGMENT&#39;</span><span class="p">],</span>
                                   <span class="n">G130MAhdr</span><span class="p">[</span><span class="s">&#39;OPT_ELEM&#39;</span><span class="p">],</span>
                                   <span class="n">G130MAhdr</span><span class="p">[</span><span class="s">&#39;CENWAVE&#39;</span><span class="p">],</span>
                                   <span class="n">G130MAhdr</span><span class="p">[</span><span class="s">&#39;FPPOS&#39;</span><span class="p">],</span>
                                   <span class="n">dispData</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">SpatialProfileFUV</span><span class="p">(</span><span class="n">G130MAimage</span><span class="p">,</span>
                               <span class="n">G130MAdisp</span><span class="p">,</span>
                               <span class="n">xvalues</span><span class="p">,</span>
                               <span class="n">width</span><span class="p">,</span>
                               <span class="n">ymin</span><span class="p">,</span>
                               <span class="n">ymax</span><span class="p">,</span>
                               <span class="n">G130MAhdr1</span><span class="p">[</span><span class="s">&#39;SP_LOC_A&#39;</span><span class="p">],</span>
                               <span class="n">G130MAhdr1</span><span class="p">[</span><span class="s">&#39;SP_HGT&#39;</span><span class="p">],</span>
                               <span class="s">&#39;G130M Spatial Profile Segment A&#39;</span><span class="p">,</span>
                               <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G130MSpatialProfile&#39;</span><span class="p">)</span>

        <span class="c">#G130MBimage = readlocal.FITSTable(G130MBSP, 1)</span>

        
<span class="c">#########################################################################################</span>
    <span class="k">if</span> <span class="n">LSF</span><span class="p">:</span>
        <span class="c">#LSF plots       </span>
        <span class="c">#read data with Numpy</span>
        <span class="n">G130LSF</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;G130MLSFdata.txt&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">G140LSF</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;G140LLSFdata.txt&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">G160LSF</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;G160MLSFdata.txt&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
        <span class="n">NUVLSF</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;NUVLSFdata.txt&#39;</span><span class="p">,</span> <span class="n">comments</span><span class="o">=</span><span class="s">&#39;#&#39;</span><span class="p">)</span>

        <span class="c">#G130M LSF</span>
        <span class="n">G130LSFwaves</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1150&#39;</span><span class="p">,</span><span class="s">&#39;1200&#39;</span><span class="p">,</span><span class="s">&#39;1250&#39;</span><span class="p">,</span><span class="s">&#39;1300&#39;</span><span class="p">,</span><span class="s">&#39;1350&#39;</span><span class="p">,</span><span class="s">&#39;1400&#39;</span><span class="p">,</span><span class="s">&#39;1450&#39;</span><span class="p">]</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">LSFcomparison</span><span class="p">(</span><span class="n">G130LSF</span><span class="p">,</span> <span class="n">G130LSFwaves</span><span class="p">,</span> <span class="s">&#39;LSF of G130M&#39;</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G130LSFComparison&#39;</span><span class="p">)</span>

        <span class="c">#G140L LSF </span>
        <span class="n">G140LSFwaves</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1250&#39;</span><span class="p">,</span><span class="s">&#39;1300&#39;</span><span class="p">,</span><span class="s">&#39;1350&#39;</span><span class="p">,</span><span class="s">&#39;1400&#39;</span><span class="p">,</span><span class="s">&#39;1450&#39;</span><span class="p">,</span><span class="s">&#39;1500&#39;</span><span class="p">,</span><span class="s">&#39;1550&#39;</span><span class="p">,</span><span class="s">&#39;1600&#39;</span><span class="p">,</span><span class="s">&#39;1650&#39;</span><span class="p">,</span><span class="s">&#39;1700&#39;</span><span class="p">,</span><span class="s">&#39;1750&#39;</span><span class="p">,</span><span class="s">&#39;1800&#39;</span><span class="p">]</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">LSFcomparison</span><span class="p">(</span><span class="n">G140LSF</span><span class="p">,</span> <span class="n">G140LSFwaves</span><span class="p">,</span> <span class="s">&#39;LSF of G140L&#39;</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G140LSFComparison&#39;</span><span class="p">)</span>

        <span class="c">#G160M LSF</span>
        <span class="n">G160LSFwaves</span> <span class="o">=</span> <span class="s">&#39;1450,1500,1550,1600,1650,1700,1750&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">LSFcomparison</span><span class="p">(</span><span class="n">G160LSF</span><span class="p">,</span> <span class="n">G160LSFwaves</span><span class="p">,</span> <span class="s">&#39;LSF of G160M&#39;</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;G160LSFComparison&#39;</span><span class="p">)</span>
        
        <span class="c">#NUV LSF</span>
        <span class="n">NUVLSFwaves</span> <span class="o">=</span> <span class="s">&#39;1700           1800           1900           2000           2100           2200           2300           2400           2500           2600           2700           2800           2900           3000           3100           3200&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">LSFcomparison</span><span class="p">(</span><span class="n">NUVLSF</span><span class="p">,</span> <span class="n">NUVLSFwaves</span><span class="p">,</span> <span class="s">&#39;LSF of NUV Gratings&#39;</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;NUVLSFComparison&#39;</span><span class="p">)</span>
<span class="c">#########################################################################################</span>
        <span class="c">#Dispersed-light acquisition plots</span>
        <span class="c">#Fig. 8.9, COS IHB, version 2.0, draft 1</span>
        <span class="n">dt</span> <span class="o">=</span><span class="p">{</span><span class="s">&#39;names&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;grating&#39;</span><span class="p">,</span> <span class="s">&#39;flux&#39;</span><span class="p">,</span> <span class="s">&#39;time&#39;</span><span class="p">),</span><span class="s">&#39;formats&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;S5&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">,</span> <span class="s">&#39;f4&#39;</span><span class="p">)}</span>
        <span class="n">gratings</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;G130M&#39;</span><span class="p">,</span> <span class="s">&#39;G160M&#39;</span><span class="p">,</span> <span class="s">&#39;G140L&#39;</span><span class="p">,</span> <span class="s">&#39;G185M&#39;</span><span class="p">,</span> <span class="s">&#39;G225M&#39;</span><span class="p">,</span> <span class="s">&#39;G285M&#39;</span><span class="p">,</span> <span class="s">&#39;G230L&#39;</span><span class="p">]</span>
        <span class="n">DAcq</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="s">&#39;DispAcqData.txt&#39;</span><span class="p">,</span> <span class="n">comments</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">dt</span><span class="p">)</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">DispersedLightAcquisitionTimes</span><span class="p">(</span><span class="n">DAcq</span><span class="p">,</span> <span class="n">gratings</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;DispLightAcq&#39;</span><span class="p">)</span>
<span class="c">#########################################################################################</span>

    <span class="k">if</span> <span class="n">computedPhot</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Starting to create plots that are based on computed values...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="c">##########################################################################################        </span>
        <span class="c">#Figure 3.4, page 14</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">every</span> <span class="o">=</span> <span class="mi">60</span>  <span class="c">#1 = every point is plotted</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">readcom</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">BOATransmissionFile</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>
    
        <span class="n">wave</span> <span class="o">=</span> <span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span> 
        
        <span class="n">plot</span><span class="o">.</span><span class="n">BOATransmission</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">throughput</span><span class="p">,</span> <span class="n">every</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;BOATransmission&#39;</span><span class="p">)</span>
        
<span class="c">##########################################################################################        </span>
        <span class="c">#Fig. 7..3, page 72 (COS IHB, version 1.0)  </span>
        <span class="n">AcqImageData</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">[[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.009</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.7377</span><span class="p">,</span> <span class="mf">8.6892</span><span class="p">,</span> <span class="mf">86.9775</span><span class="p">,</span> <span class="mf">878.3045</span><span class="p">,</span> <span class="mf">977.0638</span><span class="p">],</span> <span class="s">&#39;r-&#39;</span><span class="p">,</span> <span class="s">&#39;PSA + MIRRORA&#39;</span><span class="p">],</span>
                        <span class="p">[[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.0759</span><span class="p">,</span> <span class="mf">10.3806</span><span class="p">,</span> <span class="mf">103.9461</span><span class="p">,</span> <span class="mf">1053.4850</span><span class="p">],</span> <span class="s">&#39;b-&#39;</span><span class="p">,</span> <span class="s">&#39;PSA + MIRRORB&#39;</span><span class="p">],</span>
                        <span class="p">[[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span> <span class="mf">3.9282</span><span class="p">,</span> <span class="mf">9.8206</span><span class="p">,</span> <span class="mf">983.5532</span><span class="p">],</span> <span class="s">&#39;g-&#39;</span><span class="p">,</span> <span class="s">&#39;BOA + MIRRORA&#39;</span><span class="p">],</span>
                        <span class="p">[[</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.5177</span><span class="p">,</span> <span class="mf">9.0355</span><span class="p">,</span><span class="mf">45.1802</span><span class="p">,</span><span class="mf">452.0930</span><span class="p">,</span><span class="mf">1131.4448</span><span class="p">],</span> <span class="s">&#39;k-&#39;</span><span class="p">,</span> <span class="s">&#39;BOA + MIRRORB&#39;</span><span class="p">]</span>
                        <span class="p">]</span>

        <span class="n">plot</span><span class="o">.</span><span class="n">AcqImageExposureTimes</span><span class="p">(</span><span class="n">AcqImageData</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span> <span class="s">&#39;ACQImageExposureTime&#39;</span><span class="p">)</span>
        

    <span class="k">if</span> <span class="n">local</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Starting to create plots that are based on files on local folder...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="c">##########################################################################################     </span>
        <span class="c">#Fig 6.1, page 61        </span>
        <span class="c">#data = readcom.FITSTable(MirrorAImagingSensFile, 1)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSTable</span><span class="p">(</span><span class="n">MirrorAImagingSensFile</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">wave</span> <span class="o">=</span> <span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
        <span class="n">throughput</span> <span class="o">=</span> <span class="p">[</span><span class="n">triplet</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">triplet</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span> 
        
        <span class="n">plot</span><span class="o">.</span><span class="n">NUVPSAImagingSensitivity</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span> <span class="n">throughput</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;NUVImagingSensitivity&#39;</span><span class="p">)</span>
               
<span class="c">#########################################################################################</span>
        <span class="c">#Example routine to make plots 7.4 to 7.7, change files and plotting functions</span>
        <span class="n">imagedata</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="s">&#39;l61h2904r_06334222945_flt.fits&#39;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="n">xline</span> <span class="o">=</span> <span class="mi">595</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">imagedata</span><span class="p">[:,</span> <span class="n">xline</span><span class="p">]</span>
    
        <span class="n">plot</span><span class="o">.</span><span class="n">PSAMMIRRORANUVImaging</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)),</span> <span class="n">counts</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;NUVImagingPSA&#39;</span><span class="p">)</span>
    
<span class="c">#########################################################################################</span>
        <span class="c">#Example for Fig 4.2 p 29, filename and exposure time should be changed</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;l61h0000r_06336164728&#39;</span>
        <span class="n">exptime</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">readlocal</span><span class="o">.</span><span class="n">HeaderKeyword</span><span class="p">(</span><span class="nb">file</span> <span class="o">+</span> <span class="s">&#39;_flt_b.fits&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;EXPTIME&#39;</span><span class="p">))</span>
        <span class="n">imagedata</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="nb">file</span> <span class="o">+</span> <span class="s">&#39;_flt_b.fits&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    
        <span class="c">#specdata = readlocal.FITSTable(file + &#39;_x1d.fits&#39;, 1)</span>
        <span class="c">#wave = specdata[0][3]</span>
        <span class="c">#counts = specdata[0][4]</span>
        <span class="c">#plot.COSFUVSpectrum(imagedata, wave, counts, &#39;COSFUVSpectrum&#39;)</span>
        
        <span class="n">yline</span> <span class="o">=</span> <span class="mi">520</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">collapsed</span> <span class="o">=</span> <span class="n">collapseSpectrumY</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="n">yline</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> 
            
        <span class="n">plot</span><span class="o">.</span><span class="n">COSFUVSpectrum</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collapsed</span><span class="p">)),</span> 
                            <span class="n">collapsed</span><span class="p">,</span> <span class="n">exptime</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;COSFUVSpectrum&#39;</span><span class="p">)</span>
    
<span class="c">##########################################################################################</span>
        <span class="c">#Example of Fig 13.3 on page 138</span>
        <span class="c">#Filename etc. should be changed for real data</span>
        <span class="c">#Use wavelength rather than pixels for the proper plot</span>
        <span class="nb">file</span> <span class="o">=</span>  <span class="s">&#39;l61h0102r_06337015153_flt_a.fits&#39;</span>
    
        <span class="n">imagedata</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">collapsed</span> <span class="o">=</span> <span class="n">collapseSpectrumY</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">WavecalSpecPSA</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collapsed</span><span class="p">)),</span> 
                            <span class="n">collapsed</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;WavecalSpecFUVPSA&#39;</span><span class="p">)</span>
    
<span class="c">##########################################################################################</span>
        <span class="c">#Example of Fig. 5.1 on page 39  </span>
        <span class="c">#File should be changed...</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;l61h0102r_06337015153_flt_a.fits&#39;</span>
        
        <span class="n">imagedata</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">collapsed</span> <span class="o">=</span> <span class="n">collapseSpectrumY</span><span class="p">(</span><span class="n">imagedata</span><span class="p">,</span> <span class="mi">476</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">ScatteredLight</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">collapsed</span><span class="p">)),</span> 
                            <span class="n">collapsed</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;ScatteredLightFUV&#39;</span><span class="p">)</span>
        
<span class="c">##########################################################################################</span>
        <span class="c">#Fig. 7.4 page 73 of COS IHB (version 1.0)        </span>
        <span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;laa702acq_flt.fits&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">yline</span> <span class="o">=</span> <span class="mi">440</span>
        <span class="n">exptime</span> <span class="o">=</span> <span class="mf">60.</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="mi">260</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="mi">350</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]</span><span class="o">*</span><span class="n">exptime</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">MIRRORB</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">),</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;MIRRORBProfile&#39;</span><span class="p">)</span>
                
<span class="c">##########################################################################################</span>
        <span class="c">#Fig. 7.5</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;laa702b7q_flt.fits&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">exptime</span> <span class="o">=</span> <span class="mf">80.</span>
        <span class="n">yline</span> <span class="o">=</span> <span class="mi">287</span>
        <span class="n">xline</span> <span class="o">=</span> <span class="mi">527</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="mi">510</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="mi">550</span>
       
        <span class="c">#straight plot</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]</span><span class="o">*</span><span class="n">exptime</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">BOAprofile</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">ydata</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;BOAProfile&#39;</span><span class="p">)</span>

        <span class="c">#collapsed and summed over</span>
        <span class="n">ydata</span> <span class="o">=</span> <span class="n">collapseSpectrumY</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">yline</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">exptime</span><span class="o">/</span><span class="mf">5.</span>  
        <span class="n">plot</span><span class="o">.</span><span class="n">BOAprofile</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">ydata</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">],</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;BOAProfile2&#39;</span><span class="p">)</span>

        
<span class="c">##########################################################################################        </span>
        <span class="c">#Fig. 7.6 &amp; 7.7</span>
        <span class="nb">file</span> <span class="o">=</span> <span class="s">&#39;laa702c9q_flt.fits&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">readlocal</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
       
        <span class="n">exptime</span> <span class="o">=</span> <span class="mf">2630.</span>
        <span class="n">xcen</span> <span class="o">=</span>  <span class="mi">304</span> <span class="c">#304</span>
        <span class="n">wid</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">ycen</span> <span class="o">=</span> <span class="mi">447</span> <span class="c">#447</span>
        
        <span class="n">dataxy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ycen</span><span class="p">,</span><span class="n">xcen</span><span class="o">-</span><span class="n">wid</span><span class="p">:</span><span class="n">xcen</span><span class="o">+</span><span class="n">wid</span><span class="p">]</span><span class="o">*</span><span class="n">exptime</span>
        <span class="n">datayy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ycen</span><span class="o">-</span><span class="n">wid</span><span class="p">:</span><span class="n">ycen</span><span class="o">+</span><span class="n">wid</span><span class="p">,</span><span class="n">xcen</span><span class="p">]</span><span class="o">*</span><span class="n">exptime</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">BOAMIRRORprofile</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">xcen</span><span class="o">-</span><span class="n">wid</span><span class="p">,</span> <span class="n">xcen</span><span class="o">+</span><span class="n">wid</span><span class="p">),</span> <span class="n">dataxy</span><span class="p">,</span> 
                              <span class="nb">range</span><span class="p">(</span><span class="n">ycen</span><span class="o">-</span><span class="n">wid</span><span class="p">,</span> <span class="n">ycen</span><span class="o">+</span><span class="n">wid</span><span class="p">),</span> <span class="n">datayy</span><span class="p">,</span>
                              <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;BOAMIRRORBProfile&#39;</span><span class="p">)</span>

        <span class="c">#collapsed</span>
        <span class="n">dataxy</span> <span class="o">=</span> <span class="n">collapseSpectrumY</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ycen</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="n">xcen</span><span class="o">-</span><span class="n">wid</span><span class="p">:</span><span class="n">xcen</span><span class="o">+</span><span class="n">wid</span><span class="p">]</span><span class="o">*</span><span class="n">exptime</span><span class="o">/</span><span class="mf">3.</span> <span class="c">#_x</span>
        <span class="n">datayy</span> <span class="o">=</span> <span class="n">collapseSpectrumX</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xcen</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="n">ycen</span><span class="o">-</span><span class="n">wid</span><span class="p">:</span><span class="n">ycen</span><span class="o">+</span><span class="n">wid</span><span class="p">]</span><span class="o">*</span><span class="n">exptime</span><span class="o">/</span><span class="mf">3.</span> <span class="c">#_y</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">BOAMIRRORprofile</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">xcen</span><span class="o">-</span><span class="n">wid</span><span class="p">,</span> <span class="n">xcen</span><span class="o">+</span><span class="n">wid</span><span class="p">),</span> <span class="n">dataxy</span><span class="p">,</span> 
                              <span class="nb">range</span><span class="p">(</span><span class="n">ycen</span><span class="o">-</span><span class="n">wid</span><span class="p">,</span> <span class="n">ycen</span><span class="o">+</span><span class="n">wid</span><span class="p">),</span> <span class="n">datayy</span><span class="p">,</span>
                              <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;BOAMIRRORBProfile2&#39;</span><span class="p">)</span>

<span class="c">##########################################################################################</span>
    <span class="k">if</span> <span class="n">PSFs</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Starting to create PSF plots that are based on files on local folder...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
<span class="c">##########################################################################################</span>
        <span class="c">#Fig 6.3 on page 63</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">imagedata</span> <span class="o">=</span> <span class="n">readPSF</span><span class="o">.</span><span class="n">FITSImage</span><span class="p">(</span><span class="n">PSFdataFile</span><span class="p">,</span> <span class="n">extension</span><span class="p">)</span>

        <span class="n">yline</span> <span class="o">=</span> <span class="mi">280</span>

        <span class="n">plot</span><span class="o">.</span><span class="n">NUVImageProfile</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imagedata</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span> <span class="p">:])),</span> 
                             <span class="n">imagedata</span><span class="p">[</span><span class="n">yline</span><span class="p">,</span> <span class="p">:],</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;NUVImageProfile&#39;</span><span class="p">)</span>
        
<span class="c">##########################################################################################</span>
        <span class="c">#Fig 6.2 on page 63</span>
        <span class="n">centrex</span> <span class="o">=</span> <span class="mi">486</span>
        <span class="n">centrey</span> <span class="o">=</span> <span class="mi">280</span>
        <span class="n">displacement</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">centrex</span> <span class="o">-</span> <span class="n">displacement</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">centrex</span> <span class="o">+</span> <span class="n">displacement</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">centrey</span> <span class="o">-</span> <span class="n">displacement</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">centrey</span> <span class="o">+</span> <span class="n">displacement</span>
        
        <span class="n">datay</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span>
        <span class="n">datax</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
   
        <span class="c">#note the reversed order!</span>
        <span class="n">dataz</span> <span class="o">=</span> <span class="n">imagedata</span><span class="p">[</span><span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">]</span>

        <span class="n">plot</span><span class="o">.</span><span class="n">PSF</span><span class="p">(</span><span class="n">datax</span><span class="p">,</span> <span class="n">datay</span><span class="p">,</span> <span class="n">dataz</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;COSImagingPSF&#39;</span><span class="p">)</span>
        
<span class="c">##########################################################################################        </span>
        <span class="c">#Fig 6.2 on page 62</span>
        <span class="c">#Calls and IDL routine to do the 3D plotting</span>
        <span class="c">#filenames etc. should be edited inside the IDL routine</span>
        <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Running IDL for PSF plots...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">subprocess</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s">&#39;idl psfplotting.pro&#39;</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">executable</span> <span class="o">=</span> <span class="s">&#39;tcsh&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;Error encountered while calling IDL...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">99</span><span class="p">)</span>
            

<span class="c">##########################################################################################</span>
        <span class="c">#Fig 7.1 on page 69</span>
        
        <span class="n">reads</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">localFolder</span> <span class="o">+</span> <span class="n">FIG71Data</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">alldata</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reads</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                <span class="n">alldata</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
        
        <span class="n">datax</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">alldata</span><span class="p">]</span>
        <span class="n">datay</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">alldata</span><span class="p">]</span>
        
        <span class="n">plot</span><span class="o">.</span><span class="n">PSARelativeTransmission</span><span class="p">(</span><span class="n">datax</span><span class="p">,</span> <span class="n">datay</span><span class="p">,</span> <span class="n">outputfolder</span> <span class="o">+</span><span class="s">&#39;RelativeTransmission&#39;</span><span class="p">)</span>
        
<span class="c">##########################################################################################</span>
    <span class="n">log</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Plotting program ends...</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">home</a>|&nbsp;</li>
        <li><a href="../../../../search.html">search</a>|&nbsp;</li>

          <li><a href="../../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Sami-Matias Niemi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>